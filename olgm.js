!function(){"use strict";var t=function(t,e){this.ol3map=t,this.gmap=e},c="function"==typeof Object.assign?Object.assign:function(t,e){var i=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),r=1,o=arguments.length;r<o;++r){var s=i[r];if(null!=s)for(var a in s)s.hasOwnProperty(a)&&(n[a]=s[a])}return n};function y(t){for(var e in t)delete t[e]}var o="function"==typeof Object.values?Object.values:function(t){var e=[];for(var i in t)e.push(t[i]);return e};function e(t){var e;for(e in t)return!1;return!e}function a(t,e,i,n,r){if(n&&n!==t&&(i=i.bind(n)),r){var o=i;i=function(){t.removeEventListener(e,i),o.apply(this,arguments)}}var s={target:t,type:e,listener:i};return t.addEventListener(e,i),s}function h(t,e,i,n){return a(t,e,i,n,!0)}function l(t){t&&t.target&&(t.target.removeEventListener(t.type,t.listener),y(t))}var p={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",WHEEL:"wheel"};function u(){return function(){throw new Error("Unimplemented abstract method.")}()}var i=0;function dt(t){return t.ol_uid||(t.ol_uid=String(++i))}var n="propertychange",r=function(){function t(){this.disposed_=!1}return t.prototype.dispose=function(){this.disposed_||(this.disposed_=!0,this.disposeInternal())},t.prototype.disposeInternal=function(){},t}();function _t(t,e){return e<t?1:t<e?-1:0}function f(t,e){return 0<=t.indexOf(e)}function s(t,e,i){var n=t.length;if(t[0]<=e)return 0;if(e<=t[n-1])return n-1;var r=void 0;if(0<i){for(r=1;r<n;++r)if(t[r]<e)return r-1}else if(i<0){for(r=1;r<n;++r)if(t[r]<=e)return r}else for(r=1;r<n;++r){if(t[r]==e)return r;if(t[r]<e)return t[r-1]-e<e-t[r]?r-1:r}return n-1}function d(t,e,i){for(;e<i;){var n=t[e];t[e]=t[i],t[i]=n,++e,--i}}function g(t,e){for(var i=Array.isArray(e)?e:[e],n=i.length,r=0;r<n;r++)t[t.length]=i[r]}function Gt(t,e){var i=t.length;if(i!==e.length)return!1;for(var n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}function _(){return!0}function v(){return!1}function m(){}var x,C,w=function(){function t(t){this.propagationStopped,this.type=t,this.target=null}return t.prototype.preventDefault=function(){this.propagationStopped=!0},t.prototype.stopPropagation=function(){this.propagationStopped=!0},t}(),S=(x=function(t,e){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}x(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),E=function(i){function t(t){var e=i.call(this)||this;return e.eventTarget_=t,e.pendingRemovals_={},e.dispatching_={},e.listeners_={},e}return S(t,i),t.prototype.addEventListener=function(t,e){if(t&&e){var i=this.listeners_[t];i||(i=[],this.listeners_[t]=i),-1===i.indexOf(e)&&i.push(e)}},t.prototype.dispatchEvent=function(t){var e="string"==typeof t?new w(t):t,i=e.type;e.target||(e.target=this.eventTarget_||this);var n,r=this.listeners_[i];if(r){i in this.dispatching_||(this.dispatching_[i]=0,this.pendingRemovals_[i]=0),++this.dispatching_[i];for(var o=0,s=r.length;o<s;++o)if(!1===r[o].call(this,e)||e.propagationStopped){n=!1;break}if(--this.dispatching_[i],0===this.dispatching_[i]){var a=this.pendingRemovals_[i];for(delete this.pendingRemovals_[i];a--;)this.removeEventListener(i,m);delete this.dispatching_[i]}return n}},t.prototype.disposeInternal=function(){y(this.listeners_)},t.prototype.getListeners=function(t){return this.listeners_[t]},t.prototype.hasListener=function(t){return t?t in this.listeners_:0<Object.keys(this.listeners_).length},t.prototype.removeEventListener=function(t,e){var i=this.listeners_[t];if(i){var n=i.indexOf(e);-1!==n&&(t in this.pendingRemovals_?(i[n]=m,++this.pendingRemovals_[t]):(i.splice(n,1),0===i.length&&delete this.listeners_[t]))}},t}(r),O=(C=function(t,e){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}C(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),I=function(e){function t(){var t=e.call(this)||this;return t.revision_=0,t}return O(t,e),t.prototype.changed=function(){++this.revision_,this.dispatchEvent(p.CHANGE)},t.prototype.getRevision=function(){return this.revision_},t.prototype.on=function(t,e){if(Array.isArray(t)){for(var i=t.length,n=new Array(i),r=0;r<i;++r)n[r]=a(this,t[r],e);return n}return a(this,t,e)},t.prototype.once=function(t,e){if(Array.isArray(t)){for(var i=t.length,n=new Array(i),r=0;r<i;++r)n[r]=h(this,t[r],e);return n}return h(this,t,e)},t.prototype.un=function(t,e){if(Array.isArray(t))for(var i=0,n=t.length;i<n;++i)this.removeEventListener(t[i],e);else this.removeEventListener(t,e)},t}(E);var T,P=(T=function(t,e){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}T(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),R=function(r){function t(t,e,i){var n=r.call(this,t)||this;return n.key=e,n.oldValue=i,n}return P(t,r),t}(w),L=function(i){function t(t){var e=i.call(this)||this;return dt(e),e.values_={},void 0!==t&&e.setProperties(t),e}return P(t,i),t.prototype.get=function(t){var e;return this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e},t.prototype.getKeys=function(){return Object.keys(this.values_)},t.prototype.getProperties=function(){return c({},this.values_)},t.prototype.notify=function(t,e){var i;i=F(t),this.dispatchEvent(new R(i,t,e)),i=n,this.dispatchEvent(new R(i,t,e))},t.prototype.set=function(t,e,i){if(i)this.values_[t]=e;else{var n=this.values_[t];n!==(this.values_[t]=e)&&this.notify(t,n)}},t.prototype.setProperties=function(t,e){for(var i in t)this.set(i,t[i],e)},t.prototype.unset=function(t,e){if(t in this.values_){var i=this.values_[t];delete this.values_[t],e||this.notify(t,i)}},t}(I),b={};function F(t){return b.hasOwnProperty(t)?b[t]:b[t]="change:"+t}var M="opacity",A="visible",D="extent",G="zIndex",k="maxResolution",N="minResolution",j="maxZoom",W="minZoom",Y="source";function X(t,e,i){return Math.min(Math.max(t,e),i)}var z="cosh"in Math?Math.cosh:function(t){var e=Math.exp(t);return(e+1/e)/2};function U(t,e,i,n,r,o){var s=r-i,a=o-n;if(0!==s||0!==a){var h=((t-i)*s+(e-n)*a)/(s*s+a*a);1<h?(i=r,n=o):0<h&&(i+=s*h,n+=a*h)}return V(t,e,i,n)}function V(t,e,i,n){var r=i-t,o=n-e;return r*r+o*o}function B(t){return t*Math.PI/180}function H(t,e){var i=t%e;return i*e<0?i+e:i}function Z(t,e,i){return t+i*(e-t)}var K,q=(K=function(t,e){return(K=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}K(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),J=function(n){function t(t){var e=this,i="Assertion failed. See https://openlayers.org/en/"+("v"+"6.1.1".split("-")[0])+"/doc/errors/#"+t+" for details.";return(e=n.call(this,i)||this).code=t,e.name="AssertionError",e.message=i,e}return q(t,n),t}(Error);function Q(t,e){if(!t)throw new J(e)}var $,tt,et,it=($=function(t,e){return($=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}$(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),nt=function(n){function t(t){var e=n.call(this)||this,i=c({},t);return i[M]=void 0!==t.opacity?t.opacity:1,Q("number"==typeof i[M],64),i[A]=void 0===t.visible||t.visible,i[G]=t.zIndex,i[k]=void 0!==t.maxResolution?t.maxResolution:1/0,i[N]=void 0!==t.minResolution?t.minResolution:0,i[W]=void 0!==t.minZoom?t.minZoom:-1/0,i[j]=void 0!==t.maxZoom?t.maxZoom:1/0,e.className_=void 0!==i.className?t.className:"ol-layer",delete i.className,e.setProperties(i),e.state_=null,e}return it(t,n),t.prototype.getClassName=function(){return this.className_},t.prototype.getLayerState=function(t){var e=this.state_||{layer:this,managed:void 0===t||t},i=this.getZIndex();return e.opacity=X(Math.round(100*this.getOpacity())/100,0,1),e.sourceState=this.getSourceState(),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=void 0!==i?i:!1===e.managed?1/0:0,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e},t.prototype.getLayersArray=function(t){return u()},t.prototype.getLayerStatesArray=function(t){return u()},t.prototype.getExtent=function(){return this.get(D)},t.prototype.getMaxResolution=function(){return this.get(k)},t.prototype.getMinResolution=function(){return this.get(N)},t.prototype.getMinZoom=function(){return this.get(W)},t.prototype.getMaxZoom=function(){return this.get(j)},t.prototype.getOpacity=function(){return this.get(M)},t.prototype.getSourceState=function(){return u()},t.prototype.getVisible=function(){return this.get(A)},t.prototype.getZIndex=function(){return this.get(G)},t.prototype.setExtent=function(t){this.set(D,t)},t.prototype.setMaxResolution=function(t){this.set(k,t)},t.prototype.setMinResolution=function(t){this.set(N,t)},t.prototype.setMaxZoom=function(t){this.set(j,t)},t.prototype.setMinZoom=function(t){this.set(W,t)},t.prototype.setOpacity=function(t){Q("number"==typeof t,64),this.set(M,t)},t.prototype.setVisible=function(t){this.set(A,t)},t.prototype.setZIndex=function(t){this.set(G,t)},t.prototype.disposeInternal=function(){this.state_&&(this.state_.layer=null,this.state_=null),n.prototype.disposeInternal.call(this)},t}(L),rt="prerender",ot="postrender",st="precompose",at="undefined",ht="ready",lt=(tt=function(t,e){return(tt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}tt(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),ut=function(r){function t(t){var e=this,i=c({},t);delete i.source,(e=r.call(this,i)||this).mapPrecomposeKey_=null,e.mapRenderKey_=null,e.sourceChangeKey_=null,e.renderer_=null,t.render&&(e.render=t.render),t.map&&e.setMap(t.map),e.addEventListener(F(Y),e.handleSourcePropertyChange_);var n=t.source?t.source:null;return e.setSource(n),e}return lt(t,r),t.prototype.getLayersArray=function(t){var e=t||[];return e.push(this),e},t.prototype.getLayerStatesArray=function(t){var e=t||[];return e.push(this.getLayerState()),e},t.prototype.getSource=function(){return this.get(Y)||null},t.prototype.getSourceState=function(){var t=this.getSource();return t?t.getState():at},t.prototype.handleSourceChange_=function(){this.changed()},t.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(l(this.sourceChangeKey_),this.sourceChangeKey_=null);var t=this.getSource();t&&(this.sourceChangeKey_=a(t,p.CHANGE,this.handleSourceChange_,this)),this.changed()},t.prototype.getFeatures=function(t){return this.renderer_.getFeatures(t)},t.prototype.render=function(t,e){var i=this.getRenderer();if(i.prepareFrame(t))return i.renderFrame(t,e)},t.prototype.setMap=function(t){this.mapPrecomposeKey_&&(l(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(l(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=a(t,st,function(t){t.frameState.layerStatesArray.push(this.getLayerState(!1))},this),this.mapRenderKey_=a(this,p.CHANGE,t.render,t),this.changed())},t.prototype.setSource=function(t){this.set(Y,t)},t.prototype.getRenderer=function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_},t.prototype.hasRenderer=function(){return!!this.renderer_},t.prototype.createRenderer=function(){return null},t.prototype.disposeInternal=function(){this.setSource(null),r.prototype.disposeInternal.call(this)},t}(nt),ct=(et=function(t,e){return(et=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}et(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),pt=function(i){function t(t){var e=t||{};return i.call(this,e)||this}return ct(t,i),t}(ut),ft=0,gt=1,yt={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},vt={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function mt(t){for(var e=It(),i=0,n=t.length;i<n;++i)At(e,t[i]);return e}function xt(t,e,i){return i?(i[0]=t[0]-e,i[1]=t[1]-e,i[2]=t[2]+e,i[3]=t[3]+e,i):[t[0]-e,t[1]-e,t[2]+e,t[3]+e]}function Ct(t,e,i){var n,r;return(n=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0)*n+(r=i<t[1]?t[1]-i:t[3]<i?i-t[3]:0)*r}function wt(t,e){return Et(t,e[0],e[1])}function St(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]}function Et(t,e,i){return t[0]<=e&&e<=t[2]&&t[1]<=i&&i<=t[3]}function Ot(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],s=e[0],a=e[1],h=vt.UNKNOWN;return s<i?h|=vt.LEFT:r<s&&(h|=vt.RIGHT),a<n?h|=vt.BELOW:o<a&&(h|=vt.ABOVE),h===vt.UNKNOWN&&(h=vt.INTERSECTING),h}function It(){return[1/0,1/0,-1/0,-1/0]}function Tt(t,e,i,n,r){return r?(r[0]=t,r[1]=e,r[2]=i,r[3]=n,r):[t,e,i,n]}function Pt(t){return Tt(1/0,1/0,-1/0,-1/0,t)}function Rt(t,e){var i=t[0],n=t[1];return Tt(i,n,i,n,e)}function Lt(t,e){return function(t,e){for(var i=0,n=e.length;i<n;++i)At(t,e[i]);return t}(Pt(e),t)}function bt(t,e,i,n,r){return Dt(Pt(r),t,e,i,n)}function Ft(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]}function Mt(t,e){return e[0]<t[0]&&(t[0]=e[0]),e[2]>t[2]&&(t[2]=e[2]),e[1]<t[1]&&(t[1]=e[1]),e[3]>t[3]&&(t[3]=e[3]),t}function At(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function Dt(t,e,i,n,r){for(;i<n;i+=r)kt(t,e[i],e[i+1]);return t}function kt(t,e,i){t[0]=Math.min(t[0],e),t[1]=Math.min(t[1],i),t[2]=Math.max(t[2],e),t[3]=Math.max(t[3],i)}function Nt(t,e){var i;return(i=e(Wt(t)))?i:(i=e(Yt(t)))?i:(i=e(Ht(t)))?i:(i=e(Bt(t)))||!1}function jt(t){var e=0;return qt(t)||(e=Zt(t)*Ut(t)),e}function Wt(t){return[t[0],t[1]]}function Yt(t){return[t[2],t[1]]}function Xt(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function zt(t,e,i,n,r){var o=e*n[0]/2,s=e*n[1]/2,a=Math.cos(i),h=Math.sin(i),l=o*a,u=o*h,c=s*a,p=s*h,f=t[0],d=t[1],_=f-l+p,g=f-l-p,y=f+l-p,v=f+l+p,m=d-u-c,x=d-u+c,C=d+u+c,w=d+u-c;return Tt(Math.min(_,g,y,v),Math.min(m,x,C,w),Math.max(_,g,y,v),Math.max(m,x,C,w),r)}function Ut(t){return t[3]-t[1]}function Vt(t,e,i){var n=i||[1/0,1/0,-1/0,-1/0];return Kt(t,e)?(t[0]>e[0]?n[0]=t[0]:n[0]=e[0],t[1]>e[1]?n[1]=t[1]:n[1]=e[1],t[2]<e[2]?n[2]=t[2]:n[2]=e[2],t[3]<e[3]?n[3]=t[3]:n[3]=e[3]):Pt(n),n}function Bt(t){return[t[0],t[3]]}function Ht(t){return[t[2],t[3]]}function Zt(t){return t[2]-t[0]}function Kt(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}function qt(t){return t[2]<t[0]||t[3]<t[1]}function Jt(t,e,i){var n,r,o,s=[t[0],t[1],t[0],t[3],t[2],t[1],t[2],t[3]];return e(s,s,2),n=[s[0],s[2],s[4],s[6]],r=[s[1],s[3],s[5],s[7]],o=i,Tt(Math.min.apply(null,n),Math.min.apply(null,r),Math.max.apply(null,n),Math.max.apply(null,r),o)}var Qt={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},$t=6371008.8;function te(t,e,i){var n=i||$t,r=B(t[1]),o=B(e[1]),s=(o-r)/2,a=B(e[0]-t[0])/2,h=Math.sin(s)*Math.sin(s)+Math.sin(a)*Math.sin(a)*Math.cos(r)*Math.cos(o);return 2*n*Math.atan2(Math.sqrt(h),Math.sqrt(1-h))}var ee={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},ie={};ie[ee.DEGREES]=2*Math.PI*6370997/360,ie[ee.FEET]=.3048,ie[ee.METERS]=1,ie[ee.USFEET]=1200/3937;var ne,re=function(){function t(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}return t.prototype.canWrapX=function(){return this.canWrapX_},t.prototype.getCode=function(){return this.code_},t.prototype.getExtent=function(){return this.extent_},t.prototype.getUnits=function(){return this.units_},t.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||ie[this.units_]},t.prototype.getWorldExtent=function(){return this.worldExtent_},t.prototype.getAxisOrientation=function(){return this.axisOrientation_},t.prototype.isGlobal=function(){return this.global_},t.prototype.setGlobal=function(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)},t.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},t.prototype.setDefaultTileGrid=function(t){this.defaultTileGrid_=t},t.prototype.setExtent=function(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)},t.prototype.setWorldExtent=function(t){this.worldExtent_=t},t.prototype.setGetPointResolution=function(t){this.getPointResolutionFunc_=t},t.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},t}(),oe=(ne=function(t,e){return(ne=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}ne(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),se=6378137,ae=Math.PI*se,he=[-ae,-ae,ae,ae],le=[-180,-85,180,85],ue=function(e){function t(t){return e.call(this,{code:t,units:ee.METERS,extent:he,global:!0,worldExtent:le,getPointResolution:function(t,e){return t/z(e[1]/se)}})||this}return oe(t,e),t}(re),ce=[new ue("EPSG:3857"),new ue("EPSG:102100"),new ue("EPSG:102113"),new ue("EPSG:900913"),new ue("urn:ogc:def:crs:EPSG:6.18:3:3857"),new ue("urn:ogc:def:crs:EPSG::3857"),new ue("http://www.opengis.net/gml/srs/epsg.xml#3857")];function pe(t,e,i){var n=t.length,r=1<i?i:2,o=e;void 0===o&&(o=2<r?t.slice():new Array(n));for(var s=ae,a=0;a<n;a+=r){o[a]=s*t[a]/180;var h=se*Math.log(Math.tan(Math.PI*(+t[a+1]+90)/360));s<h?h=s:h<-s&&(h=-s),o[a+1]=h}return o}function fe(t,e,i){var n=t.length,r=1<i?i:2,o=e;void 0===o&&(o=2<r?t.slice():new Array(n));for(var s=0;s<n;s+=r)o[s]=180*t[s]/ae,o[s+1]=360*Math.atan(Math.exp(t[s+1]/se))/Math.PI-90;return o}var de,_e=(de=function(t,e){return(de=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}de(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),ge=[-180,-90,180,90],ye=6378137*Math.PI/180,ve=function(i){function t(t,e){return i.call(this,{code:t,units:ee.DEGREES,extent:ge,axisOrientation:e,global:!0,metersPerUnit:ye,worldExtent:ge})||this}return _e(t,i),t}(re),me=[new ve("CRS:84"),new ve("EPSG:4326","neu"),new ve("urn:ogc:def:crs:EPSG::4326","neu"),new ve("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new ve("urn:ogc:def:crs:OGC:1.3:CRS84"),new ve("urn:ogc:def:crs:OGC:2:84"),new ve("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new ve("urn:x-ogc:def:crs:EPSG:4326","neu")],xe={};function Ce(t,e,i){var n=t.getCode(),r=e.getCode();n in xe||(xe[n]={}),xe[n][r]=i}var we={};function Se(t,e,i){var n;if(void 0!==e){for(var r=0,o=t.length;r<o;++r)e[r]=t[r];n=e}else n=t.slice();return n}function Ee(t,e,i){if(void 0!==e&&t!==e){for(var n=0,r=t.length;n<r;++n)e[n]=t[n];t=e}return t}function Oe(t){var e,i;e=t.getCode(),i=t,we[e]=i,Ce(t,t,Se)}function Ie(t){return"string"==typeof t?we[t]||null:t||null}function Te(t,e,i,n){var r,o=(t=Ie(t)).getPointResolutionFunc();if(o)r=o(e,i),n&&n!==t.getUnits()&&(s=t.getMetersPerUnit())&&(r=r*s/ie[n]);else if(t.getUnits()==ee.DEGREES&&!n||n==ee.DEGREES)r=e;else{var s,a=Le(t,Ie("EPSG:4326")),h=[i[0]-e/2,i[1],i[0]+e/2,i[1],i[0],i[1]-e/2,i[0],i[1]+e/2];r=(te((h=a(h,h,2)).slice(0,2),h.slice(2,4))+te(h.slice(4,6),h.slice(6,8)))/2,void 0!==(s=n?ie[n]:t.getMetersPerUnit())&&(r/=s)}return r}function Pe(t){t.forEach(Oe),t.forEach(function(e){t.forEach(function(t){e!==t&&Ce(e,t,Se)})})}function Re(t,e){if(t===e)return!0;var i=t.getUnits()===e.getUnits();return t.getCode()===e.getCode()?i:Le(t,e)===Se&&i}function Le(t,e){var i,n,r,o=t.getCode(),s=e.getCode(),a=(n=s,(i=o)in xe&&n in xe[i]&&(r=xe[i][n]),r);return a||(a=Ee),a}function be(t,e){return Le(Ie(t),Ie(e))}function Fe(t,e,i){return be(e,i)(t,void 0,t.length)}function Me(t,e,i){return Jt(t,be(e,i))}var Ae,De,Ge,ke=null;function Ne(t,e){return ke?Fe(t,e,ke):t}function je(t,e){return ke?Fe(t,ke,e):t}function We(t,e){return ke?Me(t,e,ke):t}function Ye(t,e){return ke?Me(t,ke,e):t}function Xe(t,e){var i=document.createElement("canvas");return t&&(i.width=t),e&&(i.height=e),i.getContext("2d")}Pe(ce),Pe(me),Ae=ce,De=pe,Ge=fe,me.forEach(function(e){Ae.forEach(function(t){Ce(e,t,De),Ce(t,e,Ge)})});var ze,Ue,Ve,Be=(ze=function(t,e){return(ze=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}ze(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),He=function(o){function t(t,e,i,n){var r=o.call(this,t)||this;return r.inversePixelTransform=e,r.frameState=i,r.context=n,r}return Be(t,o),t}(w),Ze=(Ve={},function(t){if(Ue||(Ue=document.createElement("div").style),!(t in Ve)){Ue.font=t;var e=Ue.fontFamily,i=Ue.fontWeight,n=Ue.fontStyle;if(Ue.font="",!e)return null;var r=e.split(/,\s?/);Ve[t]={families:r,weight:i,style:n}}return Ve[t]});function Ke(t,e){var i=e[0],n=e[1];return e[0]=t[0]*i+t[2]*n+t[4],e[1]=t[1]*i+t[3]*n+t[5],e}function qe(t,e,i,n,r,o,s,a){var h=Math.sin(o),l=Math.cos(o);return t[0]=n*l,t[1]=r*h,t[2]=-n*h,t[3]=r*l,t[4]=s*n*l-a*n*h+e,t[5]=s*r*h+a*r*l+i,t}function Je(t,e){var i,n=(i=e)[0]*i[3]-i[1]*i[2];Q(0!==n,32);var r=e[0],o=e[1],s=e[2],a=e[3],h=e[4],l=e[5];return t[0]=a/n,t[1]=-o/n,t[2]=-s/n,t[3]=r/n,t[4]=(s*l-a*h)/n,t[5]=-(r*l-o*h)/n,t}function Qe(t){return"matrix("+t.join(", ")+")"}var $e,ti,ei,ii=($e=function(t,e){return($e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}$e(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),ni=function(i){function t(t){var e=i.call(this)||this;return e.highWaterMark=void 0!==t?t:2048,e.count_=0,e.entries_={},e.oldest_=null,e.newest_=null,e}return ii(t,i),t.prototype.canExpireCache=function(){return this.getCount()>this.highWaterMark},t.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null,this.dispatchEvent(p.CLEAR)},t.prototype.containsKey=function(t){return this.entries_.hasOwnProperty(t)},t.prototype.forEach=function(t){for(var e=this.oldest_;e;)t(e.value_,e.key_,this),e=e.newer},t.prototype.get=function(t,e){var i=this.entries_[t];return Q(void 0!==i,15),i===this.newest_?i.value_:(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,(this.newest_=i).value_)},t.prototype.remove=function(t){var e=this.entries_[t];return Q(void 0!==e,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_},t.prototype.getCount=function(){return this.count_},t.prototype.getKeys=function(){var t,e=new Array(this.count_),i=0;for(t=this.newest_;t;t=t.older)e[i++]=t.key_;return e},t.prototype.getValues=function(){var t,e=new Array(this.count_),i=0;for(t=this.newest_;t;t=t.older)e[i++]=t.value_;return e},t.prototype.peekLast=function(){return this.oldest_.value_},t.prototype.peekLastKey=function(){return this.oldest_.key_},t.prototype.peekFirstKey=function(){return this.newest_.key_},t.prototype.pop=function(){var t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_},t.prototype.replace=function(t,e){this.get(t),this.entries_[t].value_=e},t.prototype.set=function(t,e){Q(!(t in this.entries_),16);var i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_},t.prototype.setSize=function(t){this.highWaterMark=t},t}(E),ri=(ti=function(t,e){return(ti=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}ti(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),oi=function(r){function t(t){var e=r.call(this,t)||this;return e.consumers={},e}return ri(t,r),t.prototype.clear=function(){this.consumers={},r.prototype.clear.call(this)},t.prototype.get=function(t,e){var i=r.prototype.get.call(this,t),n=dt(e);return n in this.consumers||(this.consumers[n]={}),this.consumers[n][t]=!0,i},t.prototype.prune=function(){var t=this;t:for(;this.canExpireCache();){var e=t.peekLastKey();for(var i in t.consumers)if(e in t.consumers[i])break t;var n=t.pop();for(var i in n.width=0,n.height=0,t.consumers)delete t.consumers[i][e]}},t.prototype.release=function(t){delete this.consumers[dt(t)]},t}(ni),si="10px sans-serif",ai="#000",hi="round",li=[],ui="round",ci="#000",pi="center",fi="middle",di=[0,0,0,0],_i=new oi,gi={},yi=null,vi={},mi=function(){var a,h,l=100,u=gi,c="32px ",p=["monospace","serif"],f=p.length,d="wmytzilWMYTZIL@#/&?$%10";function _(t,e,i){for(var n=xi(),r=!0,o=0;o<f;++o){var s=p[o];if(n.font=t+" "+e+" "+c+s,h=n.measureText(d).width,i!=s){n.font=t+" "+e+" "+c+i+","+s;var a=n.measureText(d).width;r=r&&a!=h}}return!!r}function g(){var t=!0;for(var e in u)u[e]<l&&(_.apply(this,e.split("\n"))?(u[e]=l,y(vi),yi=null,ei=void 0,_i.getCount()&&_i.clear()):(++u[e],t=!1));t&&(clearInterval(a),a=void 0)}return function(t){var e=Ze(t);if(e)for(var i=e.families,n=0,r=i.length;n<r;++n){var o=i[n],s=e.style+"\n"+e.weight+"\n"+o;s in u||(u[s]=l,_(e.style,e.weight,o)||void(u[s]=0)===a&&(a=setInterval(g,32)))}}}();function xi(){return yi||(yi=Xe(1,1)),yi}var Ci,wi,Si=(wi=vi,function(t){var e=wi[t];return null==e&&(Ci||((Ci=document.createElement("div")).innerHTML="M",Ci.style.margin="0 !important",Ci.style.padding="0 !important",Ci.style.position="absolute !important",Ci.style.left="-99999px !important"),Ci.style.font=t,document.body.appendChild(Ci),e=Ci.offsetHeight,wi[t]=e,document.body.removeChild(Ci)),e});function Ei(t,e){var i=xi();return t!=ei&&(i.font=t,ei=i.font),i.measureText(e).width}function Oi(t,e,i){if(e in i)return i[e];var n=Ei(t,e);return i[e]=n}function Ii(t,e,i,n){0!==e&&(t.translate(i,n),t.rotate(e),t.translate(-i,-n))}var Ti=[1,0,0,1,0,0];function Pi(t,e,i,n,r,o,s,a,h,l,u){var c;1!=i&&(c=t.globalAlpha,t.globalAlpha=c*i),e&&t.setTransform.apply(t,e),t.drawImage(n,r,o,s,a,h,l,s*u,a*u),1!=i&&(t.globalAlpha=c),e&&t.setTransform.apply(t,Ti)}var Ri,Li,bi,Fi,Mi,Ai={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},Di=(Ri=function(t,e){return(Ri=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Ri(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Gi=function(i){function t(t){var e=i.call(this)||this;return e.boundHandleImageChange_=e.handleImageChange_.bind(e),e.layer_=t,e}return Di(t,i),t.prototype.getFeatures=function(t){return u()},t.prototype.prepareFrame=function(t){return u()},t.prototype.renderFrame=function(t,e){return u()},t.prototype.loadedTileCallback=function(t,e,i){t[e]||(t[e]={}),t[e][i.tileCoord.toString()]=i},t.prototype.createLoadedTileFinder=function(n,r,o){return function(t,e){var i=this.loadedTileCallback.bind(this,o,t);return n.forEachLoadedTile(r,t,e,i)}.bind(this)},t.prototype.forEachFeatureAtCoordinate=function(t,e,i,n,r){},t.prototype.getDataAtPixel=function(t,e,i){return u()},t.prototype.getLayer=function(){return this.layer_},t.prototype.handleFontsChanged=function(){},t.prototype.handleImageChange_=function(t){t.target.getState()===Ai.LOADED&&this.renderIfReadyAndVisible()},t.prototype.loadImage=function(t){var e=t.getState();return e!=Ai.LOADED&&e!=Ai.ERROR&&t.addEventListener(p.CHANGE,this.boundHandleImageChange_),e==Ai.IDLE&&(t.load(),e=t.getState()),e==Ai.LOADED},t.prototype.renderIfReadyAndVisible=function(){var t=this.getLayer();t.getVisible()&&t.getSourceState()==ht&&t.changed()},t}(I),ki=(Li=function(t,e){return(Li=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Li(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Ni=function(i){function t(t){var e=i.call(this,t)||this;return e.container=null,e.renderedResolution,e.tempTransform_=[1,0,0,1,0,0],e.pixelTransform=[1,0,0,1,0,0],e.inversePixelTransform=[1,0,0,1,0,0],e.context=null,e.containerReused=!1,e.createTransformStringCanvas_=Xe(1,1).canvas,e}return ki(t,i),t.prototype.useContainer=function(t,e,i){var n,r,o=this.getLayer().getClassName();t&&""===t.style.opacity&&t.className===o&&((a=t.firstElementChild)instanceof HTMLCanvasElement&&(r=a.getContext("2d")));if(r&&r.canvas.style.transform===e?(this.container=t,this.context=r,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){(n=document.createElement("div")).className=o;var s=n.style;s.position="absolute",s.width="100%",s.height="100%";var a=(r=Xe()).canvas;n.appendChild(a),(s=a.style).position="absolute",s.left="0",s.transformOrigin="top left",this.container=n,this.context=r}},t.prototype.clip=function(t,e,i){var n=e.pixelRatio,r=e.size[0]*n/2,o=e.size[1]*n/2,s=e.viewState.rotation,a=Bt(i),h=Ht(i),l=Yt(i),u=Wt(i);Ke(e.coordinateToPixelTransform,a),Ke(e.coordinateToPixelTransform,h),Ke(e.coordinateToPixelTransform,l),Ke(e.coordinateToPixelTransform,u),t.save(),Ii(t,-s,r,o),t.beginPath(),t.moveTo(a[0]*n,a[1]*n),t.lineTo(h[0]*n,h[1]*n),t.lineTo(l[0]*n,l[1]*n),t.lineTo(u[0]*n,u[1]*n),t.clip(),Ii(t,s,r,o)},t.prototype.clipUnrotated=function(t,e,i){var n=Bt(i),r=Ht(i),o=Yt(i),s=Wt(i);Ke(e.coordinateToPixelTransform,n),Ke(e.coordinateToPixelTransform,r),Ke(e.coordinateToPixelTransform,o),Ke(e.coordinateToPixelTransform,s);var a=this.inversePixelTransform;Ke(a,n),Ke(a,r),Ke(a,o),Ke(a,s),t.save(),t.beginPath(),t.moveTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.clip()},t.prototype.dispatchRenderEvent_=function(t,e,i){var n=this.getLayer();if(n.hasListener(t)){var r=new He(t,this.inversePixelTransform,i,e);n.dispatchEvent(r)}},t.prototype.preRender=function(t,e){this.dispatchRenderEvent_(rt,t,e)},t.prototype.postRender=function(t,e){this.dispatchRenderEvent_(ot,t,e)},t.prototype.getRenderTransform=function(t,e,i,n,r,o,s){var a=r/2,h=o/2,l=n/e,u=-l,c=-t[0]+s,p=-t[1];return qe(this.tempTransform_,a,h,l,u,-i,c,p)},t.prototype.getDataAtPixel=function(t,e,i){var n,r=Ke(this.inversePixelTransform,t.slice()),o=this.context;try{n=o.getImageData(Math.round(r[0]),Math.round(r[1]),1,1).data}catch(t){return"SecurityError"===t.name?new Uint8Array:n}return 0===n[3]?null:n},t.prototype.createTransformString=function(t){return this.createTransformStringCanvas_.style.transform=Qe(t),this.createTransformStringCanvas_.style.transform},t}(Gi),ji=(bi=function(t,e){return(bi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}bi(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Wi=function(i){function t(t){var e=i.call(this,t)||this;return e.image_=null,e}return ji(t,i),t.prototype.getImage=function(){return this.image_?this.image_.getImage():null},t.prototype.prepareFrame=function(t){var e=t.layerStatesArray[t.layerIndex],i=t.pixelRatio,n=t.viewState,r=n.resolution,o=this.getLayer().getSource(),s=t.viewHints,a=t.extent;if(void 0!==e.extent&&(a=Vt(a,Ye(e.extent,n.projection))),!s[ft]&&!s[gt]&&!qt(a)){var h=n.projection,l=o.getImage(a,r,i,h);l&&this.loadImage(l)&&(this.image_=l)}return!!this.image_},t.prototype.renderFrame=function(t,e){var i=this.image_,n=i.getExtent(),r=i.getResolution(),o=i.getPixelRatio(),s=t.layerStatesArray[t.layerIndex],a=t.pixelRatio,h=t.viewState,l=h.center,u=h.resolution,c=t.size,p=a*r/(u*o),f=Math.round(c[0]*a),d=Math.round(c[1]*a),_=h.rotation;if(_){var g=Math.round(Math.sqrt(f*f+d*d));d=f=g}qe(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/a,1/a,_,-f/2,-d/2),Je(this.inversePixelTransform,this.pixelTransform);var y=this.createTransformString(this.pixelTransform);this.useContainer(e,y,s.opacity);var v=this.context,m=v.canvas;m.width!=f||m.height!=d?(m.width=f,m.height=d):this.containerReused||v.clearRect(0,0,f,d);var x=!1;if(s.extent){var C=Ye(s.extent,h.projection);(x=!St(C,t.extent)&&Kt(C,t.extent))&&this.clipUnrotated(v,t,C)}var w=i.getImage(),S=qe(this.tempTransform_,f/2,d/2,p,p,0,o*(n[0]-l[0])/r,o*(l[1]-n[3])/r);this.renderedResolution=r*a/o;var E=S[4],O=S[5],I=w.width*S[0],T=w.height*S[3];if(this.preRender(v,t),.5<=I&&.5<=T){var P=s.opacity,R=void 0;1!==P&&(R=this.context.globalAlpha,this.context.globalAlpha=P),this.context.drawImage(w,0,0,+w.width,+w.height,Math.round(E),Math.round(O),Math.round(I),Math.round(T)),1!==P&&(this.context.globalAlpha=R)}return this.postRender(v,t),x&&v.restore(),y!==m.style.transform&&(m.style.transform=y),this.container},t}(Ni),Yi=(Fi=function(t,e){return(Fi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Fi(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Xi=function(e){function t(t){return e.call(this,t)||this}return Yi(t,e),t.prototype.createRenderer=function(){return new Wi(this)},t}(pt),zi="preload",Ui="useInterimTilesOnError",Vi=(Mi=function(t,e){return(Mi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Mi(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Bi=function(r){function t(t){var e=this,i=t||{},n=c({},i);return delete n.preload,delete n.useInterimTilesOnError,(e=r.call(this,n)||this).setPreload(void 0!==i.preload?i.preload:0),e.setUseInterimTilesOnError(void 0===i.useInterimTilesOnError||i.useInterimTilesOnError),e}return Vi(t,r),t.prototype.getPreload=function(){return this.get(zi)},t.prototype.setPreload=function(t){this.set(zi,t)},t.prototype.getUseInterimTilesOnError=function(){return this.get(Ui)},t.prototype.setUseInterimTilesOnError=function(t){this.set(Ui,t)},t}(ut),Hi=function(){function t(t,e,i,n){this.minX=t,this.maxX=e,this.minY=i,this.maxY=n}return t.prototype.contains=function(t){return this.containsXY(t[1],t[2])},t.prototype.containsTileRange=function(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY},t.prototype.containsXY=function(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY},t.prototype.equals=function(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY},t.prototype.extend=function(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)},t.prototype.getHeight=function(){return this.maxY-this.minY+1},t.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},t.prototype.getWidth=function(){return this.maxX-this.minX+1},t.prototype.intersects=function(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY},t}();function Zi(t,e,i,n,r){return void 0!==r?(r.minX=t,r.maxX=e,r.minY=i,r.maxY=n,r):new Hi(t,e,i,n)}var Ki,qi=0,Ji=1,Qi=2,$i=3,tn=4,en=5,nn=(Ki=function(t,e){return(Ki=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Ki(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),rn=function(n){function t(t){var e=n.call(this,t)||this;return e.extentChanged=!0,e.renderedExtent_=null,e.renderedPixelRatio,e.renderedProjection=null,e.renderedRevision,e.renderedTiles=[],e.newTiles_=!1,e.tmpExtent=[1/0,1/0,-1/0,-1/0],e.tmpTileRange_=new Hi(0,0,0,0),e}return nn(t,n),t.prototype.isDrawableTile=function(t){var e=this.getLayer(),i=t.getState(),n=e.getUseInterimTilesOnError();return i==Qi||i==tn||i==$i&&!n},t.prototype.getTile=function(t,e,i,n){var r=n.pixelRatio,o=n.viewState.projection,s=this.getLayer(),a=s.getSource().getTile(t,e,i,r,o);return a.getState()==$i&&(s.getUseInterimTilesOnError()?0<s.getPreload()&&(this.newTiles_=!0):a.setState(Qi)),this.isDrawableTile(a)||(a=a.getInterimTile()),a},t.prototype.loadedTileCallback=function(t,e,i){return!!this.isDrawableTile(i)&&n.prototype.loadedTileCallback.call(this,t,e,i)},t.prototype.prepareFrame=function(t){return!!this.getLayer().getSource()},t.prototype.renderFrame=function(t,e){var i=this,n=t.layerStatesArray[t.layerIndex],r=t.viewState,o=r.projection,s=r.resolution,a=r.center,h=r.rotation,l=t.pixelRatio,u=this.getLayer(),c=u.getSource(),p=c.getRevision(),f=c.getTileGridForProjection(o),d=f.getZForResolution(s,c.zDirection),_=f.getResolution(d),g=t.extent,y=n.extent&&Ye(n.extent,o);y&&(g=Vt(g,Ye(n.extent,o)));var v=c.getTilePixelRatio(l),m=Math.round(t.size[0]*v),x=Math.round(t.size[1]*v);if(h){var C=Math.round(Math.sqrt(m*m+x*x));x=m=C}var w=_*m/2/v,S=_*x/2/v,E=[a[0]-w,a[1]-S,a[0]+w,a[1]+S],O=f.getTileRangeForExtentAndZ(g,d),I={};I[d]={};var T=this.createLoadedTileFinder(c,o,I),P=this.tmpExtent,R=this.tmpTileRange_;this.newTiles_=!1;for(var L=O.minX;L<=O.maxX;++L)for(var b=O.minY;b<=O.maxY;++b){var F=i.getTile(d,L,b,t);if(i.isDrawableTile(F)){var M=dt(i);if(F.getState()==Qi){var A=(I[d][F.tileCoord.toString()]=F).inTransition(M);i.newTiles_||!A&&-1!==i.renderedTiles.indexOf(F)||(i.newTiles_=!0)}if(1===F.getAlpha(M,t.time))continue}var D=f.getTileCoordChildTileRange(F.tileCoord,R,P),G=!1;D&&(G=T(d+1,D)),G||f.forEachTileCoordParentTileRange(F.tileCoord,T,R,P)}var k=_/s;qe(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/v,1/v,h,-m/2,-x/2);var N=this.createTransformString(this.pixelTransform);this.useContainer(e,N,n.opacity);var j=this.context,W=j.canvas;Je(this.inversePixelTransform,this.pixelTransform),qe(this.tempTransform_,m/2,x/2,k,k,0,-m/2,-x/2),W.width!=m||W.height!=x?(W.width=m,W.height=x):this.containerReused||j.clearRect(0,0,m,x),y&&this.clipUnrotated(j,t,y),this.preRender(j,t),this.renderedTiles.length=0;var Y,X,z,U=Object.keys(I).map(Number);U.sort(_t),1!==n.opacity||this.containerReused&&!c.getOpaque(t.viewState.projection)?(Y=[],X=[]):U=U.reverse();for(var V=U.length-1;0<=V;--V){var B=U[V],H=c.getTilePixelSize(B,l,o),Z=f.getResolution(B)/_,K=H[0]*Z*k,q=H[1]*Z*k,J=f.getTileCoordForCoordAndZ(Bt(E),B),Q=f.getTileCoordExtent(J),$=Ke(i.tempTransform_,[v*(Q[0]-E[0])/_,v*(E[3]-Q[3])/_]),tt=v*c.getGutterForProjection(o),et=I[B];for(var it in et){var nt=(F=et[it]).tileCoord,rt=$[0]-(J[1]-nt[1])*K,ot=Math.round(rt+K),st=$[1]-(J[2]-nt[2])*q,at=Math.round(st+q),ht=ot-(L=Math.round(rt)),lt=at-(b=Math.round(st)),ut=d===B;if(!(A=ut&&1!==F.getAlpha(dt(i),t.time)))if(Y){j.save(),z=[L,b,L+ht,b,L+ht,b+lt,L,b+lt];for(var ct=0,pt=Y.length;ct<pt;++ct)if(d!==B&&B<X[ct]){var ft=Y[ct];j.beginPath(),j.moveTo(z[0],z[1]),j.lineTo(z[2],z[3]),j.lineTo(z[4],z[5]),j.lineTo(z[6],z[7]),j.moveTo(ft[6],ft[7]),j.lineTo(ft[4],ft[5]),j.lineTo(ft[2],ft[3]),j.lineTo(ft[0],ft[1]),j.clip()}Y.push(z),X.push(B)}else j.clearRect(L,b,ht,lt);i.drawTileImage(F,t,L,b,ht,lt,tt,ut,n.opacity),Y&&!A&&j.restore(),i.renderedTiles.push(F),i.updateUsedTiles(t.usedTiles,c,F)}}return this.renderedRevision=p,this.renderedResolution=_,this.extentChanged=!this.renderedExtent_||!Ft(this.renderedExtent_,E),this.renderedExtent_=E,this.renderedPixelRatio=l,this.renderedProjection=o,this.manageTilePyramid(t,c,f,l,o,g,d,u.getPreload()),this.updateCacheSize_(t,c),this.scheduleExpireCache(t,c),this.postRender(j,t),n.extent&&j.restore(),N!==W.style.transform&&(W.style.transform=N),this.container},t.prototype.drawTileImage=function(t,e,i,n,r,o,s,a,h){var l=this.getTileImage(t);if(l){var u=dt(this),c=a?t.getAlpha(u,e.time):1,p=h*c,f=p!==this.context.globalAlpha;f&&(this.context.save(),this.context.globalAlpha=p),this.context.drawImage(l,s,s,l.width-2*s,l.height-2*s,i,n,r,o),f&&this.context.restore(),1!==c?e.animate=!0:a&&t.endTransition(u)}},t.prototype.getImage=function(){var t=this.context;return t?t.canvas:null},t.prototype.getTileImage=function(t){return t.getImage()},t.prototype.scheduleExpireCache=function(t,e){if(e.canExpireCache()){var i=function(t,e,i){var n=dt(t);n in i.usedTiles&&t.expireCache(i.viewState.projection,i.usedTiles[n])}.bind(null,e);t.postRenderFunctions.push(i)}},t.prototype.updateUsedTiles=function(t,e,i){var n=dt(e);n in t||(t[n]={}),t[n][i.getKey()]=!0},t.prototype.updateCacheSize_=function(t,e){var i=dt(e),n=0;i in t.usedTiles&&(n+=Object.keys(t.usedTiles[i]).length),i in t.wantedTiles&&(n+=Object.keys(t.wantedTiles[i]).length);var r=e.tileCache;r.highWaterMark<n&&(r.highWaterMark=n)},t.prototype.manageTilePyramid=function(t,e,i,n,r,o,s,a,h){var l=dt(e);l in t.wantedTiles||(t.wantedTiles[l]={});var u,c,p,f,d,_,g=t.wantedTiles[l],y=t.tileQueue;for(_=i.getMinZoom();_<=s;++_)for(c=i.getTileRangeForExtentAndZ(o,_,c),p=i.getResolution(_),f=c.minX;f<=c.maxX;++f)for(d=c.minY;d<=c.maxY;++d)s-_<=a?((u=e.getTile(_,f,d,n,r)).getState()==qi&&(g[u.getKey()]=!0,y.isKeyQueued(u.getKey())||y.enqueue([u,l,i.getTileCoordCenter(u.tileCoord),p])),void 0!==h&&h(u)):e.useTile(_,f,d,r)},t}(Ni);rn.prototype.getLayer;var on,sn=(on=function(t,e){return(on=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}on(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),an=function(e){function t(t){return e.call(this,t)||this}return sn(t,e),t.prototype.createRenderer=function(){return new rn(this)},t}(Bi),hn=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,ln=/^([a-z]*)$|^hsla?\(.*\)$/i;var un,cn,pn=(un={},cn=0,function(t){var e;if(un.hasOwnProperty(t))e=un[t];else{if(1024<=cn){var i=0;for(var n in un)0==(3&i++)&&(delete un[n],--cn)}e=function(t){var e,i,n,r,o;if(ln.exec(t)&&(t=function(t){var e=document.createElement("div");if(e.style.color=t,""!==e.style.color){document.body.appendChild(e);var i=getComputedStyle(e).color;return document.body.removeChild(e),i}return""}(t)),hn.exec(t)){var s=t.length-1,a=void 0;a=s<=4?1:2;var h=4===s||8===s;e=parseInt(t.substr(1+0*a,a),16),i=parseInt(t.substr(1+1*a,a),16),n=parseInt(t.substr(1+2*a,a),16),r=h?parseInt(t.substr(1+3*a,a),16):255,1==a&&(e=(e<<4)+e,i=(i<<4)+i,n=(n<<4)+n,h&&(r=(r<<4)+r)),o=[e,i,n,r/255]}else 0==t.indexOf("rgba(")?dn(o=t.slice(5,-1).split(",").map(Number)):0==t.indexOf("rgb(")?((o=t.slice(4,-1).split(",").map(Number)).push(1),dn(o)):Q(!1,14);return o}(t),un[t]=e,++cn}return e});function fn(t){return Array.isArray(t)?t:pn(t)}function dn(t){return t[0]=X(t[0]+.5|0,0,255),t[1]=X(t[1]+.5|0,0,255),t[2]=X(t[2]+.5|0,0,255),t[3]=X(t[3],0,1),t}function _n(t){var e=t[0];e!=(0|e)&&(e=e+.5|0);var i=t[1];i!=(0|i)&&(i=i+.5|0);var n=t[2];return n!=(0|n)&&(n=n+.5|0),"rgba("+e+","+i+","+n+","+(void 0===t[3]?1:t[3])+")"}function gn(t){return Array.isArray(t)?_n(t):t}var yn,vn,mn=function(){function t(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale}return t.prototype.clone=function(){return new t({opacity:this.getOpacity(),scale:this.getScale(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},t.prototype.getOpacity=function(){return this.opacity_},t.prototype.getRotateWithView=function(){return this.rotateWithView_},t.prototype.getRotation=function(){return this.rotation_},t.prototype.getScale=function(){return this.scale_},t.prototype.getAnchor=function(){return u()},t.prototype.getImage=function(t){return u()},t.prototype.getHitDetectionImage=function(t){return u()},t.prototype.getImageState=function(){return u()},t.prototype.getImageSize=function(){return u()},t.prototype.getHitDetectionImageSize=function(){return u()},t.prototype.getOrigin=function(){return u()},t.prototype.getSize=function(){return u()},t.prototype.setOpacity=function(t){this.opacity_=t},t.prototype.setRotateWithView=function(t){this.rotateWithView_=t},t.prototype.setRotation=function(t){this.rotation_=t},t.prototype.setScale=function(t){this.scale_=t},t.prototype.listenImageChange=function(t){u()},t.prototype.load=function(){u()},t.prototype.unlistenImageChange=function(t){u()},t}(),xn=(yn=function(t,e){return(yn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}yn(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Cn=function(n){function e(t){var e=this,i=void 0!==t.rotateWithView&&t.rotateWithView;return(e=n.call(this,{opacity:1,rotateWithView:i,rotation:void 0!==t.rotation?t.rotation:0,scale:1})||this).canvas_=null,e.hitDetectionCanvas_=null,e.fill_=void 0!==t.fill?t.fill:null,e.origin_=[0,0],e.points_=t.points,e.radius_=void 0!==t.radius?t.radius:t.radius1,e.radius2_=t.radius2,e.angle_=void 0!==t.angle?t.angle:0,e.stroke_=void 0!==t.stroke?t.stroke:null,e.anchor_=null,e.size_=null,e.imageSize_=null,e.hitDetectionImageSize_=null,e.render(),e}return xn(e,n),e.prototype.clone=function(){var t=new e({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView()});return t.setOpacity(this.getOpacity()),t.setScale(this.getScale()),t},e.prototype.getAnchor=function(){return this.anchor_},e.prototype.getAngle=function(){return this.angle_},e.prototype.getFill=function(){return this.fill_},e.prototype.getHitDetectionImage=function(t){return this.hitDetectionCanvas_},e.prototype.getImage=function(t){return this.canvas_},e.prototype.getImageSize=function(){return this.imageSize_},e.prototype.getHitDetectionImageSize=function(){return this.hitDetectionImageSize_},e.prototype.getImageState=function(){return Ai.LOADED},e.prototype.getOrigin=function(){return this.origin_},e.prototype.getPoints=function(){return this.points_},e.prototype.getRadius=function(){return this.radius_},e.prototype.getRadius2=function(){return this.radius2_},e.prototype.getSize=function(){return this.size_},e.prototype.getStroke=function(){return this.stroke_},e.prototype.listenImageChange=function(t){},e.prototype.load=function(){},e.prototype.unlistenImageChange=function(t){},e.prototype.render=function(){var t,e=hi,i=ui,n=0,r=null,o=0,s=0;this.stroke_&&(null===(t=this.stroke_.getColor())&&(t=ci),t=gn(t),void 0===(s=this.stroke_.getWidth())&&(s=1),r=this.stroke_.getLineDash(),o=this.stroke_.getLineDashOffset(),void 0===(i=this.stroke_.getLineJoin())&&(i=ui),void 0===(e=this.stroke_.getLineCap())&&(e=hi),void 0===(n=this.stroke_.getMiterLimit())&&(n=10));var a=2*(this.radius_+s)+1,h={strokeStyle:t,strokeWidth:s,size:a,lineCap:e,lineDash:r,lineDashOffset:o,lineJoin:i,miterLimit:n},l=Xe(a,a);this.canvas_=l.canvas;var u=a=this.canvas_.width;this.draw_(h,l,0,0),this.createHitDetectionCanvas_(h),this.anchor_=[a/2,a/2],this.size_=[a,a],this.imageSize_=[u,u]},e.prototype.draw_=function(t,e,i,n){var r,o,s;e.setTransform(1,0,0,1,0,0),e.translate(i,n),e.beginPath();var a=this.points_;if(a===1/0)e.arc(t.size/2,t.size/2,this.radius_,0,2*Math.PI,!0);else{var h=void 0!==this.radius2_?this.radius2_:this.radius_;for(h!==this.radius_&&(a*=2),r=0;r<=a;r++)o=2*r*Math.PI/a-Math.PI/2+this.angle_,s=r%2==0?this.radius_:h,e.lineTo(t.size/2+s*Math.cos(o),t.size/2+s*Math.sin(o))}if(this.fill_){var l=this.fill_.getColor();null===l&&(l=ai),e.fillStyle=gn(l),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,e.setLineDash&&t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke()),e.closePath()},e.prototype.createHitDetectionCanvas_=function(t){if(this.hitDetectionImageSize_=[t.size,t.size],this.hitDetectionCanvas_=this.canvas_,this.fill_){var e=this.fill_.getColor(),i=0;if("string"==typeof e&&(e=fn(e)),null===e?i=1:Array.isArray(e)&&(i=4===e.length?e[3]:1),0===i){var n=Xe(t.size,t.size);this.hitDetectionCanvas_=n.canvas,this.drawHitDetectionCanvas_(t,n,0,0)}}},e.prototype.drawHitDetectionCanvas_=function(t,e,i,n){e.setTransform(1,0,0,1,0,0),e.translate(i,n),e.beginPath();var r=this.points_;if(r===1/0)e.arc(t.size/2,t.size/2,this.radius_,0,2*Math.PI,!0);else{var o=void 0!==this.radius2_?this.radius2_:this.radius_;o!==this.radius_&&(r*=2);var s=void 0,a=void 0,h=void 0;for(s=0;s<=r;s++)h=2*s*Math.PI/r-Math.PI/2+this.angle_,a=s%2==0?this.radius_:o,e.lineTo(t.size/2+a*Math.cos(h),t.size/2+a*Math.sin(h))}e.fillStyle=ai,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.stroke()),e.closePath()},e}(mn),wn=(vn=function(t,e){return(vn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}vn(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Sn=function(i){function e(t){var e=t||{};return i.call(this,{points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke})||this}return wn(e,i),e.prototype.clone=function(){var t=new e({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius()});return t.setOpacity(this.getOpacity()),t.setScale(this.getScale()),t},e.prototype.setRadius=function(t){this.radius_=t,this.render()},e}(Cn),En=function(){function e(t){var e=t||{};this.color_=void 0!==e.color?e.color:null}return e.prototype.clone=function(){var t=this.getColor();return new e({color:Array.isArray(t)?t.slice():t||void 0})},e.prototype.getColor=function(){return this.color_},e.prototype.setColor=function(t){this.color_=t},e}(),On=function(){function e(t){var e=t||{};this.color_=void 0!==e.color?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=void 0!==e.lineDash?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}return e.prototype.clone=function(){var t=this.getColor();return new e({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},e.prototype.getColor=function(){return this.color_},e.prototype.getLineCap=function(){return this.lineCap_},e.prototype.getLineDash=function(){return this.lineDash_},e.prototype.getLineDashOffset=function(){return this.lineDashOffset_},e.prototype.getLineJoin=function(){return this.lineJoin_},e.prototype.getMiterLimit=function(){return this.miterLimit_},e.prototype.getWidth=function(){return this.width_},e.prototype.setColor=function(t){this.color_=t},e.prototype.setLineCap=function(t){this.lineCap_=t},e.prototype.setLineDash=function(t){this.lineDash_=t},e.prototype.setLineDashOffset=function(t){this.lineDashOffset_=t},e.prototype.setLineJoin=function(t){this.lineJoin_=t},e.prototype.setMiterLimit=function(t){this.miterLimit_=t},e.prototype.setWidth=function(t){this.width_=t},e}(),In=function(){function e(t){var e=t||{};this.geometry_=null,this.geometryFunction_=Ln,void 0!==e.geometry&&this.setGeometry(e.geometry),this.fill_=void 0!==e.fill?e.fill:null,this.image_=void 0!==e.image?e.image:null,this.renderer_=void 0!==e.renderer?e.renderer:null,this.stroke_=void 0!==e.stroke?e.stroke:null,this.text_=void 0!==e.text?e.text:null,this.zIndex_=e.zIndex}return e.prototype.clone=function(){var t=this.getGeometry();return t&&"object"==typeof t&&(t=t.clone()),new e({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},e.prototype.getRenderer=function(){return this.renderer_},e.prototype.setRenderer=function(t){this.renderer_=t},e.prototype.getGeometry=function(){return this.geometry_},e.prototype.getGeometryFunction=function(){return this.geometryFunction_},e.prototype.getFill=function(){return this.fill_},e.prototype.setFill=function(t){this.fill_=t},e.prototype.getImage=function(){return this.image_},e.prototype.setImage=function(t){this.image_=t},e.prototype.getStroke=function(){return this.stroke_},e.prototype.setStroke=function(t){this.stroke_=t},e.prototype.getText=function(){return this.text_},e.prototype.setText=function(t){this.text_=t},e.prototype.getZIndex=function(){return this.zIndex_},e.prototype.setGeometry=function(e){"function"==typeof e?this.geometryFunction_=e:"string"==typeof e?this.geometryFunction_=function(t){return t.get(e)}:e?void 0!==e&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=Ln,this.geometry_=e},e.prototype.setZIndex=function(t){this.zIndex_=t},e}();var Tn=null;function Pn(t,e){if(!Tn){var i=new En({color:"rgba(255,255,255,0.4)"}),n=new On({color:"#3399CC",width:1.25});Tn=[new In({image:new Sn({fill:i,stroke:n,radius:5}),fill:i,stroke:n})]}return Tn}function Rn(){var t={},e=[255,255,255,1],i=[0,153,255,1];return t[Qt.POLYGON]=[new In({fill:new En({color:[255,255,255,.5]})})],t[Qt.MULTI_POLYGON]=t[Qt.POLYGON],t[Qt.LINE_STRING]=[new In({stroke:new On({color:e,width:5})}),new In({stroke:new On({color:i,width:3})})],t[Qt.MULTI_LINE_STRING]=t[Qt.LINE_STRING],t[Qt.CIRCLE]=t[Qt.POLYGON].concat(t[Qt.LINE_STRING]),t[Qt.POINT]=[new In({image:new Sn({radius:6,fill:new En({color:i}),stroke:new On({color:e,width:1.5})}),zIndex:1/0})],t[Qt.MULTI_POINT]=t[Qt.POINT],t[Qt.GEOMETRY_COLLECTION]=t[Qt.POLYGON].concat(t[Qt.LINE_STRING],t[Qt.POINT]),t}function Ln(t){return t.getGeometry()}var bn,Fn=(bn=function(t,e){return(bn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}bn(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Mn="renderOrder",An=function(r){function t(t){var e=this,i=t||{},n=c({},i);return delete n.style,delete n.renderBuffer,delete n.updateWhileAnimating,delete n.updateWhileInteracting,(e=r.call(this,n)||this).declutter_=void 0!==i.declutter&&i.declutter,e.renderBuffer_=void 0!==i.renderBuffer?i.renderBuffer:100,e.style_=null,e.styleFunction_=void 0,e.setStyle(i.style),e.updateWhileAnimating_=void 0!==i.updateWhileAnimating&&i.updateWhileAnimating,e.updateWhileInteracting_=void 0!==i.updateWhileInteracting&&i.updateWhileInteracting,e}return Fn(t,r),t.prototype.getDeclutter=function(){return this.declutter_},t.prototype.getFeatures=function(t){return r.prototype.getFeatures.call(this,t)},t.prototype.getRenderBuffer=function(){return this.renderBuffer_},t.prototype.getRenderOrder=function(){return this.get(Mn)},t.prototype.getStyle=function(){return this.style_},t.prototype.getStyleFunction=function(){return this.styleFunction_},t.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},t.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},t.prototype.setRenderOrder=function(t){this.set(Mn,t)},t.prototype.setStyle=function(t){this.style_=void 0!==t?t:Pn,this.styleFunction_=null===t?void 0:function(t){var e;if("function"==typeof t)e=t;else{var i;Array.isArray(t)?i=t:(Q("function"==typeof t.getZIndex,41),i=[t]),e=function(){return i}}return e}(this.style_),this.changed()},t}(ut);function Dn(t,e,i,n,r){for(var o=void 0!==r?r:[],s=0,a=e;a<i;a+=n)o[s++]=t.slice(a,a+n);return o.length=s,o}function Gn(t,e,i,n,r){for(var o=void 0!==r?r:[],s=0,a=0,h=i.length;a<h;++a){var l=i[a];o[s++]=Dn(t,e,l,n,o[s]),e=l}return o.length=s,o}function kn(t,e,i,n,r){for(var o=void 0!==r?r:[],s=0,a=0,h=i.length;a<h;++a){var l=i[a];o[s++]=Gn(t,e,l,n,o[s]),e=l[l.length-1]}return o.length=s,o}var Nn,jn,Wn,Yn=function(){function t(){}return t.prototype.drawCustom=function(t,e,i){},t.prototype.drawGeometry=function(t){},t.prototype.setStyle=function(t){},t.prototype.drawCircle=function(t,e){},t.prototype.drawFeature=function(t,e){},t.prototype.drawGeometryCollection=function(t,e){},t.prototype.drawLineString=function(t,e){},t.prototype.drawMultiLineString=function(t,e){},t.prototype.drawMultiPoint=function(t,e){},t.prototype.drawMultiPolygon=function(t,e){},t.prototype.drawPoint=function(t,e){},t.prototype.drawPolygon=function(t,e){},t.prototype.drawText=function(t,e){},t.prototype.setFillStrokeStyle=function(t,e){},t.prototype.setImageStyle=function(t,e){},t.prototype.setTextStyle=function(t,e){},t}(),Xn=0,zn=1,Un=2,Vn=3,Bn=4,Hn=5,Zn=6,Kn=7,qn=8,Jn=9,Qn=10,$n=11,tr=12,er=[qn],ir=[tr],nr=[zn],rr=[Vn],or=(Nn=function(t,e){return(Nn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Nn(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),sr=function(o){function t(t,e,i,n){var r=o.call(this)||this;return r.tolerance=t,r.maxExtent=e,r.pixelRatio=n,r.maxLineWidth=0,r.resolution=i,r.beginGeometryInstruction1_=null,r.beginGeometryInstruction2_=null,r.bufferedMaxExtent_=null,r.instructions=[],r.coordinates=[],r.tmpCoordinate_=[],r.hitDetectionInstructions=[],r.state={},r}return or(t,o),t.prototype.applyPixelRatio=function(t){var e=this.pixelRatio;return 1==e?t:t.map(function(t){return t*e})},t.prototype.appendFlatCoordinates=function(t,e,i,n,r,o){var s=this,a=this.coordinates.length,h=this.getBufferedMaxExtent();o&&(e+=n);var l,u,c,p=t[e],f=t[e+1],d=this.tmpCoordinate_,_=!0;for(l=e+n;l<i;l+=n)d[0]=t[l],d[1]=t[l+1],(c=Ot(h,d))!==u?(_&&(s.coordinates[a++]=p,s.coordinates[a++]=f),s.coordinates[a++]=d[0],s.coordinates[a++]=d[1],_=!1):c===vt.INTERSECTING?(s.coordinates[a++]=d[0],s.coordinates[a++]=d[1],_=!1):_=!0,p=d[0],f=d[1],u=c;return(r&&_||l===e+n)&&(this.coordinates[a++]=p,this.coordinates[a++]=f),a},t.prototype.drawCustomCoordinates_=function(t,e,i,n,r){for(var o=0,s=i.length;o<s;++o){var a=i[o],h=this.appendFlatCoordinates(t,e,a,n,!1,!1);r.push(h),e=a}return e},t.prototype.drawCustom=function(t,e,i){this.beginGeometry(t,e);var n,r,o,s,a,h=t.getType(),l=t.getStride(),u=this.coordinates.length;if(h==Qt.MULTI_POLYGON){n=(t=t).getOrientedFlatCoordinates(),s=[];for(var c=t.getEndss(),p=a=0,f=c.length;p<f;++p){var d=[];a=this.drawCustomCoordinates_(n,a,c[p],l,d),s.push(d)}this.instructions.push([Bn,u,s,t,i,kn])}else h==Qt.POLYGON||h==Qt.MULTI_LINE_STRING?(o=[],n=h==Qt.POLYGON?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),a=this.drawCustomCoordinates_(n,0,t.getEnds(),l,o),this.instructions.push([Bn,u,o,t,i,Gn])):h==Qt.LINE_STRING||h==Qt.MULTI_POINT?(n=t.getFlatCoordinates(),r=this.appendFlatCoordinates(n,0,n.length,l,!1,!1),this.instructions.push([Bn,u,r,t,i,Dn])):h==Qt.POINT&&(n=t.getFlatCoordinates(),this.coordinates.push(n[0],n[1]),r=this.coordinates.length,this.instructions.push([Bn,u,r,t,i]));this.endGeometry(e)},t.prototype.beginGeometry=function(t,e){var i=t.getExtent();this.beginGeometryInstruction1_=[Xn,e,0,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Xn,e,0,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},t.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}},t.prototype.reverseHitDetectionInstructions=function(){var t,e=this.hitDetectionInstructions;e.reverse();var i,n,r=e.length,o=-1;for(t=0;t<r;++t)(n=(i=e[t])[0])==Kn?o=t:n==Xn&&(i[2]=t,d(this.hitDetectionInstructions,o,t),o=-1)},t.prototype.setFillStrokeStyle=function(t,e){var i=this.state;if(t){var n=t.getColor();i.fillStyle=gn(n||ai)}else i.fillStyle=void 0;if(e){var r=e.getColor();i.strokeStyle=gn(r||ci);var o=e.getLineCap();i.lineCap=void 0!==o?o:hi;var s=e.getLineDash();i.lineDash=s?s.slice():li;var a=e.getLineDashOffset();i.lineDashOffset=a||0;var h=e.getLineJoin();i.lineJoin=void 0!==h?h:ui;var l=e.getWidth();i.lineWidth=void 0!==l?l:1;var u=e.getMiterLimit();i.miterLimit=void 0!==u?u:10,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0},t.prototype.createFill=function(t){var e=t.fillStyle,i=[Qn,e];return"string"!=typeof e&&i.push(!0),i},t.prototype.applyStroke=function(t){this.instructions.push(this.createStroke(t))},t.prototype.createStroke=function(t){return[$n,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]},t.prototype.updateFillStyle=function(t,e){var i=t.fillStyle;"string"==typeof i&&t.currentFillStyle==i||(void 0!==i&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)},t.prototype.updateStrokeStyle=function(t,e){var i=t.strokeStyle,n=t.lineCap,r=t.lineDash,o=t.lineDashOffset,s=t.lineJoin,a=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=n||r!=t.currentLineDash&&!Gt(t.currentLineDash,r)||t.currentLineDashOffset!=o||t.currentLineJoin!=s||t.currentLineWidth!=a||t.currentMiterLimit!=h)&&(void 0!==i&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=n,t.currentLineDash=r,t.currentLineDashOffset=o,t.currentLineJoin=s,t.currentLineWidth=a,t.currentMiterLimit=h)},t.prototype.endGeometry=function(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var e=[Kn,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)},t.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=(e=this.maxExtent,i?(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i):e.slice()),0<this.maxLineWidth)){var t=this.resolution*(this.maxLineWidth+1)/2;xt(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}var e,i;return this.bufferedMaxExtent_},t}(Yn),ar=(jn=function(t,e){return(jn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}jn(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),hr=function(o){function t(t,e,i,n){var r=o.call(this,t,e,i,n)||this;return r.declutterGroups_=null,r.hitDetectionImage_=null,r.image_=null,r.anchorX_=void 0,r.anchorY_=void 0,r.height_=void 0,r.opacity_=void 0,r.originX_=void 0,r.originY_=void 0,r.rotateWithView_=void 0,r.rotation_=void 0,r.scale_=void 0,r.width_=void 0,r}return ar(t,o),t.prototype.drawCoordinates_=function(t,e,i,n){return this.appendFlatCoordinates(t,e,i,n,!1,!1)},t.prototype.drawPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var i=t.getFlatCoordinates(),n=t.getStride(),r=this.coordinates.length,o=this.drawCoordinates_(i,0,i.length,n);this.instructions.push([Zn,r,o,this.image_,this.anchorX_,this.anchorY_,this.declutterGroups_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.width_]),this.hitDetectionInstructions.push([Zn,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroups_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]),this.endGeometry(e)}},t.prototype.drawMultiPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var i=t.getFlatCoordinates(),n=t.getStride(),r=this.coordinates.length,o=this.drawCoordinates_(i,0,i.length,n);this.instructions.push([Zn,r,o,this.image_,this.anchorX_,this.anchorY_,this.declutterGroups_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.width_]),this.hitDetectionInstructions.push([Zn,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroups_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]),this.endGeometry(e)}},t.prototype.finish=function(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,o.prototype.finish.call(this)},t.prototype.setImageStyle=function(t,e){var i=t.getAnchor(),n=t.getSize(),r=t.getHitDetectionImage(1),o=t.getImage(1),s=t.getOrigin();this.anchorX_=i[0],this.anchorY_=i[1],this.declutterGroups_=e,this.hitDetectionImage_=r,this.image_=o,this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScale(),this.width_=n[0]},t}(sr),lr=(Wn=function(t,e){return(Wn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Wn(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),ur=function(r){function t(t,e,i,n){return r.call(this,t,e,i,n)||this}return lr(t,r),t.prototype.drawFlatCoordinates_=function(t,e,i,n){var r=this.coordinates.length,o=this.appendFlatCoordinates(t,e,i,n,!1,!1),s=[Jn,r,o];return this.instructions.push(s),this.hitDetectionInstructions.push(s),i},t.prototype.drawLineString=function(t,e){var i=this.state,n=i.strokeStyle,r=i.lineWidth;if(void 0!==n&&void 0!==r){this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([$n,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],nr);var o=t.getFlatCoordinates(),s=t.getStride();this.drawFlatCoordinates_(o,0,o.length,s),this.hitDetectionInstructions.push(ir),this.endGeometry(e)}},t.prototype.drawMultiLineString=function(t,e){var i=this.state,n=i.strokeStyle,r=i.lineWidth;if(void 0!==n&&void 0!==r){this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([$n,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],nr);for(var o=t.getEnds(),s=t.getFlatCoordinates(),a=t.getStride(),h=0,l=0,u=o.length;l<u;++l)h=this.drawFlatCoordinates_(s,h,o[l],a);this.hitDetectionInstructions.push(ir),this.endGeometry(e)}},t.prototype.finish=function(){var t=this.state;return null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&this.instructions.push(ir),this.reverseHitDetectionInstructions(),this.state=null,r.prototype.finish.call(this)},t.prototype.applyStroke=function(t){null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(ir),t.lastStroke=this.coordinates.length),t.lastStroke=0,r.prototype.applyStroke.call(this,t),this.instructions.push(nr)},t}(sr);function cr(t,e,i,n,r,o,s){var a=(i-e)/n;if(a<3){for(;e<i;e+=n)o[s++]=t[e],o[s++]=t[e+1];return s}var h=new Array(a);h[0]=1,h[a-1]=1;for(var l=[e,i-n],u=0;0<l.length;){for(var c=l.pop(),p=l.pop(),f=0,d=t[p],_=t[p+1],g=t[c],y=t[c+1],v=p+n;v<c;v+=n){var m=U(t[v],t[v+1],d,_,g,y);f<m&&(u=v,f=m)}r<f&&(h[(u-e)/n]=1,p+n<u&&l.push(p,u),u+n<c&&l.push(u,c))}for(v=0;v<a;++v)h[v]&&(o[s++]=t[e+v*n],o[s++]=t[e+v*n+1]);return s}function pr(t,e){return e*Math.round(t/e)}function fr(t,e,i,n,r,o,s){if(e==i)return s;var a,h,l=pr(t[e],r),u=pr(t[e+1],r);e+=n,o[s++]=l,o[s++]=u;do{if(a=pr(t[e],r),h=pr(t[e+1],r),(e+=n)==i)return o[s++]=a,o[s++]=h,s}while(a==l&&h==u);for(;e<i;){var c=pr(t[e],r),p=pr(t[e+1],r);if(e+=n,c!=a||p!=h){var f=a-l,d=h-u,_=c-l,g=p-u;f*g==d*_&&(f<0&&_<f||f==_||0<f&&f<_)&&(d<0&&g<d||d==g||0<d&&d<g)||(l=o[s++]=a,u=o[s++]=h),a=c,h=p}}return o[s++]=a,o[s++]=h,s}function dr(t,e,i,n,r,o,s,a){for(var h=0,l=i.length;h<l;++h){var u=i[h];s=fr(t,e,u,n,r,o,s),a.push(s),e=u}return s}var _r,gr=(_r=function(t,e){return(_r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}_r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),yr=function(r){function t(t,e,i,n){return r.call(this,t,e,i,n)||this}return gr(t,r),t.prototype.drawFlatCoordinatess_=function(t,e,i,n){var r=this,o=this.state,s=void 0!==o.fillStyle,a=void 0!==o.strokeStyle,h=i.length;this.instructions.push(nr),this.hitDetectionInstructions.push(nr);for(var l=0;l<h;++l){var u=i[l],c=r.coordinates.length,p=r.appendFlatCoordinates(t,e,u,n,!0,!a),f=[Jn,c,p];r.instructions.push(f),r.hitDetectionInstructions.push(f),a&&(r.instructions.push(rr),r.hitDetectionInstructions.push(rr)),e=u}return s&&(this.instructions.push(er),this.hitDetectionInstructions.push(er)),a&&(this.instructions.push(ir),this.hitDetectionInstructions.push(ir)),e},t.prototype.drawCircle=function(t,e){var i=this.state,n=i.fillStyle,r=i.strokeStyle;if(void 0!==n||void 0!==r){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([Qn,ai]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([$n,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);var o=t.getFlatCoordinates(),s=t.getStride(),a=this.coordinates.length;this.appendFlatCoordinates(o,0,o.length,s,!1,!1);var h=[Un,a];this.instructions.push(nr,h),this.hitDetectionInstructions.push(nr,h),void 0!==i.fillStyle&&(this.instructions.push(er),this.hitDetectionInstructions.push(er)),void 0!==i.strokeStyle&&(this.instructions.push(ir),this.hitDetectionInstructions.push(ir)),this.endGeometry(e)}},t.prototype.drawPolygon=function(t,e){var i=this.state,n=i.fillStyle,r=i.strokeStyle;if(void 0!==n||void 0!==r){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([Qn,ai]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([$n,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);var o=t.getEnds(),s=t.getOrientedFlatCoordinates(),a=t.getStride();this.drawFlatCoordinatess_(s,0,o,a),this.endGeometry(e)}},t.prototype.drawMultiPolygon=function(t,e){var i=this.state,n=i.fillStyle,r=i.strokeStyle;if(void 0!==n||void 0!==r){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([Qn,ai]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([$n,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);for(var o=t.getEndss(),s=t.getOrientedFlatCoordinates(),a=t.getStride(),h=0,l=0,u=o.length;l<u;++l)h=this.drawFlatCoordinatess_(s,h,o[l],a);this.endGeometry(e)}},t.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var t=this.tolerance;if(0!==t)for(var e=this.coordinates,i=0,n=e.length;i<n;++i)e[i]=pr(e[i],t);return r.prototype.finish.call(this)},t.prototype.setFillStrokeStyles_=function(){var t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.createFill),void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)},t}(sr);function vr(t,e,i,n,r){var o,s,a,h,l,u,c,p,f,d=i,_=i,g=0,y=0,v=i;for(o=i;o<n;o+=r){var m=e[o],x=e[o+1];void 0!==h&&(p=m-h,f=x-l,a=Math.sqrt(p*p+f*f),void 0!==u&&(y+=s,t<Math.acos((u*p+c*f)/(s*a))&&(g<y&&(g=y,d=v,_=o),y=0,v=o-r)),s=a,u=p,c=f),h=m,l=x}return g<(y+=a)?[v,o]:[d,_]}var mr,xr="line",Cr=(mr=function(t,e){return(mr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}mr(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),wr={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},Sr={Circle:yr,Default:sr,Image:hr,LineString:ur,Polygon:yr,Text:function(o){function t(t,e,i,n){var r=o.call(this,t,e,i,n)||this;return r.declutterGroups_,r.labels_=null,r.text_="",r.textOffsetX_=0,r.textOffsetY_=0,r.textRotateWithView_=void 0,r.textRotation_=0,r.textFillState_=null,r.fillStates={},r.textStrokeState_=null,r.strokeStates={},r.textState_={},r.textStates={},r.textKey_="",r.fillKey_="",r.strokeKey_="",_i.prune(),r}return Cr(t,o),t.prototype.finish=function(){var t=o.prototype.finish.call(this);return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t},t.prototype.drawText=function(t,e){var i=this,n=this.textFillState_,r=this.textStrokeState_,o=this.textState_;if(""!==this.text_&&o&&(n||r)){var s,a,h=this.coordinates.length,l=t.getType(),u=null,c=2,p=2;if(o.placement===xr){if(!Kt(this.getBufferedMaxExtent(),t.getExtent()))return;var f=void 0;if(u=t.getFlatCoordinates(),p=t.getStride(),l==Qt.LINE_STRING)f=[u.length];else if(l==Qt.MULTI_LINE_STRING)f=t.getEnds();else if(l==Qt.POLYGON)f=t.getEnds().slice(0,1);else if(l==Qt.MULTI_POLYGON){var d=t.getEndss();for(f=[],s=0,a=d.length;s<a;++s)f.push(d[s][0])}this.beginGeometry(t,e);for(var _=o.textAlign,g=0,y=void 0,v=0,m=f.length;v<m;++v){if(null==_){var x=vr(o.maxAngle,u,g,f[v],p);g=x[0],y=x[1]}else y=f[v];for(s=g;s<y;s+=p)i.coordinates.push(u[s],u[s+1]);c=i.coordinates.length,g=f[v];var C=i.declutterGroups_?0===v?i.declutterGroups_[0]:[].concat(i.declutterGroups_[0]):null;i.drawChars_(h,c,C),h=c}this.endGeometry(e)}else{var w=null;switch(o.overflow||(w=[]),l){case Qt.POINT:case Qt.MULTI_POINT:c=(u=t.getFlatCoordinates()).length;break;case Qt.LINE_STRING:u=t.getFlatMidpoint();break;case Qt.CIRCLE:u=t.getCenter();break;case Qt.MULTI_LINE_STRING:c=(u=t.getFlatMidpoints()).length;break;case Qt.POLYGON:u=t.getFlatInteriorPoint(),o.overflow||w.push(u[2]/this.resolution),p=3;break;case Qt.MULTI_POLYGON:var S=t.getFlatInteriorPoints();for(u=[],s=0,a=S.length;s<a;s+=3)o.overflow||w.push(S[s+2]/i.resolution),u.push(S[s],S[s+1]);if(0==(c=u.length))return}c=this.appendFlatCoordinates(u,0,c,p,!1,!1),this.saveTextStates_(),(o.backgroundFill||o.backgroundStroke)&&(this.setFillStrokeStyle(o.backgroundFill,o.backgroundStroke),o.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),o.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);var E=this.pixelRatio;this.instructions.push([Zn,h,c,null,NaN,NaN,this.declutterGroups_,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,1,NaN,o.padding==di?di:o.padding.map(function(t){return t*E}),!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,w]),this.hitDetectionInstructions.push([Zn,h,c,null,NaN,NaN,this.declutterGroups_,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,1/this.pixelRatio,NaN,o.padding,!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,w]),this.endGeometry(e)}}},t.prototype.saveTextStates_=function(){var t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,n=this.strokeKey_;t&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));var r=this.textKey_;r in this.textStates||(this.textStates[r]={font:e.font,textAlign:e.textAlign||pi,textBaseline:e.textBaseline||fi,scale:e.scale});var o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))},t.prototype.drawChars_=function(t,e,i){var n=this.textStrokeState_,r=this.textState_,o=this.strokeKey_,s=this.textKey_,a=this.fillKey_;this.saveTextStates_();var h=this.pixelRatio,l=wr[r.textBaseline],u=this.textOffsetY_*h,c=this.text_,p=r.scale,f=n?n.lineWidth*p/2:0;this.instructions.push([Hn,t,e,l,i,r.overflow,a,r.maxAngle,h,u,o,f*h,c,s,1]),this.hitDetectionInstructions.push([Hn,t,e,l,i,r.overflow,a,r.maxAngle,1,u,o,f,c,s,1/h])},t.prototype.setTextStyle=function(t,e){var i,n,r;if(t){this.declutterGroups_=e;var o=t.getFill();o?((n=this.textFillState_)||(n={},this.textFillState_=n),n.fillStyle=gn(o.getColor()||ai)):(n=null,this.textFillState_=n);var s=t.getStroke();if(s){(r=this.textStrokeState_)||(r={},this.textStrokeState_=r);var a=s.getLineDash(),h=s.getLineDashOffset(),l=s.getWidth(),u=s.getMiterLimit();r.lineCap=s.getLineCap()||hi,r.lineDash=a?a.slice():li,r.lineDashOffset=void 0===h?0:h,r.lineJoin=s.getLineJoin()||ui,r.lineWidth=void 0===l?1:l,r.miterLimit=void 0===u?10:u,r.strokeStyle=gn(s.getColor()||ci)}else r=null,this.textStrokeState_=r;i=this.textState_;var c=t.getFont()||si;mi(c);var p=t.getScale();i.overflow=t.getOverflow(),i.font=c,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.textBaseline=t.getTextBaseline()||fi,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||di,i.scale=void 0===p?1:p;var f=t.getOffsetX(),d=t.getOffsetY(),_=t.getRotateWithView(),g=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===f?0:f,this.textOffsetY_=void 0===d?0:d,this.textRotateWithView_=void 0!==_&&_,this.textRotation_=void 0===g?0:g,this.strokeKey_=r?("string"==typeof r.strokeStyle?r.strokeStyle:dt(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?"),this.fillKey_=n?"string"==typeof n.fillStyle?n.fillStyle:"|"+dt(n.fillStyle):""}else this.text_=""},t}(sr)},Er=function(){function t(t,e,i,n,r){this.declutter_=r,this.declutterGroups_=null,this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}return t.prototype.addDeclutter=function(t){var e=null;return this.declutter_&&(t?(e=this.declutterGroups_)[0][4]++:(e=[[1/0,1/0,-1/0,-1/0]],(this.declutterGroups_=e)[0].push(1))),e},t.prototype.finish=function(){var t={};for(var e in this.buildersByZIndex_){t[e]=t[e]||{};var i=this.buildersByZIndex_[e];for(var n in i){var r=i[n].finish();t[e][n]=r}}return t},t.prototype.getBuilder=function(t,e){var i=void 0!==t?t.toString():"0",n=this.buildersByZIndex_[i];void 0===n&&(n={},this.buildersByZIndex_[i]=n);var r=n[e];void 0===r&&(r=new Sr[e](this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[e]=r);return r},t}();function Or(t,e,i,n,r,o){for(var s=o||[],a=0,h=e;h<i;h+=n){var l=t[h],u=t[h+1];s[a++]=r[0]*l+r[2]*u+r[4],s[a++]=r[1]*l+r[3]*u+r[5]}return o&&s.length!=a&&(s.length=a),s}function Ir(t,e,i,n,r,o,s){for(var a=s||[],h=Math.cos(r),l=Math.sin(r),u=o[0],c=o[1],p=0,f=e;f<i;f+=n){var d=t[f]-u,_=t[f+1]-c;a[p++]=u+d*h-_*l,a[p++]=c+d*l+_*h;for(var g=f+2;g<f+n;++g)a[p++]=t[g]}return s&&a.length!=p&&(a.length=p),a}function Tr(t,e,i,n,r,o,s){for(var a=s||[],h=0,l=e;l<i;l+=n){a[h++]=t[l]+r,a[h++]=t[l+1]+o;for(var u=l+2;u<l+n;++u)a[h++]=t[u]}return s&&a.length!=h&&(a.length=h),a}var Pr={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"};function Rr(t,e,i,n){for(var r=t[e],o=t[e+1],s=0,a=e+n;a<i;a+=n){var h=t[a],l=t[a+1];s+=Math.sqrt((h-r)*(h-r)+(l-o)*(l-o)),r=h,o=l}return s}function Lr(t,e,i,n,r,o,s,a,h,l,u){for(var c,p,f=[],d=t[e]>t[i-n],_=r.length,g=t[e],y=t[e+1],v=t[e+=n],m=t[e+1],x=0,C=Math.sqrt(Math.pow(v-g,2)+Math.pow(m-y,2)),w=!1,S=0;S<_;++S){for(var E=r[c=d?_-S-1:S],O=a*h(l,E,u),I=o+O/2;e<i-n&&x+C<I;)g=v,y=m,v=t[e+=n],m=t[e+1],x+=C,C=Math.sqrt(Math.pow(v-g,2)+Math.pow(m-y,2));var T=I-x,P=Math.atan2(m-y,v-g);if(d&&(P+=0<P?-Math.PI:Math.PI),void 0!==p){var R=P-p;if(w=w||0!==R,R+=R>Math.PI?-2*Math.PI:R<-Math.PI?2*Math.PI:0,Math.abs(R)>s)return null}p=P;var L=T/C,b=Z(g,v,L),F=Z(y,m,L);f[c]=[b,F,O/2,P,E],o+=O}return w?f:[[f[0][0],f[0][1],f[0][2],f[0][3],r]]}function br(t,e,i,n,r){!function t(e,i,n,r,o){for(;n<r;){if(600<r-n){var s=r-n+1,a=i-n+1,h=Math.log(s),l=.5*Math.exp(2*h/3),u=.5*Math.sqrt(h*l*(s-l)/s)*(a-s/2<0?-1:1),c=Math.max(n,Math.floor(i-a*l/s+u)),p=Math.min(r,Math.floor(i+(s-a)*l/s+u));t(e,i,c,p,o)}var f=e[i],d=n,_=r;for(Fr(e,n,i),0<o(e[r],f)&&Fr(e,n,r);d<_;){for(Fr(e,d,_),d++,_--;o(e[d],f)<0;)d++;for(;0<o(e[_],f);)_--}0===o(e[n],f)?Fr(e,n,_):Fr(e,++_,r),_<=i&&(n=_+1),i<=_&&(r=_-1)}}(t,e,i||0,n||t.length-1,r||Mr)}function Fr(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function Mr(t,e){return t<e?-1:e<t?1:0}var Ar=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function Dr(t,e,i){if(!i)return e.indexOf(t);for(var n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1}function Gr(t,e){kr(t,0,t.children.length,e,t)}function kr(t,e,i,n,r){r||(r=Vr(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var o=e;o<i;o++){var s=t.children[o];Nr(r,t.leaf?n(s):s)}return r}function Nr(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function jr(t,e){return t.minX-e.minX}function Wr(t,e){return t.minY-e.minY}function Yr(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function Xr(t){return t.maxX-t.minX+(t.maxY-t.minY)}function zr(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function Ur(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function Vr(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Br(t,e,i,n,r){for(var o=[e,i];o.length;)if(!((i=o.pop())-(e=o.pop())<=n)){var s=e+Math.ceil((i-e)/n/2)*n;br(t,s,e,i,r),o.push(e,s,s,i)}}Ar.prototype.all=function(){return this._all(this.data,[])},Ar.prototype.search=function(t){var e=this.data,i=[];if(!Ur(t,e))return i;for(var n=this.toBBox,r=[];e;){for(var o=0;o<e.children.length;o++){var s=e.children[o],a=e.leaf?n(s):s;Ur(t,a)&&(e.leaf?i.push(s):zr(t,a)?this._all(s,i):r.push(s))}e=r.pop()}return i},Ar.prototype.collides=function(t){var e=this.data;if(!Ur(t,e))return!1;for(var i=[];e;){for(var n=0;n<e.children.length;n++){var r=e.children[n],o=e.leaf?this.toBBox(r):r;if(Ur(t,o)){if(e.leaf||zr(t,o))return!0;i.push(r)}}e=i.pop()}return!1},Ar.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},Ar.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},Ar.prototype.clear=function(){return this.data=Vr([]),this},Ar.prototype.remove=function(t,e){if(!t)return this;for(var i,n,r,o=this.data,s=this.toBBox(t),a=[],h=[];o||a.length;){if(o||(o=a.pop(),n=a[a.length-1],i=h.pop(),r=!0),o.leaf){var l=Dr(t,o.children,e);if(-1!==l)return o.children.splice(l,1),a.push(o),this._condense(a),this}r||o.leaf||!zr(o,s)?n?(i++,o=n.children[i],r=!1):o=null:(a.push(o),h.push(i),i=0,o=(n=o).children[0])}return this},Ar.prototype.toBBox=function(t){return t},Ar.prototype.compareMinX=function(t,e){return t.minX-e.minX},Ar.prototype.compareMinY=function(t,e){return t.minY-e.minY},Ar.prototype.toJSON=function(){return this.data},Ar.prototype.fromJSON=function(t){return this.data=t,this},Ar.prototype._all=function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},Ar.prototype._build=function(t,e,i,n){var r,o=i-e+1,s=this._maxEntries;if(o<=s)return Gr(r=Vr(t.slice(e,i+1)),this.toBBox),r;n||(n=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,n-1))),(r=Vr([])).leaf=!1,r.height=n;var a=Math.ceil(o/s),h=a*Math.ceil(Math.sqrt(s));Br(t,e,i,h,this.compareMinX);for(var l=e;l<=i;l+=h){var u=Math.min(l+h-1,i);Br(t,l,u,a,this.compareMinY);for(var c=l;c<=u;c+=a){var p=Math.min(c+a-1,u);r.children.push(this._build(t,c,p,n-1))}}return Gr(r,this.toBBox),r},Ar.prototype._chooseSubtree=function(t,e,i,n){for(;n.push(e),!e.leaf&&n.length-1!==i;){for(var r=1/0,o=1/0,s=void 0,a=0;a<e.children.length;a++){var h=e.children[a],l=Yr(h),u=(c=t,p=h,(Math.max(p.maxX,c.maxX)-Math.min(p.minX,c.minX))*(Math.max(p.maxY,c.maxY)-Math.min(p.minY,c.minY))-l);u<o?(o=u,r=l<r?l:r,s=h):u===o&&l<r&&(r=l,s=h)}e=s||e.children[0]}var c,p;return e},Ar.prototype._insert=function(t,e,i){var n=i?t:this.toBBox(t),r=[],o=this._chooseSubtree(n,this.data,e,r);for(o.children.push(t),Nr(o,n);0<=e&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(n,r,e)},Ar.prototype._split=function(t,e){var i=t[e],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);var o=this._chooseSplitIndex(i,r,n),s=Vr(i.children.splice(o,i.children.length-o));s.height=i.height,s.leaf=i.leaf,Gr(i,this.toBBox),Gr(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(i,s)},Ar.prototype._splitRoot=function(t,e){this.data=Vr([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Gr(this.data,this.toBBox)},Ar.prototype._chooseSplitIndex=function(t,e,i){for(var n,r,o,s,a,h,l,u=1/0,c=1/0,p=e;p<=i-e;p++){var f=kr(t,0,p,this.toBBox),d=kr(t,p,i,this.toBBox),_=(r=f,o=d,void 0,s=Math.max(r.minX,o.minX),a=Math.max(r.minY,o.minY),h=Math.min(r.maxX,o.maxX),l=Math.min(r.maxY,o.maxY),Math.max(0,h-s)*Math.max(0,l-a)),g=Yr(f)+Yr(d);_<u?(u=_,n=p,c=g<c?g:c):_===u&&g<c&&(c=g,n=p)}return n||i-e},Ar.prototype._chooseSplitAxis=function(t,e,i){var n=t.leaf?this.compareMinX:jr,r=t.leaf?this.compareMinY:Wr;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,r)&&t.children.sort(n)},Ar.prototype._allDistMargin=function(t,e,i,n){t.children.sort(n);for(var r=this.toBBox,o=kr(t,0,e,r),s=kr(t,i-e,i,r),a=Xr(o)+Xr(s),h=e;h<i-e;h++){var l=t.children[h];Nr(o,t.leaf?r(l):l),a+=Xr(o)}for(var u=i-e-1;e<=u;u--){var c=t.children[u];Nr(s,t.leaf?r(c):c),a+=Xr(s)}return a},Ar.prototype._adjustParentBBoxes=function(t,e,i){for(var n=i;0<=n;n--)Nr(e[n],t)},Ar.prototype._condense=function(t){for(var e=t.length-1,i=void 0;0<=e;e--)0===t[e].children.length?0<e?(i=t[e-1].children).splice(i.indexOf(t[e]),1):this.clear():Gr(t[e],this.toBBox)};var Hr,Zr,Kr=(Hr=function(t,e){return(Hr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Hr(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),qr=[1/0,1/0,-1/0,-1/0],Jr=[1,0,0,1,0,0],Qr=[],$r=[],to=[],eo=[],io=function(o){function t(t,e,i,n){var r=o.call(this)||this;return r.overlaps=i,r.pixelRatio=e,r.resolution=t,r.alignFill_,r.declutterItems=[],r.instructions=n.instructions,r.coordinates=n.coordinates,r.coordinateCache_={},r.renderedTransform_=[1,0,0,1,0,0],r.hitDetectionInstructions=n.hitDetectionInstructions,r.pixelCoordinates_=null,r.viewRotation_=0,r.fillStates=n.fillStates||{},r.strokeStates=n.strokeStates||{},r.textStates=n.textStates||{},r.widths_={},r}return Kr(t,o),t.prototype.disposeInternal=function(){_i.release(this),o.prototype.disposeInternal.call(this)},t.prototype.getTextImage=function(t,e,i,n){var r,o=n+e+t+i+this.pixelRatio;if(!_i.containsKey(o)){var s=n?this.strokeStates[n]:null,a=i?this.fillStates[i]:null,h=this.textStates[e],l=this.pixelRatio,u=h.scale*l,c=wr[h.textAlign||pi],p=n&&s.lineWidth?s.lineWidth:0,f=t.split("\n"),d=f.length,_=[],g=function(t,e,i){for(var n=e.length,r=0,o=0;o<n;++o){var s=Ei(t,e[o]);r=Math.max(r,s),i.push(s)}return r}(h.font,f,_),y=Si(h.font),v=y*d,m=g+p,x=Xe(Math.ceil((m+2)*u),Math.ceil((v+p)*u));r=x.canvas,_i.set(o,r),1!=u&&x.scale(u,u),x.font=h.font,n&&(x.strokeStyle=s.strokeStyle,x.lineWidth=p,x.lineCap=s.lineCap,x.lineJoin=s.lineJoin,x.miterLimit=s.miterLimit,x.setLineDash&&s.lineDash.length&&(x.setLineDash(s.lineDash),x.lineDashOffset=s.lineDashOffset)),i&&(x.fillStyle=a.fillStyle),x.textBaseline="middle",x.textAlign="center";var C=.5-c,w=c*m+C*p,S=void 0;if(n)for(S=0;S<d;++S)x.strokeText(f[S],w+C*_[S],.5*(p+y)+S*y);if(i)for(S=0;S<d;++S)x.fillText(f[S],w+C*_[S],.5*(p+y)+S*y)}return _i.get(o,this)},t.prototype.replayTextBackground_=function(t,e,i,n,r,o,s){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,n),t.lineTo.apply(t,r),t.lineTo.apply(t,e),o&&(this.alignFill_=o[2],this.fill_(t)),s&&(this.setStrokeStyle_(t,s),t.stroke())},t.prototype.replayImage_=function(t,e,i,n,r,o,s,a,h,l,u,c,p,f,d,_,g,y){var v=g||y;e-=r*=p,i-=o*=p;var m=d+l>n.width?n.width-l:d,x=a+u>n.height?n.height-u:a,C=_[3]+m*p+_[1],w=_[0]+x*p+_[2],S=e-_[3],E=i-_[0];(v||0!==c)&&(Qr[0]=S,eo[0]=S,Qr[1]=E,$r[1]=E,$r[0]=S+C,to[0]=$r[0],to[1]=E+w,eo[1]=to[1]);var O=null;if(0!==c){var I=e+r,T=i+o;O=qe(Jr,I,T,1,1,c,-I,-T),Ke(Jr,Qr),Ke(Jr,$r),Ke(Jr,to),Ke(Jr,eo),Tt(Math.min(Qr[0],$r[0],to[0],eo[0]),Math.min(Qr[1],$r[1],to[1],eo[1]),Math.max(Qr[0],$r[0],to[0],eo[0]),Math.max(Qr[1],$r[1],to[1],eo[1]),qr)}else Tt(S,E,S+C,E+w,qr);var P=t.canvas,R=y?y[2]*p/2:0,L=qr[0]-R<=P.width&&0<=qr[2]+R&&qr[1]-R<=P.height&&0<=qr[3]+R;if(f&&(e=Math.round(e),i=Math.round(i)),s){if(!L&&1==s[4])return;Mt(s,qr);var b=L?[t,O?O.slice(0):null,h,n,l,u,m,x,e,i,p]:null;b&&(v&&b.push(g,y,Qr,$r,to,eo),s.push(b))}else L&&(v&&this.replayTextBackground_(t,Qr,$r,to,eo,g,y),Pi(t,O,h,n,l,u,m,x,e,i,p))},t.prototype.fill_=function(t){if(this.alignFill_){var e=Ke(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(e[0]%i,e[1]%i),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()},t.prototype.setStrokeStyle_=function(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.setLineDash&&(t.lineDashOffset=e[7],t.setLineDash(e[6]))},t.prototype.renderDeclutter=function(t,e,i,n){if(t&&5<t.length){var r=t[4];if(1==r||r==t.length-5){var o={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};if(n||(n=new Ar(9)),!n.collides(o)){n.insert(o);for(var s=5,a=t.length;s<a;++s){var h=t[s],l=h[0],u=l.globalAlpha;u!==i&&(l.globalAlpha=i),11<h.length&&this.replayTextBackground_(h[0],h[13],h[14],h[15],h[16],h[11],h[12]),Pi.apply(void 0,h),u!==i&&(l.globalAlpha=u)}}t.length=5,Pt(t)}}return n},t.prototype.drawTextImageWithPointPlacement_=function(t,e,i,n){var r=this.textStates[e],o=this.getTextImage(t,e,n,i),s=this.strokeStates[i],a=this.pixelRatio,h=wr[r.textAlign||pi],l=wr[r.textBaseline||fi],u=s&&s.lineWidth?s.lineWidth:0;return{label:o,anchorX:h*(o.width/a-2*r.scale)+2*(.5-h)*u,anchorY:l*o.height/a+2*(.5-l)*u}},t.prototype.execute_=function(t,e,i,n,r,o){var s,a,h,l=this;this.declutterItems.length=0,this.pixelCoordinates_&&Gt(e,this.renderedTransform_)?s=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),s=Or(this.coordinates,0,this.coordinates.length,2,e,this.pixelCoordinates_),a=this.renderedTransform_,h=e,a[0]=h[0],a[1]=h[1],a[2]=h[2],a[3]=h[3],a[4]=h[4],a[5]=h[5]);for(var u,c,p,f,d,_,g,y,v,m,x,C,w,S,E,O,I,T=0,P=i.length,R=0,L=0,b=0,F=null,M=null,A=this.coordinateCache_,D=this.viewRotation_,G=Math.round(1e12*Math.atan2(-e[1],e[0]))/1e12,k={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:D},N=this.instructions!=i||this.overlaps?0:200;T<P;){var j=i[T];switch(j[0]){case Xn:(E=j[1]).getGeometry()?void 0===o||Kt(o,j[3])?++T:T=j[2]+1:T=j[2];break;case zn:N<L&&(l.fill_(t),L=0),N<b&&(t.stroke(),b=0),L||b||(t.beginPath(),d=f=NaN),++T;break;case Un:var W=s[R=j[1]],Y=s[R+1],X=s[R+2]-W,z=s[R+3]-Y,U=Math.sqrt(X*X+z*z);t.moveTo(W+U,Y),t.arc(W,Y,U,0,2*Math.PI,!0),++T;break;case Vn:t.closePath(),++T;break;case Bn:R=j[1],u=j[2];var V=j[3],B=j[4],H=6==j.length?j[5]:void 0;k.geometry=V,k.feature=E,T in A||(A[T]=[]);var Z=A[T];H?H(s,R,u,2,Z):(Z[0]=s[R],Z[1]=s[R+1],Z.length=2),B(Z,k),++T;break;case Zn:R=j[1],u=j[2],m=j[3],c=j[4],p=j[5],v=r?null:j[6];var K=j[7],q=j[8],J=j[9],Q=j[10],$=j[11],tt=j[12],et=j[13],it=j[14];if(!m&&19<=j.length){x=j[18],C=j[19],w=j[20],S=j[21];var nt=l.drawTextImageWithPointPlacement_(x,C,w,S);m=nt.label,j[3]=m;var rt=j[22];c=(nt.anchorX-rt)*l.pixelRatio,j[4]=c;var ot=j[23];p=(nt.anchorY-ot)*l.pixelRatio,j[5]=p,K=m.height,j[7]=K,it=m.width,j[14]=it}var st=void 0;24<j.length&&(st=j[24]);var at=void 0,ht=void 0,lt=void 0;16<j.length?(at=j[15],ht=j[16],lt=j[17]):(at=di,lt=ht=!1),$&&G?tt+=D:$||G||(tt-=D);for(var ut=0,ct=0;R<u;R+=2)if(!(st&&st[ut++]<it/l.pixelRatio)){if(v){var pt=Math.floor(ct);v.length<pt+1&&((y=[1/0,1/0,-1/0,-1/0]).push(v[0][4]),v.push(y)),y=v[pt]}l.replayImage_(t,s[R],s[R+1],m,c,p,y,K,q,J,Q,tt,et,n,it,at,ht?F:null,lt?M:null),y&&(ct===Math.floor(ct)&&l.declutterItems.push(l,y,E),ct+=1/y[4])}++T;break;case Hn:var ft=j[1],dt=j[2],_t=j[3];y=r?null:j[4];var gt=j[5];S=j[6];var yt=j[7],vt=j[8],mt=j[9];w=j[10];var xt=j[11];x=j[12],C=j[13];var Ct=j[14],wt=l.textStates[C],St=wt.font,Et=wt.scale*vt,Ot=void 0;St in l.widths_?Ot=l.widths_[St]:(Ot={},l.widths_[St]=Ot);var It=Rr(s,ft,dt,2),Tt=Et*Oi(St,x,Ot);if(gt||Tt<=It){var Pt=l.textStates[C].textAlign,Rt=Lr(s,ft,dt,2,x,(It-Tt)*wr[Pt],yt,Et,Oi,St,Ot);if(Rt){var Lt=void 0,bt=void 0,Ft=void 0,Mt=void 0,At=void 0;if(w)for(Lt=0,bt=Rt.length;Lt<bt;++Lt)Ft=(At=Rt[Lt])[4],Mt=l.getTextImage(Ft,C,"",w),c=At[2]+xt,p=_t*Mt.height+2*(.5-_t)*xt-mt,l.replayImage_(t,At[0],At[1],Mt,c,p,y,Mt.height,1,0,0,At[3],Ct,!1,Mt.width,di,null,null);if(S)for(Lt=0,bt=Rt.length;Lt<bt;++Lt)Ft=(At=Rt[Lt])[4],Mt=l.getTextImage(Ft,C,S,""),c=At[2],p=_t*Mt.height-mt,l.replayImage_(t,At[0],At[1],Mt,c,p,y,Mt.height,1,0,0,At[3],Ct,!1,Mt.width,di,null,null)}}l.declutterItems.push(l,y,E),++T;break;case Kn:if(void 0!==r){var Dt=r(E=j[1]);if(Dt)return Dt}++T;break;case qn:N?L++:l.fill_(t),++T;break;case Jn:for(R=j[1],u=j[2],O=s[R],g=(I=s[R+1])+.5|0,(_=O+.5|0)===f&&g===d||(t.moveTo(O,I),f=_,d=g),R+=2;R<u;R+=2)_=(O=s[R])+.5|0,g=(I=s[R+1])+.5|0,R!=u-2&&_===f&&g===d||(t.lineTo(O,I),f=_,d=g);++T;break;case Qn:F=j,l.alignFill_=j[2],L&&(l.fill_(t),L=0,b&&(t.stroke(),b=0)),t.fillStyle=j[1],++T;break;case $n:M=j,b&&(t.stroke(),b=0),l.setStrokeStyle_(t,j),++T;break;case tr:N?b++:t.stroke(),++T;break;default:++T}}L&&this.fill_(t),b&&t.stroke()},t.prototype.execute=function(t,e,i,n){this.viewRotation_=i,this.execute_(t,e,this.instructions,n,void 0,void 0)},t.prototype.executeHitDetection=function(t,e,i,n,r){return this.viewRotation_=i,this.execute_(t,e,this.hitDetectionInstructions,!0,n,r)},t}(r),no=(Zr=function(t,e){return(Zr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Zr(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),ro=[Pr.POLYGON,Pr.CIRCLE,Pr.LINE_STRING,Pr.IMAGE,Pr.TEXT,Pr.DEFAULT],oo=function(a){function t(t,e,i,n,r,o){var s=a.call(this)||this;return s.maxExtent_=t,s.overlaps_=n,s.pixelRatio_=i,s.resolution_=e,s.renderBuffer_=o,s.executorsByZIndex_={},s.hitDetectionContext_=null,s.hitDetectionTransform_=[1,0,0,1,0,0],s.createExecutors_(r),s}return no(t,a),t.prototype.clip=function(t,e){var i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()},t.prototype.createExecutors_=function(t){var e=this;for(var i in t){var n=e.executorsByZIndex_[i];void 0===n&&(n={},e.executorsByZIndex_[i]=n);var r=t[i];for(var o in r){var s=r[o];n[o]=new io(e.resolution_,e.pixelRatio_,e.overlaps_,s)}}},t.prototype.disposeInternal=function(){for(var t in this.executorsByZIndex_){var e=this.executorsByZIndex_[t];for(var i in e)e[i].disposeInternal()}if(this.hitDetectionContext_){var n=this.hitDetectionContext_.canvas;n.width=0,n.height=0}a.prototype.disposeInternal.call(this)},t.prototype.hasExecutors=function(t){for(var e in this.executorsByZIndex_)for(var i=this.executorsByZIndex_[e],n=0,r=t.length;n<r;++n)if(t[n]in i)return!0;return!1},t.prototype.forEachFeatureAtCoordinate=function(t,e,i,n,o,s){var a=2*(n=Math.round(n))+1,r=qe(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-i,-t[0],-t[1]);this.hitDetectionContext_||(this.hitDetectionContext_=Xe(a,a));var h,l=this.hitDetectionContext_;l.canvas.width!==a||l.canvas.height!==a?(l.canvas.width=a,l.canvas.height=a):l.clearRect(0,0,a,a),void 0!==this.renderBuffer_&&(At(h=[1/0,1/0,-1/0,-1/0],t),xt(h,e*(this.renderBuffer_+n),h));var u,c=function(t){if(void 0!==so[t])return so[t];for(var e=2*t+1,i=new Array(e),n=0;n<e;n++)i[n]=new Array(e);var r=t,o=0,s=0;for(;o<=r;)ao(i,t+r,t+o),ao(i,t+o,t+r),ao(i,t-o,t+r),ao(i,t-r,t+o),ao(i,t-r,t-o),ao(i,t-o,t-r),ao(i,t+o,t-r),ao(i,t+r,t-o),0<2*((s+=1+2*++o)-r)+1&&(s+=1-2*(r-=1));return so[t]=i}(n);function p(t){for(var e=l.getImageData(0,0,a,a).data,i=0;i<a;i++)for(var n=0;n<a;n++)if(c[i][n]&&0<e[4*(n*a+i)+3]){var r=void 0;return(!s||u!=Pr.IMAGE&&u!=Pr.TEXT||-1!==s.indexOf(t))&&(r=o(t)),r||void l.clearRect(0,0,a,a)}}var f,d,_,g,y,v=Object.keys(this.executorsByZIndex_).map(Number);for(v.sort(_t),f=v.length-1;0<=f;--f){var m=v[f].toString();for(_=this.executorsByZIndex_[m],d=ro.length-1;0<=d;--d)if(void 0!==(g=_[u=ro[d]])&&(y=g.executeHitDetection(l,r,i,p,h)))return y}},t.prototype.getClipCoords=function(t){var e=this.maxExtent_;if(!e)return null;var i=e[0],n=e[1],r=e[2],o=e[3],s=[i,n,i,o,r,o,r,n];return Or(s,0,8,2,t,s),s},t.prototype.isEmpty=function(){return e(this.executorsByZIndex_)},t.prototype.execute=function(t,e,i,n,r,o){var s=Object.keys(this.executorsByZIndex_).map(Number);s.sort(_t),this.maxExtent_&&(t.save(),this.clip(t,e));var a,h,l,u,c,p,f=r||ro;for(a=0,h=s.length;a<h;++a){var d=s[a].toString();for(c=this.executorsByZIndex_[d],l=0,u=f.length;l<u;++l){var _=f[l];if(void 0!==(p=c[_]))if(!o||_!=Pr.IMAGE&&_!=Pr.TEXT)p.execute(t,e,i,n);else{var g=o[d];g?g.push(p,e.slice(0)):o[d]=[p,e.slice(0)]}}}this.maxExtent_&&t.restore()},t}(r),so={0:[[!0]]};function ao(t,e,i){var n,r=Math.floor(t.length/2);if(r<=e)for(n=r;n<e;n++)t[n][i]=!0;else if(e<r)for(n=e+1;n<r;n++)t[n][i]=!0}var ho=.5,lo={Point:function(t,e,i,n){var r=i.getImage();if(r){if(r.getImageState()!=Ai.LOADED)return;var o=t.getBuilder(i.getZIndex(),Pr.IMAGE);o.setImageStyle(r,t.addDeclutter(!1)),o.drawPoint(e,n)}var s=i.getText();if(s){var a=t.getBuilder(i.getZIndex(),Pr.TEXT);a.setTextStyle(s,t.addDeclutter(!!r)),a.drawText(e,n)}},LineString:function(t,e,i,n){var r=i.getStroke();if(r){var o=t.getBuilder(i.getZIndex(),Pr.LINE_STRING);o.setFillStrokeStyle(null,r),o.drawLineString(e,n)}var s=i.getText();if(s){var a=t.getBuilder(i.getZIndex(),Pr.TEXT);a.setTextStyle(s,t.addDeclutter(!1)),a.drawText(e,n)}},Polygon:function(t,e,i,n){var r=i.getFill(),o=i.getStroke();if(r||o){var s=t.getBuilder(i.getZIndex(),Pr.POLYGON);s.setFillStrokeStyle(r,o),s.drawPolygon(e,n)}var a=i.getText();if(a){var h=t.getBuilder(i.getZIndex(),Pr.TEXT);h.setTextStyle(a,t.addDeclutter(!1)),h.drawText(e,n)}},MultiPoint:function(t,e,i,n){var r=i.getImage();if(r){if(r.getImageState()!=Ai.LOADED)return;var o=t.getBuilder(i.getZIndex(),Pr.IMAGE);o.setImageStyle(r,t.addDeclutter(!1)),o.drawMultiPoint(e,n)}var s=i.getText();if(s){var a=t.getBuilder(i.getZIndex(),Pr.TEXT);a.setTextStyle(s,t.addDeclutter(!!r)),a.drawText(e,n)}},MultiLineString:function(t,e,i,n){var r=i.getStroke();if(r){var o=t.getBuilder(i.getZIndex(),Pr.LINE_STRING);o.setFillStrokeStyle(null,r),o.drawMultiLineString(e,n)}var s=i.getText();if(s){var a=t.getBuilder(i.getZIndex(),Pr.TEXT);a.setTextStyle(s,t.addDeclutter(!1)),a.drawText(e,n)}},MultiPolygon:function(t,e,i,n){var r=i.getFill(),o=i.getStroke();if(o||r){var s=t.getBuilder(i.getZIndex(),Pr.POLYGON);s.setFillStrokeStyle(r,o),s.drawMultiPolygon(e,n)}var a=i.getText();if(a){var h=t.getBuilder(i.getZIndex(),Pr.TEXT);h.setTextStyle(a,t.addDeclutter(!1)),h.drawText(e,n)}},GeometryCollection:function(t,e,i,n){var r,o,s=e.getGeometriesArray();for(r=0,o=s.length;r<o;++r){var a=lo[s[r].getType()];a(t,s[r],i,n)}},Circle:function(t,e,i,n){var r=i.getFill(),o=i.getStroke();if(r||o){var s=t.getBuilder(i.getZIndex(),Pr.CIRCLE);s.setFillStrokeStyle(r,o),s.drawCircle(e,n)}var a=i.getText();if(a){var h=t.getBuilder(i.getZIndex(),Pr.TEXT);h.setTextStyle(a,t.addDeclutter(!1)),h.drawText(e,n)}}};function uo(t,e){return parseInt(dt(t),10)-parseInt(dt(e),10)}function co(t,e){return ho*t/e}function po(t,e,i,n,r,o){var s=!1,a=i.getImage();if(a){var h=a.getImageState();h==Ai.LOADED||h==Ai.ERROR?a.unlistenImageChange(r):(h==Ai.IDLE&&a.load(),h=a.getImageState(),a.listenImageChange(r),s=!0)}return function(t,e,i,n,r){var o=i.getGeometryFunction()(e);if(!o)return;var s=o.simplifyTransformed(n,r);if(i.getRenderer())!function t(e,i,n,r){if(i.getType()==Qt.GEOMETRY_COLLECTION){for(var o=i.getGeometries(),s=0,a=o.length;s<a;++s)t(e,o[s],n,r);return}var h=e.getBuilder(n.getZIndex(),Pr.DEFAULT);h.drawCustom(i,r,n.getRenderer())}(t,s,i,e);else{var a=lo[s.getType()];a(t,s,i,e)}}(t,e,i,n,o),s}var fo,_o,go=(fo=function(t,e){return(fo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}fo(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),yo=[1,0,0,1,0,0],vo=function(s){function t(){var e,i,n,r,o,t=s.call(this)||this;return t.extent_=[1/0,1/0,-1/0,-1/0],t.extentRevision_=-1,t.simplifiedGeometryMaxMinSquaredTolerance=0,t.simplifiedGeometryRevision=0,t.simplifyTransformedInternal=(o=!(e=function(t,e,i){if(!i)return this.getSimplifiedGeometry(e);var n=this.clone();return n.applyTransform(i),n.getSimplifiedGeometry(e)}),function(){var t=Array.prototype.slice.call(arguments);return o&&this===r&&Gt(t,n)||(o=!0,r=this,n=t,i=e.apply(this,arguments)),i}),t}return go(t,s),t.prototype.simplifyTransformed=function(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)},t.prototype.clone=function(){return u()},t.prototype.closestPointXY=function(t,e,i,n){return u()},t.prototype.containsXY=function(t,e){var i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e},t.prototype.getClosestPoint=function(t,e){var i=e||[NaN,NaN];return this.closestPointXY(t[0],t[1],i,1/0),i},t.prototype.intersectsCoordinate=function(t){return this.containsXY(t[0],t[1])},t.prototype.computeExtent=function(t){return u()},t.prototype.getExtent=function(t){return this.extentRevision_!=this.getRevision()&&(this.extent_=this.computeExtent(this.extent_),this.extentRevision_=this.getRevision()),e=this.extent_,(i=t)?(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i):e;var e,i},t.prototype.rotate=function(t,e){u()},t.prototype.scale=function(t,e,i){u()},t.prototype.simplify=function(t){return this.getSimplifiedGeometry(t*t)},t.prototype.getSimplifiedGeometry=function(t){return u()},t.prototype.getType=function(){return u()},t.prototype.applyTransform=function(t){u()},t.prototype.intersectsExtent=function(t){return u()},t.prototype.translate=function(t,e){u()},t.prototype.transform=function(t,s){var a=Ie(t),e=a.getUnits()==ee.TILE_PIXELS?function(t,e,i){var n=a.getExtent(),r=a.getWorldExtent(),o=Ut(r)/Ut(n);return qe(yo,r[0],r[3],o,-o,0,0,0),Or(t,0,t.length,i,yo,e),be(a,s)(t,e,i)}:be(a,s);return this.applyTransform(e),this},t}(L),mo="XY",xo="XYZ",Co="XYM",wo="XYZM",So=(_o=function(t,e){return(_o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}_o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Eo=function(e){function t(){var t=e.call(this)||this;return t.layout=mo,t.stride=2,t.flatCoordinates=null,t}return So(t,e),t.prototype.computeExtent=function(t){return bt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},t.prototype.getCoordinates=function(){return u()},t.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},t.prototype.getFlatCoordinates=function(){return this.flatCoordinates},t.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},t.prototype.getLayout=function(){return this.layout},t.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)},t.prototype.getSimplifiedGeometryInternal=function(t){return this},t.prototype.getStride=function(){return this.stride},t.prototype.setFlatCoordinates=function(t,e){this.stride=Oo(t),this.layout=t,this.flatCoordinates=e},t.prototype.setCoordinates=function(t,e){u()},t.prototype.setLayout=function(t,e,i){var n;if(t)n=Oo(t);else{for(var r=0;r<i;++r){if(0===e.length)return this.layout=mo,void(this.stride=2);e=e[0]}t=function(t){var e;2==t?e=mo:3==t?e=xo:4==t&&(e=wo);return e}(n=e.length)}this.layout=t,this.stride=n},t.prototype.applyTransform=function(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},t.prototype.rotate=function(t,e){var i=this.getFlatCoordinates();if(i){var n=this.getStride();Ir(i,0,i.length,n,t,e,i),this.changed()}},t.prototype.scale=function(t,e,i){var n=e;void 0===n&&(n=t);var r=i;r||(r=Xt(this.getExtent()));var o=this.getFlatCoordinates();if(o){var s=this.getStride();!function(t,e,i,n,r,o,s,a){for(var h=a||[],l=s[0],u=s[1],c=0,p=e;p<i;p+=n){var f=t[p]-l,d=t[p+1]-u;h[c++]=l+r*f,h[c++]=u+o*d;for(var _=p+2;_<p+n;++_)h[c++]=t[_]}a&&h.length!=c&&(h.length=c)}(o,0,o.length,s,t,n,r,o),this.changed()}},t.prototype.translate=function(t,e){var i=this.getFlatCoordinates();if(i){var n=this.getStride();Tr(i,0,i.length,n,t,e,i),this.changed()}},t}(vo);function Oo(t){var e;return t==mo?e=2:t==xo||t==Co?e=3:t==wo&&(e=4),e}var Io,To=(Io=function(t,e){return(Io=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Io(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Po=function(h){function t(t,e,i,n,r,o,s){var a=h.call(this)||this;return a.context_=t,a.pixelRatio_=e,a.extent_=i,a.transform_=n,a.viewRotation_=r,a.squaredTolerance_=o,a.userTransform_=s,a.contextFillState_=null,a.contextStrokeState_=null,a.contextTextState_=null,a.fillState_=null,a.strokeState_=null,a.image_=null,a.imageAnchorX_=0,a.imageAnchorY_=0,a.imageHeight_=0,a.imageOpacity_=0,a.imageOriginX_=0,a.imageOriginY_=0,a.imageRotateWithView_=!1,a.imageRotation_=0,a.imageScale_=0,a.imageWidth_=0,a.text_="",a.textOffsetX_=0,a.textOffsetY_=0,a.textRotateWithView_=!1,a.textRotation_=0,a.textScale_=0,a.textFillState_=null,a.textStrokeState_=null,a.textState_=null,a.pixelCoordinates_=[],a.tmpLocalTransform_=[1,0,0,1,0,0],a}return To(t,h),t.prototype.drawImages_=function(t,e,i,n){var r=this;if(this.image_){var o=Or(t,e,i,2,this.transform_,this.pixelCoordinates_),s=this.context_,a=this.tmpLocalTransform_,h=s.globalAlpha;1!=this.imageOpacity_&&(s.globalAlpha=h*this.imageOpacity_);var l=this.imageRotation_;this.imageRotateWithView_&&(l+=this.viewRotation_);for(var u=0,c=o.length;u<c;u+=2){var p=o[u]-r.imageAnchorX_,f=o[u+1]-r.imageAnchorY_;if(0!==l||1!=r.imageScale_){var d=p+r.imageAnchorX_,_=f+r.imageAnchorY_;qe(a,d,_,r.imageScale_,r.imageScale_,l,-d,-_),s.setTransform.apply(s,a)}s.drawImage(r.image_,r.imageOriginX_,r.imageOriginY_,r.imageWidth_,r.imageHeight_,p,f,r.imageWidth_,r.imageHeight_)}0===l&&1==this.imageScale_||s.setTransform(1,0,0,1,0,0),1!=this.imageOpacity_&&(s.globalAlpha=h)}},t.prototype.drawText_=function(t,e,i,n){var r=this;if(this.textState_&&""!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var o=Or(t,e,i,n,this.transform_,this.pixelCoordinates_),s=this.context_,a=this.textRotation_;for(this.textRotateWithView_&&(a+=this.viewRotation_);e<i;e+=n){var h=o[e]+r.textOffsetX_,l=o[e+1]+r.textOffsetY_;if(0!==a||1!=r.textScale_){var u=qe(r.tmpLocalTransform_,h,l,r.textScale_,r.textScale_,a,-h,-l);s.setTransform.apply(s,u)}r.textStrokeState_&&s.strokeText(r.text_,h,l),r.textFillState_&&s.fillText(r.text_,h,l)}0===a&&1==this.textScale_||s.setTransform(1,0,0,1,0,0)}},t.prototype.moveToLineTo_=function(t,e,i,n,r){var o=this.context_,s=Or(t,e,i,n,this.transform_,this.pixelCoordinates_);o.moveTo(s[0],s[1]);var a=s.length;r&&(a-=2);for(var h=2;h<a;h+=2)o.lineTo(s[h],s[h+1]);return r&&o.closePath(),i},t.prototype.drawRings_=function(t,e,i,n){for(var r=0,o=i.length;r<o;++r)e=this.moveToLineTo_(t,e,i[r],n,!0);return e},t.prototype.drawCircle=function(t){if(Kt(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=function(t,e,i){var n=t.getFlatCoordinates();if(n){var r=t.getStride();return Or(n,0,n.length,r,e,i)}return null}(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],n=e[3]-e[1],r=Math.sqrt(i*i+n*n),o=this.context_;o.beginPath(),o.arc(e[0],e[1],r,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}""!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}},t.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())},t.prototype.setTransform=function(t){this.transform_=t},t.prototype.drawGeometry=function(t){switch(t.getType()){case Qt.POINT:this.drawPoint(t);break;case Qt.LINE_STRING:this.drawLineString(t);break;case Qt.POLYGON:this.drawPolygon(t);break;case Qt.MULTI_POINT:this.drawMultiPoint(t);break;case Qt.MULTI_LINE_STRING:this.drawMultiLineString(t);break;case Qt.MULTI_POLYGON:this.drawMultiPolygon(t);break;case Qt.GEOMETRY_COLLECTION:this.drawGeometryCollection(t);break;case Qt.CIRCLE:this.drawCircle(t)}},t.prototype.drawFeature=function(t,e){var i=e.getGeometryFunction()(t);i&&Kt(this.extent_,i.getExtent())&&(this.setStyle(e),this.drawGeometry(i))},t.prototype.drawGeometryCollection=function(t){for(var e=t.getGeometriesArray(),i=0,n=e.length;i<n;++i)this.drawGeometry(e[i])},t.prototype.drawPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)},t.prototype.drawMultiPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)},t.prototype.drawLineString=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Kt(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(""!==this.text_){var n=t.getFlatMidpoint();this.drawText_(n,0,2,2)}}},t.prototype.drawMultiLineString=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getExtent();if(Kt(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var i=this.context_,n=t.getFlatCoordinates(),r=0,o=t.getEnds(),s=t.getStride();i.beginPath();for(var a=0,h=o.length;a<h;++a)r=this.moveToLineTo_(n,r,o[a],s,!1);i.stroke()}if(""!==this.text_){var l=t.getFlatMidpoints();this.drawText_(l,0,l.length,2)}}},t.prototype.drawPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Kt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){var i=t.getFlatInteriorPoint();this.drawText_(i,0,2,2)}}},t.prototype.drawMultiPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Kt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_,i=t.getOrientedFlatCoordinates(),n=0,r=t.getEndss(),o=t.getStride();e.beginPath();for(var s=0,a=r.length;s<a;++s){var h=r[s];n=this.drawRings_(i,n,h,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){var l=t.getFlatInteriorPoints();this.drawText_(l,0,l.length,2)}}},t.prototype.setContextFillState_=function(t){var e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})},t.prototype.setContextStrokeState_=function(t){var e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),e.setLineDash&&(Gt(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset)),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})},t.prototype.setContextTextState_=function(t){var e=this.context_,i=this.contextTextState_,n=t.textAlign?t.textAlign:pi;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=n&&(i.textAlign=n,e.textAlign=n),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})},t.prototype.setFillStrokeStyle=function(t,e){if(t){var i=t.getColor();this.fillState_={fillStyle:gn(i||ai)}}else this.fillState_=null;if(e){var n=e.getColor(),r=e.getLineCap(),o=e.getLineDash(),s=e.getLineDashOffset(),a=e.getLineJoin(),h=e.getWidth(),l=e.getMiterLimit();this.strokeState_={lineCap:void 0!==r?r:hi,lineDash:o||li,lineDashOffset:s||0,lineJoin:void 0!==a?a:ui,lineWidth:this.pixelRatio_*(void 0!==h?h:1),miterLimit:void 0!==l?l:10,strokeStyle:gn(n||ci)}}else this.strokeState_=null},t.prototype.setImageStyle=function(t){if(t){var e=t.getAnchor(),i=t.getImage(1),n=t.getOrigin(),r=t.getSize();this.imageAnchorX_=e[0],this.imageAnchorY_=e[1],this.imageHeight_=r[1],this.image_=i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=n[0],this.imageOriginY_=n[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation(),this.imageScale_=t.getScale()*this.pixelRatio_,this.imageWidth_=r[0]}else this.image_=null},t.prototype.setTextStyle=function(t){if(t){var e=t.getFill();if(e){var i=e.getColor();this.textFillState_={fillStyle:gn(i||ai)}}else this.textFillState_=null;var n=t.getStroke();if(n){var r=n.getColor(),o=n.getLineCap(),s=n.getLineDash(),a=n.getLineDashOffset(),h=n.getLineJoin(),l=n.getWidth(),u=n.getMiterLimit();this.textStrokeState_={lineCap:void 0!==o?o:hi,lineDash:s||li,lineDashOffset:a||0,lineJoin:void 0!==h?h:ui,lineWidth:void 0!==l?l:1,miterLimit:void 0!==u?u:10,strokeStyle:gn(r||ci)}}else this.textStrokeState_=null;var c=t.getFont(),p=t.getOffsetX(),f=t.getOffsetY(),d=t.getRotateWithView(),_=t.getRotation(),g=t.getScale(),y=t.getText(),v=t.getTextAlign(),m=t.getTextBaseline();this.textState_={font:void 0!==c?c:si,textAlign:void 0!==v?v:pi,textBaseline:void 0!==m?m:fi},this.text_=void 0!==y?y:"",this.textOffsetX_=void 0!==p?this.pixelRatio_*p:0,this.textOffsetY_=void 0!==f?this.pixelRatio_*f:0,this.textRotateWithView_=void 0!==d&&d,this.textRotation_=void 0!==_?_:0,this.textScale_=this.pixelRatio_*(void 0!==g?g:1)}else this.text_=""},t}(Yn),Ro="fraction",Lo="pixels";function bo(t,e,i){var n;return e+":"+t+":"+(i?"string"==typeof(n=i)?n:_n(n):"null")}var Fo,Mo,Ao=new(function(){function t(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}return t.prototype.clear=function(){this.cache_={},this.cacheSize_=0},t.prototype.canExpireCache=function(){return this.cacheSize_>this.maxCacheSize_},t.prototype.expire=function(){if(this.canExpireCache()){var t=0;for(var e in this.cache_){var i=this.cache_[e];0!=(3&t++)||i.hasListener()||(delete this.cache_[e],--this.cacheSize_)}}},t.prototype.get=function(t,e,i){var n=bo(t,e,i);return n in this.cache_?this.cache_[n]:null},t.prototype.set=function(t,e,i,n){var r=bo(t,e,i);this.cache_[r]=n,++this.cacheSize_},t.prototype.setSize=function(t){this.maxCacheSize_=t,this.expire()},t}()),Do=(Fo=function(t,e){return(Fo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Fo(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Go=function(o){function t(t,e,i,n){var r=o.call(this)||this;return r.extent=t,r.pixelRatio_=i,r.resolution=e,r.state=n,r}return Do(t,o),t.prototype.changed=function(){this.dispatchEvent(p.CHANGE)},t.prototype.getExtent=function(){return this.extent},t.prototype.getImage=function(){return u()},t.prototype.getPixelRatio=function(){return this.pixelRatio_},t.prototype.getResolution=function(){return this.resolution},t.prototype.getState=function(){return this.state},t.prototype.load=function(){u()},t}(E),ko="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",No=-1!==ko.indexOf("firefox"),jo=(-1!==ko.indexOf("safari")&&ko.indexOf("chrom"),-1!==ko.indexOf("webkit")&&-1==ko.indexOf("edge")),Wo=-1!==ko.indexOf("macintosh"),Yo=window.devicePixelRatio||1,Xo="undefined"!=typeof Image&&Image.prototype.decode,zo=(Mo=function(t,e){return(Mo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Mo(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Uo=function(a){function t(t,e,i,n,r,o){var s=a.call(this,t,e,i,Ai.IDLE)||this;return s.src_=n,s.image_=new Image,null!==r&&(s.image_.crossOrigin=r),s.unlisten_=null,s.state=Ai.IDLE,s.imageLoadFunction_=o,s}return zo(t,a),t.prototype.getImage=function(){return this.image_},t.prototype.handleImageError_=function(){this.state=Ai.ERROR,this.unlistenImage_(),this.changed()},t.prototype.handleImageLoad_=function(){void 0===this.resolution&&(this.resolution=Ut(this.extent)/this.image_.height),this.state=Ai.LOADED,this.unlistenImage_(),this.changed()},t.prototype.load=function(){this.state!=Ai.IDLE&&this.state!=Ai.ERROR||(this.state=Ai.LOADING,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=Vo(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},t.prototype.setImage=function(t){this.image_=t},t.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},t}(Go);function Vo(t,e,i){var n=t;if(n.src&&Xo){var r=n.decode(),o=!0;return r.then(function(){o&&e()}).catch(function(t){o&&("EncodingError"===t.name&&"Invalid image type."===t.message?e():i())}),function(){o=!1}}var s=[h(n,p.LOAD,e),h(n,p.ERROR,i)];return function(){s.forEach(l)}}var Bo,Ho=(Bo=function(t,e){return(Bo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Bo(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Zo=function(a){function t(t,e,i,n,r,o){var s=a.call(this)||this;return s.hitDetectionImage_=null,s.image_=t||new Image,null!==n&&(s.image_.crossOrigin=n),s.canvas_=o?document.createElement("canvas"):null,s.color_=o,s.unlisten_=null,s.imageState_=r,s.size_=i,s.src_=e,s.tainted_,s}return Ho(t,a),t.prototype.isTainted_=function(){if(void 0===this.tainted_&&this.imageState_===Ai.LOADED){this.tainted_=!1;var t=Xe(1,1);try{t.drawImage(this.image_,0,0),t.getImageData(0,0,1,1)}catch(t){this.tainted_=!0}}return!0===this.tainted_},t.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(p.CHANGE)},t.prototype.handleImageError_=function(){this.imageState_=Ai.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},t.prototype.handleImageLoad_=function(){this.imageState_=Ai.LOADED,this.size_&&(this.image_.width=this.size_[0],this.image_.height=this.size_[1]),this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.replaceColor_(),this.dispatchChangeEvent_()},t.prototype.getImage=function(t){return this.canvas_?this.canvas_:this.image_},t.prototype.getImageState=function(){return this.imageState_},t.prototype.getHitDetectionImage=function(t){if(!this.hitDetectionImage_)if(this.isTainted_()){var e=this.size_[0],i=this.size_[1],n=Xe(e,i);n.fillRect(0,0,e,i),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},t.prototype.getSize=function(){return this.size_},t.prototype.getSrc=function(){return this.src_},t.prototype.load=function(){if(this.imageState_==Ai.IDLE){this.imageState_=Ai.LOADING;try{this.image_.src=this.src_}catch(t){this.handleImageError_()}this.unlisten_=Vo(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}},t.prototype.replaceColor_=function(){if(this.color_&&!this.isTainted_()){this.canvas_.width=this.image_.width,this.canvas_.height=this.image_.height;var t=this.canvas_.getContext("2d");t.drawImage(this.image_,0,0);for(var e=t.getImageData(0,0,this.image_.width,this.image_.height),i=e.data,n=this.color_[0]/255,r=this.color_[1]/255,o=this.color_[2]/255,s=0,a=i.length;s<a;s+=4)i[s]*=n,i[s+1]*=r,i[s+2]*=o;t.putImageData(e,0,0)}},t.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},t}(E);var Ko,qo="bottom-left",Jo="bottom-right",Qo="top-left",$o="top-right",ts=(Ko=function(t,e){return(Ko=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Ko(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),es=function(v){function t(t){var e=this,i=t||{},n=void 0!==i.opacity?i.opacity:1,r=void 0!==i.rotation?i.rotation:0,o=void 0!==i.scale?i.scale:1,s=void 0!==i.rotateWithView&&i.rotateWithView;(e=v.call(this,{opacity:n,rotation:r,scale:o,rotateWithView:s})||this).anchor_=void 0!==i.anchor?i.anchor:[.5,.5],e.normalizedAnchor_=null,e.anchorOrigin_=void 0!==i.anchorOrigin?i.anchorOrigin:Qo,e.anchorXUnits_=void 0!==i.anchorXUnits?i.anchorXUnits:Ro,e.anchorYUnits_=void 0!==i.anchorYUnits?i.anchorYUnits:Ro,e.crossOrigin_=void 0!==i.crossOrigin?i.crossOrigin:null;var a=void 0!==i.img?i.img:null,h=void 0!==i.imgSize?i.imgSize:null,l=i.src;Q(!(void 0!==l&&a),4),Q(!a||a&&h,5),void 0!==l&&0!==l.length||!a||(l=a.src||dt(a)),Q(void 0!==l&&0<l.length,6);var u,c,p,f,d,_,g,y=void 0!==i.src?Ai.IDLE:Ai.LOADED;return e.color_=void 0!==i.color?fn(i.color):null,e.iconImage_=(u=a,c=l,p=h,f=e.crossOrigin_,d=y,_=e.color_,(g=Ao.get(c,f,_))||(g=new Zo(u,c,p,f,d,_),Ao.set(c,f,_,g)),g),e.offset_=void 0!==i.offset?i.offset:[0,0],e.offsetOrigin_=void 0!==i.offsetOrigin?i.offsetOrigin:Qo,e.origin_=null,e.size_=void 0!==i.size?i.size:null,e}return ts(t,v),t.prototype.clone=function(){return new t({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:null!==this.size_?this.size_.slice():void 0,opacity:this.getOpacity(),scale:this.getScale(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},t.prototype.getAnchor=function(){if(this.normalizedAnchor_)return this.normalizedAnchor_;var t=this.anchor_,e=this.getSize();if(this.anchorXUnits_==Ro||this.anchorYUnits_==Ro){if(!e)return null;t=this.anchor_.slice(),this.anchorXUnits_==Ro&&(t[0]*=e[0]),this.anchorYUnits_==Ro&&(t[1]*=e[1])}if(this.anchorOrigin_!=Qo){if(!e)return null;t===this.anchor_&&(t=this.anchor_.slice()),this.anchorOrigin_!=$o&&this.anchorOrigin_!=Jo||(t[0]=-t[0]+e[0]),this.anchorOrigin_!=qo&&this.anchorOrigin_!=Jo||(t[1]=-t[1]+e[1])}return this.normalizedAnchor_=t,this.normalizedAnchor_},t.prototype.setAnchor=function(t){this.anchor_=t,this.normalizedAnchor_=null},t.prototype.getColor=function(){return this.color_},t.prototype.getImage=function(t){return this.iconImage_.getImage(t)},t.prototype.getImageSize=function(){return this.iconImage_.getSize()},t.prototype.getHitDetectionImageSize=function(){return this.getImageSize()},t.prototype.getImageState=function(){return this.iconImage_.getImageState()},t.prototype.getHitDetectionImage=function(t){return this.iconImage_.getHitDetectionImage(t)},t.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var t=this.offset_;if(this.offsetOrigin_!=Qo){var e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),this.offsetOrigin_!=$o&&this.offsetOrigin_!=Jo||(t[0]=i[0]-e[0]-t[0]),this.offsetOrigin_!=qo&&this.offsetOrigin_!=Jo||(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_},t.prototype.getSrc=function(){return this.iconImage_.getSrc()},t.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},t.prototype.listenImageChange=function(t){this.iconImage_.addEventListener(p.CHANGE,t)},t.prototype.load=function(){this.iconImage_.load()},t.prototype.unlistenImageChange=function(t){this.iconImage_.removeEventListener(p.CHANGE,t)},t}(mn);function is(t,e,i){var n=[];if(i){var r=4*(Math.round(t[0]/2)+Math.round(t[1]/2)*i.width),o=i.data[r],s=i.data[r+1],a=i.data[r+2]+256*(s+256*o),h=Math.ceil(16777216/e.length);a%h==0&&n.push(e[a/h])}return n}var ns,rs,os=(ns=function(t,e){return(ns=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}ns(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),ss=function(n){function t(t){var e=n.call(this,t)||this;return e.boundHandleStyleImageChange_=e.handleStyleImageChange_.bind(e),e.animatingOrInteracting_,e.dirty_=!1,e.hitDetectionImageData_=null,e.renderedFeatures_=null,e.renderedRevision_=-1,e.renderedResolution_=NaN,e.renderedExtent_=[1/0,1/0,-1/0,-1/0],e.renderedRotation_,e.renderedCenter_=null,e.renderedProjection_=null,e.renderedRenderOrder_=null,e.replayGroup_=null,e.replayGroupChanged=!0,e}return os(t,n),t.prototype.useContainer=function(t,e,i){i<1&&(t=null),n.prototype.useContainer.call(this,t,e,i)},t.prototype.renderFrame=function(t,e){var i,n,r,o,s,a,h,l,u=t.pixelRatio,c=t.layerStatesArray[t.layerIndex];i=this.pixelTransform,r=1/u,a=1/u,(n=i)[l=h=s=o=0]=r,n[1]=o,n[2]=s,n[3]=a,n[4]=h,n[5]=l,Je(this.inversePixelTransform,this.pixelTransform);var p=Qe(this.pixelTransform);this.useContainer(e,p,c.opacity);var f=this.context,d=f.canvas,_=this.replayGroup_;if(!_||_.isEmpty())return!this.containerReused&&0<d.width&&(d.width=0),this.container;var g=Math.round(t.size[0]*u),y=Math.round(t.size[1]*u);d.width!=g||d.height!=y?(d.width=g,d.height=y,d.style.transform!==p&&(d.style.transform=p)):this.containerReused||f.clearRect(0,0,g,y),this.preRender(f,t);var v=t.extent,m=t.viewState,x=m.center,C=m.resolution,w=m.projection,S=m.rotation,E=w.getExtent(),O=this.getLayer().getSource(),I=!1;if(c.extent){var T=Ye(c.extent,w);(I=!St(T,t.extent)&&Kt(T,t.extent))&&this.clip(f,t,T)}var P=t.viewHints,R=!(P[ft]||P[gt]),L=this.getRenderTransform(x,C,S,u,g,y,0),b=this.getLayer().getDeclutter()?{}:null;if(_.execute(f,L,S,R,void 0,b),O.getWrapX()&&w.canWrapX()&&!St(E,v)){for(var F=v[0],M=Zt(E),A=0,D=void 0;F<E[0];){D=M*--A;var G=this.getRenderTransform(x,C,S,u,g,y,D);_.execute(f,G,S,R,void 0,b),F+=M}for(A=0,F=v[2];F>E[2];){D=M*++A;var k=this.getRenderTransform(x,C,S,u,g,y,D);_.execute(f,k,S,R,void 0,b),F-=M}}if(b){var N=t.viewHints;!function(t,e,i,n,r,o){for(var s=Object.keys(t).map(Number).sort(_t),a=0,h=s.length;a<h;++a)for(var l=t[s[a].toString()],u=void 0,c=0,p=l.length;c<p;){var f=l[c++];f!==u&&(u=f,o.push({items:f.declutterItems,opacity:n}));var d=l[c++];f.execute(e,d,i,r)}}(b,f,S,1,!(N[ft]||N[gt]),t.declutterItems)}I&&f.restore(),this.postRender(f,t);var j=c.opacity,W=this.container;return j!==parseFloat(W.style.opacity)&&(W.style.opacity=1===j?"":j),this.container},t.prototype.getFeatures=function(y){return new Promise(function(g,t){this.hitDetectionImageData_||this.animatingOrInteracting_?g(is(y,this.renderedFeatures_,this.hitDetectionImageData_)):requestAnimationFrame(function(){var t=[this.context.canvas.width,this.context.canvas.height];Ke(this.pixelTransform,t);var e=this.renderedCenter_,i=this.renderedResolution_,n=this.renderedRotation_,r=this.renderedProjection_,o=this.renderedExtent_,s=this.getLayer(),a=[],h=t[0]/2,l=t[1]/2;a.push(this.getRenderTransform(e,i,n,.5,h,l,0).slice());var u=s.getSource(),c=r.getExtent();if(u.getWrapX()&&r.canWrapX()&&!St(c,o)){for(var p=o[0],f=Zt(c),d=0,_=void 0;p<c[0];)_=f*--d,a.push(this.getRenderTransform(e,i,n,.5,h,l,_).slice()),p+=f;for(d=0,p=o[2];p>c[2];)_=f*++d,a.push(this.getRenderTransform(e,i,n,.5,h,l,_).slice()),p-=f}this.hitDetectionImageData_=function(t,e,i,n,r,o,s){var a=Xe(t[0]/2,t[1]/2);a.imageSmoothingEnabled=!1;for(var h=a.canvas,l=new Po(a,.5,r,null,s),u=i.length,c=Math.ceil(16777216/u),p={},f=0;f<u;++f){var d=i[f],_=d.getStyleFunction()||n;if(n){var g=_(d,o);Array.isArray(g)||(g=[g]);for(var y="#"+("000000"+(f*c).toString(16)).slice(-6),v=0,m=g.length;v<m;++v){var x=g[v],C=x.clone(),w=C.getFill();w&&w.setColor(y);var S=C.getStroke();S&&S.setColor(y),C.setText(void 0);var E=x.getImage();if(E){var O=E.getImageSize(),I=document.createElement("canvas");I.width=O[0],I.height=O[1];var T=I.getContext("2d",{alpha:!1});T.fillStyle=y;var P=T.canvas;T.fillRect(0,0,P.width,P.height),Xe(O?O[0]:P.width,O?O[1]:P.height).drawImage(P,0,0),C.setImage(new es({img:P,imgSize:O,anchor:E.getAnchor(),anchorXUnits:Lo,anchorYUnits:Lo,offset:E.getOrigin(),size:E.getSize(),opacity:E.getOpacity(),scale:E.getScale(),rotation:E.getRotation(),rotateWithView:E.getRotateWithView()}))}var R=Number(C.getZIndex());(M=p[R])||(M={},(p[R]=M)[Qt.POLYGON]=[],M[Qt.CIRCLE]=[],M[Qt.LINE_STRING]=[],M[Qt.POINT]=[]);var L=C.getGeometryFunction()(d);L&&Kt(r,L.getExtent())&&M[L.getType().replace("Multi","")].push(L,C)}}}for(var b=Object.keys(p).map(Number).sort(_t),F=(f=0,b.length);f<F;++f){var M=p[b[f]];for(var A in M){var D=M[A];for(v=0,m=D.length;v<m;v+=2){l.setStyle(D[v+1]);for(var G=0,k=e.length;G<k;++G)l.setTransform(e[G]),l.drawGeometry(D[v])}}}return a.getImageData(0,0,h.width,h.height)}(t,a,this.renderedFeatures_,s.getStyleFunction(),o,i,n),g(is(y,this.renderedFeatures_,this.hitDetectionImageData_))}.bind(this))}.bind(this))},t.prototype.forEachFeatureAtCoordinate=function(t,e,i,n,r){if(this.replayGroup_){var o=e.viewState.resolution,s=e.viewState.rotation,a=this.getLayer(),h={};return this.replayGroup_.forEachFeatureAtCoordinate(t,o,s,i,function(t){var e=dt(t);if(!(e in h))return h[e]=!0,n(t,a)},a.getDeclutter()?r:null)}},t.prototype.handleFontsChanged=function(){var t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()},t.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()},t.prototype.prepareFrame=function(t){var r=this.getLayer(),e=r.getSource(),i=t.viewHints[ft],n=t.viewHints[gt],o=r.getUpdateWhileAnimating(),s=r.getUpdateWhileInteracting();if(!this.dirty_&&!o&&i||!s&&n)return this.animatingOrInteracting_=!0;this.animatingOrInteracting_=!1;var a=t.extent,h=t.viewState,l=h.projection,u=h.resolution,c=t.pixelRatio,p=r.getRevision(),f=r.getRenderBuffer(),d=r.getRenderOrder();void 0===d&&(d=uo);var _=h.center.slice(),g=xt(a,f*u),y=h.projection.getExtent();if(e.getWrapX()&&h.projection.canWrapX()&&!St(y,t.extent)){var v=Zt(y),m=Math.max(Zt(g)/2,v);g[0]=y[0]-m,g[2]=y[2]+m;var x=Math.floor((_[0]-y[0])/v);_[0]-=x*v}if(!this.dirty_&&this.renderedResolution_==u&&this.renderedRevision_==p&&this.renderedRenderOrder_==d&&St(this.renderedExtent_,g))return!(this.replayGroupChanged=!1);this.replayGroup_&&this.replayGroup_.dispose(),this.replayGroup_=null,this.dirty_=!1;var C,w=new Er(co(u,c),g,u,c,r.getDeclutter()),S=ke;S?(e.loadFeatures(We(g,l),u,S),C=Le(S,l)):e.loadFeatures(g,u,l);var E,O=(E=co(u,c))*E,I=function(t){var e,i=t.getStyleFunction()||r.getStyleFunction();if(i&&(e=i(t,u)),e){var n=this.renderFeature(t,O,e,w,C);this.dirty_=this.dirty_||n}}.bind(this),T=We(g,l),P=e.getFeaturesInExtent(T);d&&P.sort(d);for(var R=0,L=P.length;R<L;++R)I(P[R]);this.renderedFeatures_=P;var b=w.finish(),F=new oo(g,u,c,e.getOverlaps(),b,r.getRenderBuffer());return this.renderedResolution_=u,this.renderedRevision_=p,this.renderedRenderOrder_=d,this.renderedExtent_=g,this.renderedRotation_=h.rotation,this.renderedCenter_=_,this.renderedProjection_=l,this.replayGroup_=F,this.hitDetectionImageData_=null,this.replayGroupChanged=!0},t.prototype.renderFeature=function(t,e,i,n,r){if(!i)return!1;var o=!1;if(Array.isArray(i))for(var s=0,a=i.length;s<a;++s)o=po(n,t,i[s],e,this.boundHandleStyleImageChange_,r)||o;else o=po(n,t,i,e,this.boundHandleStyleImageChange_,r);return o},t}(Ni),as=(rs=function(t,e){return(rs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}rs(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),hs=function(e){function t(t){return e.call(this,t)||this}return as(t,e),t.prototype.createRenderer=function(){return new ss(this)},t}(An),ls=function(i){function t(t,e){i.call(this,t,e),this.listener=null}return i&&(t.__proto__=i),((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.activate=function(){},t.prototype.deactivate=function(){this.listener&&this.listener.unlisten()},t}(t),us="1.3.0";function cs(t,e,i,n){var r=Fe(i,e,t),o=Te(e,n,i),s=e.getMetersPerUnit();void 0!==s&&(o*=s);var a=t.getMetersPerUnit();void 0!==a&&(o/=a);var h=t.getExtent();if(!h||wt(h,r)){var l=Te(t,o,r)/o;isFinite(l)&&0<l&&(o/=l)}return o}function ps(t,e,i,n){var r=i-t,o=n-e,s=Math.sqrt(r*r+o*o);return[Math.round(i+r/s),Math.round(n+o/s)]}function fs(t,e,O,I,i,T,n,r,o,a,s){var P=Xe(Math.round(O*t),Math.round(O*e));if(0===o.length)return P.canvas;P.scale(O,O);var R=[1/0,1/0,-1/0,-1/0];o.forEach(function(t,e,i){Mt(R,t.extent)});var h=Zt(R),l=Ut(R),L=Xe(Math.round(O*h/I),Math.round(O*l/I)),u=O/I;o.forEach(function(t,e,i){var n=t.extent[0]-R[0],r=-(t.extent[3]-R[3]),o=Zt(t.extent),s=Ut(t.extent);L.drawImage(t.image,a,a,t.image.width-2*a,t.image.height-2*a,n*u,r*u,o*u,s*u)});var b=Bt(n);return r.getTriangles().forEach(function(t,e,i){var n=t.source,r=t.target,o=n[0][0],s=n[0][1],a=n[1][0],h=n[1][1],l=n[2][0],u=n[2][1],c=(r[0][0]-b[0])/T,p=-(r[0][1]-b[1])/T,f=(r[1][0]-b[0])/T,d=-(r[1][1]-b[1])/T,_=(r[2][0]-b[0])/T,g=-(r[2][1]-b[1])/T,y=o,v=s,m=function(t){for(var e=t.length,i=0;i<e;i++){for(var n=i,r=Math.abs(t[i][i]),o=i+1;o<e;o++){var s=Math.abs(t[o][i]);r<s&&(r=s,n=o)}if(0===r)return null;var a=t[n];t[n]=t[i],t[i]=a;for(var h=i+1;h<e;h++)for(var l=-t[h][i]/t[i][i],u=i;u<e+1;u++)i==u?t[h][u]=0:t[h][u]+=l*t[i][u]}for(var c=new Array(e),p=e-1;0<=p;p--){c[p]=t[p][e]/t[p][p];for(var f=p-1;0<=f;f--)t[f][e]-=t[f][p]*c[p]}return c}([[a-=y,h-=v,s=o=0,0,f-c],[l-=y,u-=v,0,0,_-c],[0,0,a,h,d-p],[0,0,l,u,g-p]]);if(m){P.save(),P.beginPath();var x=(c+f+_)/3,C=(p+d+g)/3,w=ps(x,C,c,p),S=ps(x,C,f,d),E=ps(x,C,_,g);P.moveTo(S[0],S[1]),P.lineTo(w[0],w[1]),P.lineTo(E[0],E[1]),P.clip(),P.transform(m[0],m[2],m[1],m[3],c,p),P.translate(R[0]-y,R[3]-v),P.scale(I/O,-I/O),P.drawImage(L.canvas,0,0),P.restore()}}),s&&(P.save(),P.strokeStyle="black",P.lineWidth=1,r.getTriangles().forEach(function(t,e,i){var n=t.target,r=(n[0][0]-b[0])/T,o=-(n[0][1]-b[1])/T,s=(n[1][0]-b[0])/T,a=-(n[1][1]-b[1])/T,h=(n[2][0]-b[0])/T,l=-(n[2][1]-b[1])/T;P.beginPath(),P.moveTo(s,a),P.lineTo(r,o),P.lineTo(h,l),P.closePath(),P.stroke()}),P.restore()),P.canvas}var ds,_s,gs=function(){function t(t,e,i,n,r){this.sourceProj_=t,this.targetProj_=e;var o={},s=be(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){var e=t[0]+"/"+t[1];return o[e]||(o[e]=s(t)),o[e]},this.maxSourceExtent_=n,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&Zt(n)==Zt(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Zt(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Zt(this.targetProj_.getExtent()):null;var a=Bt(i),h=Ht(i),l=Yt(i),u=Wt(i),c=this.transformInv_(a),p=this.transformInv_(h),f=this.transformInv_(l),d=this.transformInv_(u);if(this.addQuad_(a,h,l,u,c,p,f,d,10),this.wrapsXInSource_){var _=1/0;this.triangles_.forEach(function(t,e,i){_=Math.min(_,t.source[0][0],t.source[1][0],t.source[2][0])}),this.triangles_.forEach(function(t){if(Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-_>this.sourceWorldWidth_/2){var e=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];e[0][0]-_>this.sourceWorldWidth_/2&&(e[0][0]-=this.sourceWorldWidth_),e[1][0]-_>this.sourceWorldWidth_/2&&(e[1][0]-=this.sourceWorldWidth_),e[2][0]-_>this.sourceWorldWidth_/2&&(e[2][0]-=this.sourceWorldWidth_);var i=Math.min(e[0][0],e[1][0],e[2][0]);Math.max(e[0][0],e[1][0],e[2][0])-i<this.sourceWorldWidth_/2&&(t.source=e)}}.bind(this))}o={}}return t.prototype.addTriangle_=function(t,e,i,n,r,o){this.triangles_.push({source:[n,r,o],target:[t,e,i]})},t.prototype.addQuad_=function(t,e,i,n,r,o,s,a,h){var l=mt([r,o,s,a]),u=this.sourceWorldWidth_?Zt(l)/this.sourceWorldWidth_:null,c=this.sourceWorldWidth_,p=this.sourceProj_.canWrapX()&&.5<u&&u<1,f=!1;if(0<h){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_)f=.25<Zt(mt([t,e,i,n]))/this.targetWorldWidth_||f;!p&&this.sourceProj_.isGlobal()&&u&&(f=.25<u||f)}if(f||!this.maxSourceExtent_||Kt(l,this.maxSourceExtent_)){if(!(f||isFinite(r[0])&&isFinite(r[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(s[0])&&isFinite(s[1])&&isFinite(a[0])&&isFinite(a[1]))){if(!(0<h))return;f=!0}if(0<h){if(!f){var d=[(t[0]+i[0])/2,(t[1]+i[1])/2],_=this.transformInv_(d),g=void 0;if(p)g=(H(r[0],c)+H(s[0],c))/2-H(_[0],c);else g=(r[0]+s[0])/2-_[0];var y=(r[1]+s[1])/2-_[1];f=g*g+y*y>this.errorThresholdSquared_}if(f){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){var v=[(e[0]+i[0])/2,(e[1]+i[1])/2],m=this.transformInv_(v),x=[(n[0]+t[0])/2,(n[1]+t[1])/2],C=this.transformInv_(x);this.addQuad_(t,e,v,x,r,o,m,C,h-1),this.addQuad_(x,v,i,n,C,m,s,a,h-1)}else{var w=[(t[0]+e[0])/2,(t[1]+e[1])/2],S=this.transformInv_(w),E=[(i[0]+n[0])/2,(i[1]+n[1])/2],O=this.transformInv_(E);this.addQuad_(t,w,E,n,r,S,O,a,h-1),this.addQuad_(w,e,i,E,S,o,s,O,h-1)}return}}if(p){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}this.addTriangle_(t,i,n,r,s,a),this.addTriangle_(t,e,i,r,o,s)}},t.prototype.calculateSourceExtent=function(){var r=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach(function(t,e,i){var n=t.source;At(r,n[0]),At(r,n[1]),At(r,n[2])}),r},t.prototype.getTriangles=function(){return this.triangles_},t}(),ys=(ds=function(t,e){return(ds=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}ds(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),vs=function(_){function t(t,e,i,n,r,o){var s=this,a=t.getExtent(),h=e.getExtent(),l=h?Vt(i,h):i,u=cs(t,e,Xt(l),n),c=new gs(t,e,l,a,.5*u),p=o(c.calculateSourceExtent(),u,r),f=p?Ai.IDLE:Ai.EMPTY,d=p?p.getPixelRatio():1;return(s=_.call(this,i,n,d,f)||this).targetProj_=e,s.maxSourceExtent_=a,s.triangulation_=c,s.targetResolution_=n,s.targetExtent_=i,s.sourceImage_=p,s.sourcePixelRatio_=d,s.canvas_=null,s.sourceListenerKey_=null,s}return ys(t,_),t.prototype.disposeInternal=function(){this.state==Ai.LOADING&&this.unlistenSource_(),_.prototype.disposeInternal.call(this)},t.prototype.getImage=function(){return this.canvas_},t.prototype.getProjection=function(){return this.targetProj_},t.prototype.reproject_=function(){var t=this.sourceImage_.getState();if(t==Ai.LOADED){var e=Zt(this.targetExtent_)/this.targetResolution_,i=Ut(this.targetExtent_)/this.targetResolution_;this.canvas_=fs(e,i,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0)}this.state=t,this.changed()},t.prototype.load=function(){if(this.state==Ai.IDLE){this.state=Ai.LOADING,this.changed();var t=this.sourceImage_.getState();t==Ai.LOADED||t==Ai.ERROR?this.reproject_():(this.sourceListenerKey_=a(this.sourceImage_,p.CHANGE,function(t){var e=this.sourceImage_.getState();e!=Ai.LOADED&&e!=Ai.ERROR||(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}},t.prototype.unlistenSource_=function(){l(this.sourceListenerKey_),this.sourceListenerKey_=null},t}(Go),ms=(_s=function(t,e){return(_s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}_s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),xs=function(i){function t(t){var e=i.call(this)||this;return e.projection_=Ie(t.projection),e.attributions_=Cs(t.attributions),e.attributionsCollapsible_=void 0===t.attributionsCollapsible||t.attributionsCollapsible,e.loading=!1,e.state_=void 0!==t.state?t.state:ht,e.wrapX_=void 0!==t.wrapX&&t.wrapX,e}return ms(t,i),t.prototype.getAttributions=function(){return this.attributions_},t.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},t.prototype.getProjection=function(){return this.projection_},t.prototype.getResolutions=function(){return u()},t.prototype.getState=function(){return this.state_},t.prototype.getWrapX=function(){return this.wrapX_},t.prototype.refresh=function(){this.changed()},t.prototype.setAttributions=function(t){this.attributions_=Cs(t),this.changed()},t.prototype.setState=function(t){this.state_=t,this.changed()},t}(L);function Cs(e){return e?Array.isArray(e)?function(t){return e}:"function"==typeof e?e:function(t){return[e]}:null}var ws,Ss=(ws=function(t,e){return(ws=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}ws(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Es="imageloadstart",Os="imageloadend",Is="imageloaderror",Ts=function(n){function t(t,e){var i=n.call(this,t)||this;return i.image=e,i}return Ss(t,n),t}(w),Ps=function(i){function t(t){var e=i.call(this,{attributions:t.attributions,projection:t.projection,state:t.state})||this;return e.resolutions_=void 0!==t.resolutions?t.resolutions:null,e.reprojectedImage_=null,e.reprojectedRevision_=0,e}return Ss(t,i),t.prototype.getResolutions=function(){return this.resolutions_},t.prototype.findNearestResolution=function(t){if(this.resolutions_){var e=s(this.resolutions_,t,0);t=this.resolutions_[e]}return t},t.prototype.getImage=function(t,e,i,n){var r=this.getProjection();if(r&&n&&!Re(r,n)){if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Re(this.reprojectedImage_.getProjection(),n)&&this.reprojectedImage_.getResolution()==e&&Ft(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new vs(r,n,t,e,i,function(t,e,i){return this.getImageInternal(t,e,i,r)}.bind(this)),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}return r&&(n=r),this.getImageInternal(t,e,i,n)},t.prototype.getImageInternal=function(t,e,i,n){return u()},t.prototype.handleImageChange=function(t){var e=t.target;switch(e.getState()){case Ai.LOADING:this.loading=!0,this.dispatchEvent(new Ts(Es,e));break;case Ai.LOADED:this.loading=!1,this.dispatchEvent(new Ts(Os,e));break;case Ai.ERROR:this.loading=!1,this.dispatchEvent(new Ts(Is,e))}},t}(xs);function Rs(t,e){t.getImage().src=e}var Ls="carmentaserver",bs="geoserver",Fs="mapserver",Ms="qgis";function As(t,e){var i=[];Object.keys(e).forEach(function(t){null!==e[t]&&void 0!==e[t]&&i.push(t+"="+encodeURIComponent(e[t]))});var n=i.join("&");return(t=-1===(t=t.replace(/[?&]$/,"")).indexOf("?")?t+"?":t+"&")+n}var Ds,Gs=(Ds=function(t,e){return(Ds=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Ds(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),ks=[101,101],Ns=function(n){function t(t){var e=this,i=t||{};return(e=n.call(this,{attributions:i.attributions,projection:i.projection,resolutions:i.resolutions})||this).crossOrigin_=void 0!==i.crossOrigin?i.crossOrigin:null,e.url_=i.url,e.imageLoadFunction_=void 0!==i.imageLoadFunction?i.imageLoadFunction:Rs,e.params_=i.params||{},e.v13_=!0,e.updateV13_(),e.serverType_=i.serverType,e.hidpi_=void 0===i.hidpi||i.hidpi,e.image_=null,e.imageSize_=[0,0],e.renderedRevision_=0,e.ratio_=void 0!==i.ratio?i.ratio:1.5,e}return Gs(t,n),t.prototype.getFeatureInfoUrl=function(t,e,i,n){if(void 0!==this.url_){var r=Ie(i),o=this.getProjection();o&&o!==r&&(e=cs(o,r,t,e),t=Fe(t,r,o));var s=zt(t,e,0,ks),a={SERVICE:"WMS",VERSION:us,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};c(a,this.params_,n);var h=Math.floor((t[0]-s[0])/e),l=Math.floor((s[3]-t[1])/e);return a[this.v13_?"I":"X"]=h,a[this.v13_?"J":"Y"]=l,this.getRequestUrl_(s,ks,1,o||r,a)}},t.prototype.getLegendUrl=function(t,e){if(void 0!==this.url_){var i={SERVICE:"WMS",VERSION:us,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===e||void 0===e.LAYER){var n=this.params_.LAYERS;if(!(!Array.isArray(n)||1===n.length))return;i.LAYER=n}if(void 0!==t){var r=this.getProjection()?this.getProjection().getMetersPerUnit():1;i.SCALE=t*r*39.37*(25.4/.28)}return c(i,e),As(this.url_,i)}},t.prototype.getParams=function(){return this.params_},t.prototype.getImageInternal=function(t,e,i,n){if(void 0===this.url_)return null;e=this.findNearestResolution(e),1==i||this.hidpi_&&void 0!==this.serverType_||(i=1);var r=e/i,o=Xt(t),s=zt(o,r,0,[Math.ceil(Zt(t)/r),Math.ceil(Ut(t)/r)]),a=zt(o,r,0,[Math.ceil(this.ratio_*Zt(t)/r),Math.ceil(this.ratio_*Ut(t)/r)]),h=this.image_;if(h&&this.renderedRevision_==this.getRevision()&&h.getResolution()==e&&h.getPixelRatio()==i&&St(h.getExtent(),s))return h;var l={SERVICE:"WMS",VERSION:us,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};c(l,this.params_),this.imageSize_[0]=Math.round(Zt(a)/r),this.imageSize_[1]=Math.round(Ut(a)/r);var u=this.getRequestUrl_(a,this.imageSize_,i,n,l);return this.image_=new Uo(a,e,i,u,this.crossOrigin_,this.imageLoadFunction_),this.renderedRevision_=this.getRevision(),this.image_.addEventListener(p.CHANGE,this.handleImageChange.bind(this)),this.image_},t.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_},t.prototype.getRequestUrl_=function(t,e,i,n,r){if(Q(void 0!==this.url_,9),r[this.v13_?"CRS":"SRS"]=n.getCode(),"STYLES"in this.params_||(r.STYLES=""),1!=i)switch(this.serverType_){case bs:var o=90*i+.5|0;"FORMAT_OPTIONS"in r?r.FORMAT_OPTIONS+=";dpi:"+o:r.FORMAT_OPTIONS="dpi:"+o;break;case Fs:r.MAP_RESOLUTION=90*i;break;case Ls:case Ms:r.DPI=90*i;break;default:Q(!1,8)}r.WIDTH=e[0],r.HEIGHT=e[1];var s,a=n.getAxisOrientation();return s=this.v13_&&"ne"==a.substr(0,2)?[t[1],t[0],t[3],t[2]]:t,r.BBOX=s.join(","),As(this.url_,r)},t.prototype.getUrl=function(){return this.url_},t.prototype.setImageLoadFunction=function(t){this.image_=null,this.imageLoadFunction_=t,this.changed()},t.prototype.setUrl=function(t){t!=this.url_&&(this.url_=t,this.image_=null,this.changed())},t.prototype.updateParams=function(t){c(this.params_,t),this.updateV13_(),this.image_=null,this.changed()},t.prototype.updateV13_=function(){var t=this.params_.VERSION||us;this.v13_=0<=function(t,e){for(var i=(""+t).split("."),n=(""+e).split("."),r=0;r<Math.max(i.length,n.length);r++){var o=parseInt(i[r]||"0",10),s=parseInt(n[r]||"0",10);if(s<o)return 1;if(o<s)return-1}return 0}(t,"1.3")},t}(Ps);function js(t,e){if(!t){var i="Assertion failed";throw e&&(i+=": "+e),new Error(i)}}var Ws=function(n){function t(t,e,i){n.call(this),this.src_=t,this.size_=e,this.topLeft_=i,this.div_=null,this.zIndex_=0}return n&&(t.__proto__=n),((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.onAdd=function(){var t=document.createElement("div");t.style.borderStyle="none",t.style.borderWidth="0px",t.style.position="absolute",t.style.zIndex=this.zIndex_;var e=document.createElement("img");e.src=this.src_,e.style.width="100%",e.style.height="100%",e.style.position="absolute",t.appendChild(e),this.div_=t,this.getPanes().mapPane.appendChild(t)},t.prototype.draw=function(){var t=this.div_,e=this.size_[0],i=this.size_[1];t.style.width=e+"px",t.style.height=i+"px";var n=this.getProjection(),r=n.fromLatLngToDivPixel(this.topLeft_),o=r.x,s=r.y,a=n.getWorldWidth();if(a<e){var h=Math.floor(e/a)/2;o-=a*Math.max(h,1)}t.style.top=s+"px",t.style.left=o+"px"},t.prototype.setZIndex=function(t){this.zIndex_=t,this.div_&&(this.div_.style.zIndex=t)},t.prototype.onRemove=function(){this.div_&&(this.div_.parentNode.removeChild(this.div_),this.div_=null)},t}(window.google&&window.google.maps&&google.maps.OverlayView||Object),Ys=function(i){function t(t,e){i.call(this,t,e),this.googleMapsIsActive_=!1}return i&&(t.__proto__=i),((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.watchLayer=function(t){},t.prototype.unwatchLayer=function(t){},t.prototype.setGoogleMapsActive=function(t){this.googleMapsIsActive=t},t.prototype.findIndex=function(t){var e=this.ol3map.getLayers().getArray().indexOf(t),i=t.getZIndex();return 0!=i&&(e=i),e},t}(ls),Xs="function"==typeof Object.assign?Object.assign:function(t,e){var i=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),r=1,o=arguments.length;r<o;++r){var s=i[r];if(null!=s)for(var a in s)s.hasOwnProperty(a)&&(n[a]=s[a])}return n};function zs(t){for(var e in t)delete t[e]}var Us=function(){};Us.prototype.unlisten=function(){throw new TypeError("not implemented")};var Vs=function(e){function t(t){e.call(this),this.listenerKey_=t}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.unlisten=function(){!function(t){if(Array.isArray(t))for(var e=0,i=t.length;e<i;++e)l(t[e]);else l(t)}(this.listenerKey_)},t}(Us),Bs=function(o){function t(t,e,i,n){var r=this;o.call(this,t.on("change:"+i,function(t){r.innerListener_&&(Array.isArray(r.innerListener_)?r.innerListener_.forEach(function(t){return t.unlisten()}):r.innerListener_.unlisten()),r.innerListener_=n(t.target.get(t.key),t.oldValue)})),this.innerListener_=n(t.get(i),e&&e.get(i))}return o&&(t.__proto__=o),((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.unlisten=function(){this.innerListener_&&(Array.isArray(this.innerListener_)?this.innerListener_.forEach(function(t){return t.unlisten()}):this.innerListener_.unlisten()),o.prototype.unlisten.call(this)},t}(Vs),Hs=function(i){function t(t,e){i.call(this,t,e),this.cache_=[],this.layers_=[]}return i&&(t.__proto__=i),((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.watchLayer=function(t){var i=this,e=t;if(e.getSource()instanceof Ns&&!1!==e.get("olgmWatch")){this.layers_.push(e);var n=e.getOpacity(),r={imageOverlay:null,lastUrl:null,layer:e,listeners:[],opacity:n,zIndex:0};r.listeners.push(new Vs(e.on("change:visible",function(){return i.handleVisibleChange_(r)})),new Vs(this.ol3map.on("moveend",function(){return i.handleMoveEnd_(r)})),new Bs(this.ol3map,null,"view",function(t,e){return new Bs(t,e,"resolution",function(){return i.handleMoveEnd_(r)})}),new Bs(e,null,"source",function(t){return t&&i.handleMoveEnd_(r),new Vs(t.on("change",function(){return i.handleMoveEnd_(r)}))})),this.activateCacheItem_(r),this.cache_.push(r)}},t.prototype.unwatchLayer=function(t){var e=t,i=this.layers_.indexOf(e);if(-1!==i){this.layers_.splice(i,1);var n=this.cache_[i];n.listeners&&n.listeners.forEach(function(t){return t.unlisten()}),this.resetImageOverlay_(n),e.setOpacity(n.opacity),this.cache_.splice(i,1)}},t.prototype.activate=function(){i.prototype.activate.call(this),this.cache_.forEach(this.activateCacheItem_,this)},t.prototype.activateCacheItem_=function(t){t.layer.getVisible()&&this.googleMapsIsActive&&(t.lastUrl=null,t.layer.setOpacity(0),this.updateImageOverlay_(t))},t.prototype.deactivate=function(){i.prototype.deactivate.call(this),this.cache_.forEach(this.deactivateCacheItem_,this)},t.prototype.deactivateCacheItem_=function(t){t.imageOverlay&&(t.imageOverlay.setMap(null),t.imageOverlay=null),t.layer.setOpacity(t.opacity)},t.prototype.generateImageWMSFunction_=function(t){var e,i=t.getSource(),n=i.getParams(),r=this.ol3map,o=i.getUrl();js(void 0!==o,"Expected the source to have an url");var s=r.getSize();js(void 0!==s,"Expected the map to have a size");var a=r.getView().calculateExtent(s),h=["CRS","BBOX","FORMAT","HEIGHT","LAYERS","REQUEST","SERVICE","SRS","STYLES","TILED","TRANSPARENT","VERSION","WIDTH"],l={},u={};for(e in n){var c=e.toUpperCase();-1===h.indexOf(c)?void 0!==n[e]&&null!==n[e]&&(l[e]=n[e]):u[c]=n[e]}var p=u.VERSION?u.VERSION:"1.3.0",f=u.LAYERS?u.LAYERS:"",d=u.STYLES?u.STYLES:"",_=u.FORMAT?u.FORMAT:"image/png",g=u.TRANSPARENT?u.TRANSPARENT:"TRUE",y=u.TILED?u.TILED:"FALSE",v=p.split("."),m=1<=parseInt(v[0],10)&&3<=parseInt(v[1],10),x={BBOX:a,FORMAT:_,HEIGHT:s[1],LAYERS:f,REQUEST:"GetMap",SERVICE:"WMS",STYLES:d,TILED:y,TRANSPARENT:g,VERSION:p,WIDTH:s[0]};return m?x.CRS="EPSG:3857":x.SRS="EPSG:3857",Xs(x,l),function(t,e){var i=[];Object.keys(e).forEach(function(t){null!==e[t]&&void 0!==e[t]&&i.push(t+"="+encodeURIComponent(e[t]))});var n=i.join("&");return(t=-1===(t=t.replace(/[?&]$/,"")).indexOf("?")?t+"?":t+"&")+n}(o,x)},t.prototype.resetImageOverlay_=function(t){t.imageOverlay&&(t.imageOverlay.setMap(null),t.imageOverlay=null)},t.prototype.updateImageOverlay_=function(t,e){var i=t.layer;if(i.getVisible()){var n=this.generateImageWMSFunction_(i);1==e&&(n+="&timestamp="+(new Date).getTime());var r=i.getMinResolution(),o=i.getMaxResolution(),s=this.ol3map.getView().getResolution();if(s<r||o<s)this.resetImageOverlay_(t);else if(n!=t.lastUrl){t.lastUrl=n;var a=this.ol3map.getView(),h=this.ol3map.getSize();js(void 0!==h,"Expected the map to have a size");var l=Fe(Bt(a.calculateExtent(h)),"EPSG:3857","EPSG:4326"),u=new google.maps.LatLng(l[1],l[0]),c=new Ws(n,h,u);c.setZIndex(t.zIndex),c.setMap(this.gmap),this.resetImageOverlay_(t),t.imageOverlay=c}}},t.prototype.orderLayers=function(){for(var t=0;t<this.cache_.length;t++){var e=this.cache_[t],i=e.layer,n=this.findIndex(i);e.zIndex=n,e.imageOverlay&&e.imageOverlay.setZIndex(n)}},t.prototype.refresh=function(){for(var t=0;t<this.cache_.length;t++)this.updateImageOverlay_(this.cache_[t],!0)},t.prototype.handleVisibleChange_=function(t){t.layer.getVisible()?this.activateCacheItem_(t):this.deactivateCacheItem_(t)},t.prototype.handleMoveEnd_=function(t){t.layer.getVisible()&&this.ol3map.getView().getCenter()&&this.updateImageOverlay_(t)},t}(Ys);function Zs(t){return Math.pow(t,3)}function Ks(t){return 1-Zs(1-t)}function qs(t){return t}var Js,Qs,$s=(Js=function(t,e){return(Js=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Js(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),ta=function(o){function t(t,e,i){var n=o.call(this)||this,r=i||{};return n.tileCoord=t,n.state=e,n.interimTile=null,n.hifi=!0,n.key="",n.transition_=void 0===r.transition?250:r.transition,n.transitionStarts_={},n}return $s(t,o),t.prototype.changed=function(){this.dispatchEvent(p.CHANGE)},t.prototype.disposeInternal=function(){this.setState(en)},t.prototype.getKey=function(){return this.key+"/"+this.tileCoord},t.prototype.getInterimTile=function(){if(!this.interimTile)return this;var t=this.interimTile;do{if(t.getState()==Qi)return this.transition_=0,t;t=t.interimTile}while(t);return this},t.prototype.refreshInterimChain=function(){if(this.interimTile){var t=this.interimTile,e=this;do{if(t.getState()==Qi){t.interimTile=null;break}t.getState()==Ji?e=t:t.getState()==qi?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}},t.prototype.getTileCoord=function(){return this.tileCoord},t.prototype.getState=function(){return this.state},t.prototype.setState=function(t){if(this.state!==$i&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()},t.prototype.load=function(){u()},t.prototype.getAlpha=function(t,e){if(!this.transition_)return 1;var i=this.transitionStarts_[t];if(i){if(-1===i)return 1}else i=e,this.transitionStarts_[t]=i;var n=e-i+1e3/60;return n>=this.transition_?1:Zs(n/this.transition_)},t.prototype.inTransition=function(t){return!!this.transition_&&-1!==this.transitionStarts_[t]},t.prototype.endTransition=function(t){this.transition_&&(this.transitionStarts_[t]=-1)},t}(E),ea=(Qs=function(t,e){return(Qs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Qs(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),ia=function(a){function t(t,e,i,n,r,o){var s=a.call(this,t,e,o)||this;return s.crossOrigin_=n,s.src_=i,s.image_=new Image,null!==n&&(s.image_.crossOrigin=n),s.unlisten_=null,s.tileLoadFunction_=r,s}return ea(t,a),t.prototype.disposeInternal=function(){this.state==Ji&&(this.unlistenImage_(),this.image_=na()),this.interimTile&&this.interimTile.dispose(),a.prototype.disposeInternal.call(this)},t.prototype.getImage=function(){return this.image_},t.prototype.getKey=function(){return this.src_},t.prototype.handleImageError_=function(){this.state=$i,this.unlistenImage_(),this.image_=na(),this.changed()},t.prototype.handleImageLoad_=function(){var t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=Qi:this.state=tn,this.unlistenImage_(),this.changed()},t.prototype.load=function(){this.state==$i&&(this.state=qi,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==qi&&(this.state=Ji,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Vo(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},t.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},t}(ta);function na(){var t=Xe(1,1);return t.fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas}function ra(t,e,i,n){return void 0!==n?(n[0]=t,n[1]=e,n[2]=i,n):[t,e,i]}function oa(t,e,i){return t+"/"+e+"/"+i}function sa(t){return oa(t[0],t[1],t[2])}var aa,ha,la=(aa=function(t,e){return(aa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}aa(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),ua=function(e){function t(t){return e.call(this,t)||this}return la(t,e),t.prototype.expireCache=function(t){for(;this.canExpireCache();){if(this.peekLast().getKey()in t)break;this.pop().dispose()}},t.prototype.pruneExceptNewestZ=function(){if(0!==this.getCount()){var t=this.peekFirstKey(),e=t.split("/").map(Number)[0];this.forEach(function(t){t.tileCoord[0]!==e&&(this.remove(sa(t.tileCoord)),t.dispose())}.bind(this))}},t}(ni),ca=(ha=function(t,e){return(ha=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}ha(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),pa=function(O){function t(t,e,i,n,r,o,s,a,h,l,u){var c=O.call(this,r,qi)||this;c.renderEdges_=void 0!==u&&u,c.pixelRatio_=s,c.gutter_=a,c.canvas_=null,c.sourceTileGrid_=e,c.targetTileGrid_=n,c.wrappedTileCoord_=o||r,c.sourceTiles_=[],c.sourcesListenerKeys_=null,c.sourceZ_=0;var p=n.getTileCoordExtent(c.wrappedTileCoord_),f=c.targetTileGrid_.getExtent(),d=c.sourceTileGrid_.getExtent(),_=f?Vt(p,f):p;if(0===jt(_))return c.state=tn,c;var g=t.getExtent();g&&(d=d?Vt(d,g):g);var y=n.getResolution(c.wrappedTileCoord_[0]),v=cs(t,i,Xt(_),y);if(!isFinite(v)||v<=0)return c.state=tn,c;var m=void 0!==l?l:.5;if(c.triangulation_=new gs(t,i,_,d,v*m),0===c.triangulation_.getTriangles().length)return c.state=tn,c;c.sourceZ_=e.getZForResolution(v);var x=c.triangulation_.calculateSourceExtent();if(d&&(t.canWrapX()?(x[1]=X(x[1],d[1],d[3]),x[3]=X(x[3],d[1],d[3])):x=Vt(x,d)),jt(x)){for(var C=e.getTileRangeForExtentAndZ(x,c.sourceZ_),w=C.minX;w<=C.maxX;w++)for(var S=C.minY;S<=C.maxY;S++){var E=h(c.sourceZ_,w,S,s);E&&c.sourceTiles_.push(E)}0===c.sourceTiles_.length&&(c.state=tn)}else c.state=tn;return c}return ca(t,O),t.prototype.disposeInternal=function(){this.state==Ji&&this.unlistenSources_(),O.prototype.disposeInternal.call(this)},t.prototype.getImage=function(){return this.canvas_},t.prototype.reproject_=function(){var n=[];if(this.sourceTiles_.forEach(function(t,e,i){t&&t.getState()==Qi&&n.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}.bind(this)),(this.sourceTiles_.length=0)===n.length)this.state=$i;else{var t=this.wrappedTileCoord_[0],e=this.targetTileGrid_.getTileSize(t),i="number"==typeof e?e:e[0],r="number"==typeof e?e:e[1],o=this.targetTileGrid_.getResolution(t),s=this.sourceTileGrid_.getResolution(this.sourceZ_),a=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=fs(i,r,this.pixelRatio_,s,this.sourceTileGrid_.getExtent(),o,a,this.triangulation_,n,this.gutter_,this.renderEdges_),this.state=Qi}this.changed()},t.prototype.load=function(){if(this.state==qi){this.state=Ji,this.changed();var o=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(i,t,e){var n=i.getState();if(n==qi||n==Ji){o++;var r=a(i,p.CHANGE,function(t){var e=i.getState();e!=Qi&&e!=$i&&e!=tn||(l(r),0===--o&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(r)}}.bind(this)),this.sourceTiles_.forEach(function(t,e,i){t.getState()==qi&&t.load()}),0===o&&setTimeout(this.reproject_.bind(this),0)}},t.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(l),this.sourcesListenerKeys_=null},t}(ta);function fa(n,r){var o=/\{z\}/g,s=/\{x\}/g,a=/\{y\}/g,h=/\{-y\}/g;return function(i,t,e){return i?n.replace(o,i[0].toString()).replace(s,i[1].toString()).replace(a,i[2].toString()).replace(h,function(){var t=i[0],e=r.getFullTileRange(t);return Q(e,55),(e.getHeight()-i[2]-1).toString()}):void 0}}function da(t,e){for(var i=t.length,n=new Array(i),r=0;r<i;++r)n[r]=fa(t[r],e);return function(s){if(1===s.length)return s[0];return function(t,e,i){if(t){var n=((o=t)[1]<<o[0])+o[2],r=H(n,s.length);return s[r](t,e,i)}var o}}(n)}function _a(t,e,i){}function ga(t,e){return Array.isArray(t)?t:(void 0===e?e=[t,t]:(e[0]=t,e[1]=t),e)}var ya=42,va=256,ma=[0,0,0],xa=function(){function t(t){var n,r,o,e;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,Q((n=this.resolutions_,r=!0,o=function(t,e){return e-t}||_t,n.every(function(t,e){if(0===e)return!0;var i=o(n[e-1],t);return!(0<i||r&&0===i)})),17),!t.origins)for(var i=0,s=this.resolutions_.length-1;i<s;++i)if(e){if(this.resolutions_[i]/this.resolutions_[i+1]!==e){e=void 0;break}}else e=this.resolutions_[i]/this.resolutions_[i+1];this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,Q(this.origins_.length==this.resolutions_.length,20));var a=t.extent;void 0===a||this.origin_||this.origins_||(this.origin_=Bt(a)),Q(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,Q(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:va,Q(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==a?a:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map(function(t,e){return new Hi(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1))},this):a&&this.calculateTileRanges_(a)}return t.prototype.forEachTileCoord=function(t,e,i){for(var n=this.getTileRangeForExtentAndZ(t,e),r=n.minX,o=n.maxX;r<=o;++r)for(var s=n.minY,a=n.maxY;s<=a;++s)i([e,r,s])},t.prototype.forEachTileCoordParentTileRange=function(t,e,i,n){var r,o,s=null,a=t[0]-1;for(2===this.zoomFactor_?(r=t[1],o=t[2]):s=this.getTileCoordExtent(t,n);a>=this.minZoom;){if(e(a,2===this.zoomFactor_?Zi(r=Math.floor(r/2),r,o=Math.floor(o/2),o,i):this.getTileRangeForExtentAndZ(s,a,i)))return!0;--a}return!1},t.prototype.getExtent=function(){return this.extent_},t.prototype.getMaxZoom=function(){return this.maxZoom},t.prototype.getMinZoom=function(){return this.minZoom},t.prototype.getOrigin=function(t){return this.origin_?this.origin_:this.origins_[t]},t.prototype.getResolution=function(t){return this.resolutions_[t]},t.prototype.getResolutions=function(){return this.resolutions_},t.prototype.getTileCoordChildTileRange=function(t,e,i){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){var n=2*t[1],r=2*t[2];return Zi(n,n+1,r,r+1,e)}var o=this.getTileCoordExtent(t,i);return this.getTileRangeForExtentAndZ(o,t[0]+1,e)}return null},t.prototype.getTileRangeExtent=function(t,e,i){var n=this.getOrigin(t),r=this.getResolution(t),o=ga(this.getTileSize(t),this.tmpSize_),s=n[0]+e.minX*o[0]*r,a=n[0]+(e.maxX+1)*o[0]*r;return Tt(s,n[1]+e.minY*o[1]*r,a,n[1]+(e.maxY+1)*o[1]*r,i)},t.prototype.getTileRangeForExtentAndZ=function(t,e,i){var n=ma;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,n);var r=n[1],o=n[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,n),Zi(r,n[1],o,n[2],i)},t.prototype.getTileCoordCenter=function(t){var e=this.getOrigin(t[0]),i=this.getResolution(t[0]),n=ga(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*n[0]*i,e[1]-(t[2]+.5)*n[1]*i]},t.prototype.getTileCoordExtent=function(t,e){var i=this.getOrigin(t[0]),n=this.getResolution(t[0]),r=ga(this.getTileSize(t[0]),this.tmpSize_),o=i[0]+t[1]*r[0]*n,s=i[1]-(t[2]+1)*r[1]*n;return Tt(o,s,o+r[0]*n,s+r[1]*n,e)},t.prototype.getTileCoordForCoordAndResolution=function(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)},t.prototype.getTileCoordForXYAndResolution_=function(t,e,i,n,r){var o=this.getZForResolution(i),s=i/this.getResolution(o),a=this.getOrigin(o),h=ga(this.getTileSize(o),this.tmpSize_),l=n?.5:0,u=n?.5:0,c=Math.floor((t-a[0])/i+l),p=Math.floor((a[1]-e)/i+u),f=s*c/h[0],d=s*p/h[1];return n?(f=Math.ceil(f)-1,d=Math.ceil(d)-1):(f=Math.floor(f),d=Math.floor(d)),ra(o,f,d,r)},t.prototype.getTileCoordForXYAndZ_=function(t,e,i,n,r){var o=this.getOrigin(i),s=this.getResolution(i),a=ga(this.getTileSize(i),this.tmpSize_),h=n?.5:0,l=n?.5:0,u=Math.floor((t-o[0])/s+h),c=Math.floor((o[1]-e)/s+l),p=u/a[0],f=c/a[1];return n?(p=Math.ceil(p)-1,f=Math.ceil(f)-1):(p=Math.floor(p),f=Math.floor(f)),ra(i,p,f,r)},t.prototype.getTileCoordForCoordAndZ=function(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)},t.prototype.getTileCoordResolution=function(t){return this.resolutions_[t[0]]},t.prototype.getTileSize=function(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]},t.prototype.getFullTileRange=function(t){return this.fullTileRanges_?this.fullTileRanges_[t]:null},t.prototype.getZForResolution=function(t,e){return X(s(this.resolutions_,t,e||0),this.minZoom,this.maxZoom)},t.prototype.calculateTileRanges_=function(t){for(var e=this.resolutions_.length,i=new Array(e),n=this.minZoom;n<e;++n)i[n]=this.getTileRangeForExtentAndZ(t,n);this.fullTileRanges_=i},t}();function Ca(t){var e,i,n,r,o,s,a,h,l,u,c,p,f=t.getDefaultTileGrid();return f||(r=wa(t),o=e,s=i,h=void 0!==(a=n)?a:yt.TOP_LEFT,l=function(t,e,i){for(var n=void 0!==e?e:ya,r=Ut(t),o=Zt(t),s=ga(void 0!==i?i:va),a=Math.max(o/s[0],r/s[1]),h=n+1,l=new Array(h),u=0;u<h;++u)l[u]=a/Math.pow(2,u);return l}(r,o,s),f=new xa({extent:r,origin:(u=r,c=h,c===yt.BOTTOM_LEFT?p=Wt(u):c===yt.BOTTOM_RIGHT?p=Yt(u):c===yt.TOP_LEFT?p=Bt(u):c===yt.TOP_RIGHT?p=Ht(u):Q(!1,13),p),resolutions:l,tileSize:s}),t.setDefaultTileGrid(f)),f}function wa(t){var e=(t=Ie(t)).getExtent();if(!e){var i=180*ie[ee.DEGREES]/t.getMetersPerUnit();e=Tt(-i,-i,i,i)}return e}var Sa,Ea,Oa,Ia=(Sa=function(t,e){return(Sa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Sa(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Ta=function(h){function t(t){var e=h.call(this,{attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX})||this;e.opaque_=void 0!==t.opaque&&t.opaque,e.tilePixelRatio_=void 0!==t.tilePixelRatio?t.tilePixelRatio:1,e.tileGrid=void 0!==t.tileGrid?t.tileGrid:null;var i=t.cacheSize;if(void 0===i){var n=[256,256],r=t.tileGrid;r&&ga(r.getTileSize(r.getMinZoom()),n);var o="undefined"!=typeof screen,s=o?screen.availWidth||screen.width:1920,a=o?screen.availHeight||screen.height:1080;i=4*Math.ceil(s/n[0])*Math.ceil(a/n[1])}return e.tileCache=new ua(i),e.tmpSize=[0,0],e.key_=t.key||"",e.tileOptions={transition:t.transition},e.zDirection=t.zDirection?t.zDirection:0,e}return Ia(t,h),t.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},t.prototype.expireCache=function(t,e){var i=this.getTileCacheForProjection(t);i&&i.expireCache(e)},t.prototype.forEachLoadedTile=function(t,e,i,n){var r=this.getTileCacheForProjection(t);if(!r)return!1;for(var o,s,a,h=!0,l=i.minX;l<=i.maxX;++l)for(var u=i.minY;u<=i.maxY;++u)s=oa(e,l,u),a=!1,r.containsKey(s)&&(a=(o=r.get(s)).getState()===Qi)&&(a=!1!==n(o)),a||(h=!1);return h},t.prototype.getGutterForProjection=function(t){return 0},t.prototype.getKey=function(){return this.key_},t.prototype.setKey=function(t){this.key_!==t&&(this.key_=t,this.changed())},t.prototype.getOpaque=function(t){return this.opaque_},t.prototype.getResolutions=function(){return this.tileGrid.getResolutions()},t.prototype.getTile=function(t,e,i,n,r){return u()},t.prototype.getTileGrid=function(){return this.tileGrid},t.prototype.getTileGridForProjection=function(t){return this.tileGrid?this.tileGrid:Ca(t)},t.prototype.getTileCacheForProjection=function(t){var e=this.getProjection();return e&&!Re(e,t)?null:this.tileCache},t.prototype.getTilePixelRatio=function(t){return this.tilePixelRatio_},t.prototype.getTilePixelSize=function(t,e,i){var n,r,o,s=this.getTileGridForProjection(i),a=this.getTilePixelRatio(e),h=ga(s.getTileSize(t),this.tmpSize);return 1==a?h:(n=h,r=a,void 0===(o=this.tmpSize)&&(o=[0,0]),o[0]=n[0]*r+.5|0,o[1]=n[1]*r+.5|0,o)},t.prototype.getTileCoordForTileUrlFunction=function(t,e){var i=void 0!==e?e:this.getProjection(),n=this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(t=function(t,e,i){var n=e[0],r=t.getTileCoordCenter(e),o=wa(i);if(wt(o,r))return e;var s=Zt(o),a=Math.ceil((o[0]-r[0])/s);return r[0]+=s*a,t.getTileCoordForCoordAndZ(r,n)}(n,t,i)),function(t,e){var i=t[0],n=t[1],r=t[2];if(e.getMinZoom()>i||i>e.getMaxZoom())return!1;var o,s=e.getExtent();return!(o=s?e.getTileRangeForExtentAndZ(s,i):e.getFullTileRange(i))||o.containsXY(n,r)}(t,n)?t:null},t.prototype.clear=function(){this.tileCache.clear()},t.prototype.refresh=function(){this.clear(),h.prototype.refresh.call(this)},t.prototype.useTile=function(t,e,i,n){},t}(xs),Pa=function(n){function t(t,e){var i=n.call(this,t)||this;return i.tile=e,i}return Ia(t,n),t}(w),Ra="tileloadstart",La="tileloadend",ba="tileloaderror",Fa=(Ea=function(t,e){return(Ea=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Ea(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Ma=function(i){function t(t){var e=i.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})||this;return e.generateTileUrlFunction_=!t.tileUrlFunction,e.tileLoadFunction=t.tileLoadFunction,e.tileUrlFunction=t.tileUrlFunction?t.tileUrlFunction.bind(e):_a,e.urls=null,t.urls?e.setUrls(t.urls):t.url&&e.setUrl(t.url),e.tileLoadingKeys_={},e}return Fa(t,i),t.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},t.prototype.getTileUrlFunction=function(){return this.tileUrlFunction},t.prototype.getUrls=function(){return this.urls},t.prototype.handleTileChange=function(t){var e,i=t.target,n=dt(i),r=i.getState();r==Ji?(this.tileLoadingKeys_[n]=!0,e=Ra):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],e=r==$i?ba:r==Qi||r==en?La:void 0),null!=e&&this.dispatchEvent(new Pa(e,i))},t.prototype.setTileLoadFunction=function(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()},t.prototype.setTileUrlFunction=function(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()},t.prototype.setUrl=function(t){var e=function(t){var e=[],i=/\{([a-z])-([a-z])\}/.exec(t);if(i){var n=i[1].charCodeAt(0),r=i[2].charCodeAt(0),o=void 0;for(o=n;o<=r;++o)e.push(t.replace(i[0],String.fromCharCode(o)));return e}if(i=/\{(\d+)-(\d+)\}/.exec(t)){for(var s=parseInt(i[2],10),a=parseInt(i[1],10);a<=s;a++)e.push(t.replace(i[0],a.toString()));return e}return e.push(t),e}(t);this.urls=e,this.setUrls(e)},t.prototype.setUrls=function(t){var e=(this.urls=t).join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(da(t,this.tileGrid),e):this.setKey(e)},t.prototype.useTile=function(t,e,i){var n=oa(t,e,i);this.tileCache.containsKey(n)&&this.tileCache.get(n)},t}(Ta),Aa=(Oa=function(t,e){return(Oa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Oa(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Da=function(i){function t(t){var e=i.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Ga,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})||this;return e.crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null,e.tileClass=void 0!==t.tileClass?t.tileClass:ia,e.tileCacheForProjection={},e.tileGridForProjection={},e.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,e.renderReprojectionEdges_=!1,e}return Aa(t,i),t.prototype.canExpireCache=function(){if(this.tileCache.canExpireCache())return!0;for(var t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1},t.prototype.expireCache=function(t,e){var i=this.getTileCacheForProjection(t);for(var n in this.tileCache.expireCache(this.tileCache==i?e:{}),this.tileCacheForProjection){var r=this.tileCacheForProjection[n];r.expireCache(r==i?e:{})}},t.prototype.getGutterForProjection=function(t){return this.getProjection()&&t&&!Re(this.getProjection(),t)?0:this.getGutter()},t.prototype.getGutter=function(){return 0},t.prototype.getOpaque=function(t){return!(this.getProjection()&&t&&!Re(this.getProjection(),t))&&i.prototype.getOpaque.call(this,t)},t.prototype.getTileGridForProjection=function(t){var e=this.getProjection();if(!this.tileGrid||e&&!Re(e,t)){var i=dt(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=Ca(t)),this.tileGridForProjection[i]}return this.tileGrid},t.prototype.getTileCacheForProjection=function(t){var e=this.getProjection();if(!e||Re(e,t))return this.tileCache;var i=dt(t);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new ua(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]},t.prototype.createTile_=function(t,e,i,n,r,o){var s=[t,e,i],a=this.getTileCoordForTileUrlFunction(s,r),h=a?this.tileUrlFunction(a,n,r):void 0,l=new this.tileClass(s,void 0!==h?qi:tn,void 0!==h?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return l.key=o,l.addEventListener(p.CHANGE,this.handleTileChange.bind(this)),l},t.prototype.getTile=function(t,e,i,n,r){var o=this.getProjection();if(o&&r&&!Re(o,r)){var s=this.getTileCacheForProjection(r),a=[t,e,i],h=void 0,l=sa(a);s.containsKey(l)&&(h=s.get(l));var u=this.getKey();if(h&&h.key==u)return h;var c=this.getTileGridForProjection(o),p=this.getTileGridForProjection(r),f=this.getTileCoordForTileUrlFunction(a,r),d=new pa(o,c,r,p,a,f,this.getTilePixelRatio(n),this.getGutter(),function(t,e,i,n){return this.getTileInternal(t,e,i,n,o)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_);return d.key=u,h?(d.interimTile=h,d.refreshInterimChain(),s.replace(l,d)):s.set(l,d),d}return this.getTileInternal(t,e,i,n,o||r)},t.prototype.getTileInternal=function(t,e,i,n,r){var o=null,s=oa(t,e,i),a=this.getKey();if(this.tileCache.containsKey(s)){if((o=this.tileCache.get(s)).key!=a){var h=o;o=this.createTile_(t,e,i,n,r,a),h.getState()==qi?o.interimTile=h.interimTile:o.interimTile=h,o.refreshInterimChain(),this.tileCache.replace(s,o)}}else o=this.createTile_(t,e,i,n,r,a),this.tileCache.set(s,o);return o},t.prototype.setRenderReprojectionEdges=function(t){if(this.renderReprojectionEdges_!=t){for(var e in this.renderReprojectionEdges_=t,this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}},t.prototype.setTileGridForProjection=function(t,e){var i=Ie(t);if(i){var n=dt(i);n in this.tileGridForProjection||(this.tileGridForProjection[n]=e)}},t}(Ma);function Ga(t,e){t.getImage().src=e}var ka=function(e){function t(t){e.call(this),this.setMap(t)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getMapPanes=function(){return this.getPanes()},t.prototype.onAdd=function(){},t.prototype.draw=function(){},t.prototype.onRemove=function(){},t}(window.google&&window.google.maps&&google.maps.OverlayView||Object),Na=function(n){function t(t,e){var i=this;n.call(this,t,e),this.cache_=[],this.layers_=[],this.panesOverlay_=new ka(e),google.maps.event.addListenerOnce(e,"idle",function(){i.orderLayers()})}return n&&(t.__proto__=n),((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.watchLayer=function(t){var i=this,e=t,n=e.getSource();if(n instanceof Da&&!1!==e.get("olgmWatch")){this.layers_.push(e);var r=e.getOpacity(),o={element:null,ignoreNextOpacityChange:!0,layer:e,listeners:[],opacity:r,zIndex:0},s=n.getTileGrid(),a=256;if(s){var h=s.getTileSize(0);"number"==typeof h&&(a=h)}var l=new google.maps.Size(a,a),u={getTileUrl:this.googleGetTileUrlFunction_.bind(this,e),tileSize:l,isPng:!0,opacity:r},c=new google.maps.ImageMapType(u);e.getVisible()&&this.gmap.overlayMapTypes.push(c),o.googleTileLayer=c,o.listeners.push(new Vs(e.on("change:visible",function(){return i.handleVisibleChange_(o)})),new Vs(e.on("change:opacity",function(){return i.handleOpacityChange_(o)})),new Bs(e,null,"source",function(t,e){return e&&i.handleSourceChange_(o),new Vs(t.on("change",function(){return i.handleSourceChange_(o)}))})),this.activateCacheItem_(o),this.cache_.push(o)}},t.prototype.googleGetTileUrlFunction_=function(t,e,i){var n=t.getSource(),r=t.getMinResolution(),o=t.getMaxResolution(),s=this.ol3map.getView().getResolution();if(!(s<r||o<s)){var a=Ie("EPSG:3857"),h=[i,e.x,e.y],l=t.getExtent();l||(l=a.getExtent());var u,c=n.getTileGrid();if(c){var p=[-20037508.342789244,20037508.342789244],f=c.getOrigin(0);if(f[0]!=p[0]||f[1]!=p[1]){var d=c.getTileSize(i),_=Math.log2(256),g=Math.log2(d)-_,y=Math.pow(2,i-g)/2;h[1]=h[1]-y,h[2]=h[2]+y}var v=Vt(l,c.getTileCoordExtent(h)),m=[(u=v)[2]-u[0],u[3]-u[1]],x=m[0]*m[1];if(x<1||x==1/0)return}var C=n.tileUrlFunction(h,1,a);if(void 0===C)C=n.getTileUrlFunction()(h,1,a);return C}},t.prototype.unwatchLayer=function(t){var e=t,i=this.layers_.indexOf(e);if(-1!==i){this.layers_.splice(i,1);var n=this.cache_[i];n.listeners.forEach(function(t){return t.unlisten()});var r=n.googleTileLayer,o=this.gmap.overlayMapTypes,s=o.getArray().indexOf(r);-1!=s&&o.removeAt(s),e.setOpacity(n.opacity),this.cache_.splice(i,1)}},t.prototype.activate=function(){n.prototype.activate.call(this),this.cache_.forEach(this.activateCacheItem_,this)},t.prototype.activateCacheItem_=function(t){t.layer.getVisible()&&this.googleMapsIsActive&&(t.ignoreNextOpacityChange=!0,t.layer.setOpacity(0))},t.prototype.deactivate=function(){n.prototype.deactivate.call(this),this.cache_.forEach(this.deactivateCacheItem_,this)},t.prototype.deactivateCacheItem_=function(t){t.ignoreNextOpacityChange=!0,t.layer.setOpacity(t.opacity)},t.prototype.orderLayers=function(){var t=this.panesOverlay_.getMapPanes();if(t)for(var e=t.mapPane,i=this.gmap.overlayMapTypes,n=0;n<this.cache_.length;n++){var r=this.cache_[n],o=r.layer;r.zIndex=this.findIndex(o);var s=r.googleTileLayer,a=i.getArray().indexOf(s);if(-1!=a){i.removeAt(a);var h=Array.prototype.slice.call(e.childNodes);i.push(s);for(var l=e.childNodes,u=0;u<l.length;u++)-1==h.indexOf(l[u])&&(r.element=l[u],setTimeout(function(){this.element.style.zIndex=this.zIndex}.bind(r),0))}}},t.prototype.handleOpacityChange_=function(t){var e=t.layer,i=t.layer.getOpacity();t.ignoreNextOpacityChange?t.ignoreNextOpacityChange=!1:(t.googleTileLayer.setOpacity(i),t.opacity=i,e.getVisible()&&this.googleMapsIsActive&&(t.ignoreNextOpacityChange=!0,t.layer.setOpacity(0)))},t.prototype.handleVisibleChange_=function(t){var e=t.layer.getVisible(),i=t.googleTileLayer,n=this.gmap.overlayMapTypes,r=n.getArray().indexOf(i);e?(-1==r&&n.push(i),this.activateCacheItem_(t)):(-1!=r&&n.removeAt(r),this.deactivateCacheItem_(t))},t.prototype.handleSourceChange_=function(t){t.googleTileLayer.changed("foo")},t}(Ys);function ja(t,e,i,n,r,o,s){var a,h=t[e],l=t[e+1],u=t[i]-h,c=t[i+1]-l;if(0===u&&0===c)a=e;else{var p=((r-h)*u+(o-l)*c)/(u*u+c*c);if(1<p)a=i;else{if(0<p){for(var f=0;f<n;++f)s[f]=Z(t[e+f],t[i+f],p);return void(s.length=n)}a=e}}for(f=0;f<n;++f)s[f]=t[a+f];s.length=n}function Wa(t,e,i,n,r){var o=t[e],s=t[e+1];for(e+=n;e<i;e+=n){var a=t[e],h=t[e+1],l=V(o,s,a,h);r<l&&(r=l),o=a,s=h}return r}function Ya(t,e,i,n,r){for(var o=0,s=i.length;o<s;++o){var a=i[o];r=Wa(t,e,a,n,r),e=a}return r}function Xa(t,e,i,n,r,o,s,a,h,l,u){if(e==i)return l;var c,p;if(0===r){if((p=V(s,a,t[e],t[e+1]))<l){for(c=0;c<n;++c)h[c]=t[e+c];return h.length=n,p}return l}for(var f=u||[NaN,NaN],d=e+n;d<i;)if(ja(t,d-n,d,n,s,a,f),(p=V(s,a,f[0],f[1]))<l){for(l=p,c=0;c<n;++c)h[c]=f[c];d+=h.length=n}else d+=n*Math.max((Math.sqrt(p)-Math.sqrt(l))/r|0,1);if(o&&(ja(t,i-n,e,n,s,a,f),(p=V(s,a,f[0],f[1]))<l)){for(l=p,c=0;c<n;++c)h[c]=f[c];h.length=n}return l}function za(t,e,i,n,r,o,s,a,h,l,u){for(var c=u||[NaN,NaN],p=0,f=i.length;p<f;++p){var d=i[p];l=Xa(t,e,d,n,r,o,s,a,h,l,c),e=d}return l}function Ua(t,e,i,n){for(var r=0,o=i.length;r<o;++r)t[e++]=i[r];return e}function Va(t,e,i,n){for(var r=0,o=i.length;r<o;++r)for(var s=i[r],a=0;a<n;++a)t[e++]=s[a];return e}function Ba(t,e,i,n,r){for(var o=r||[],s=0,a=0,h=i.length;a<h;++a){var l=Va(t,e,i[a],n);e=o[s++]=l}return o.length=s,o}function Ha(t,e,i,n,r,o){var s=NaN,a=NaN,h=(i-e)/n;if(1===h)s=t[e],a=t[e+1];else if(2==h)s=(1-r)*t[e]+r*t[e+n],a=(1-r)*t[e+1]+r*t[e+n+1];else if(0!==h){for(var l=t[e],u=t[e+1],c=0,p=[0],f=e+n;f<i;f+=n){var d=t[f],_=t[f+1];c+=Math.sqrt((d-l)*(d-l)+(_-u)*(_-u)),p.push(c),l=d,u=_}var g=r*c,y=function(t,e,i){for(var n,r,o=i||_t,s=0,a=t.length,h=!1;s<a;)(r=+o(t[n=s+(a-s>>1)],e))<0?s=n+1:(a=n,h=!r);return h?s:~s}(p,g);if(y<0){var v=(g-p[-y-2])/(p[-y-1]-p[-y-2]),m=e+(-y-2)*n;s=Z(t[m],t[m+n],v),a=Z(t[m+1],t[m+n+1],v)}else s=t[e+y*n],a=t[e+y*n+1]}return o?(o[0]=s,o[1]=a,o):[s,a]}function Za(t,e,i,n,r,o){if(i==e)return null;var s;if(r<t[e+n-1])return o?((s=t.slice(e,e+n))[n-1]=r,s):null;if(t[i-1]<r)return o?((s=t.slice(i-n,i))[n-1]=r,s):null;if(r==t[e+n-1])return t.slice(e,e+n);for(var a=e/n,h=i/n;a<h;){var l=a+h>>1;r<t[(l+1)*n-1]?h=l:a=l+1}var u=t[a*n-1];if(r==u)return t.slice((a-1)*n,(a-1)*n+n);var c=(r-u)/(t[(a+1)*n-1]-u);s=[];for(var p=0;p<n-1;++p)s.push(Z(t[(a-1)*n+p],t[a*n+p],c));return s.push(r),s}function Ka(e,i,n,r,t){return!Nt(t,function(t){return!qa(e,i,n,r,t[0],t[1])})}function qa(t,e,i,n,r,o){for(var s=0,a=t[i-n],h=t[i-n+1];e<i;e+=n){var l=t[e],u=t[e+1];h<=o?o<u&&0<(l-a)*(o-h)-(r-a)*(u-h)&&s++:u<=o&&(l-a)*(o-h)-(r-a)*(u-h)<0&&s--,a=l,h=u}return 0!==s}function Ja(t,e,i,n,r,o){if(0===i.length)return!1;if(!qa(t,e,i[0],n,r,o))return!1;for(var s=1,a=i.length;s<a;++s)if(qa(t,i[s-1],i[s],n,r,o))return!1;return!0}function Qa(t,e,i,n,r){for(var o,s=[t[e],t[e+1]],a=[];e+n<i;e+=n){if(a[0]=t[e+n],a[1]=t[e+n+1],o=r(s,a))return o;s[0]=a[0],s[1]=a[1]}return!1}function $a(t,e,i,n,r){var o=Dt([1/0,1/0,-1/0,-1/0],t,e,i,n);return!!Kt(r,o)&&(!!St(r,o)||(o[0]>=r[0]&&o[2]<=r[2]||(o[1]>=r[1]&&o[3]<=r[3]||Qa(t,e,i,n,function(t,e){return function(t,e,i){var n=!1,r=Ot(t,e),o=Ot(t,i);if(r===vt.INTERSECTING||o===vt.INTERSECTING)n=!0;else{var s=t[0],a=t[1],h=t[2],l=t[3],u=e[0],c=e[1],p=i[0],f=i[1],d=(f-c)/(p-u),_=void 0,g=void 0;o&vt.ABOVE&&!(r&vt.ABOVE)&&(n=s<=(_=p-(f-l)/d)&&_<=h),n||!(o&vt.RIGHT)||r&vt.RIGHT||(n=a<=(g=f-(p-h)*d)&&g<=l),n||!(o&vt.BELOW)||r&vt.BELOW||(n=s<=(_=p-(f-a)/d)&&_<=h),n||!(o&vt.LEFT)||r&vt.LEFT||(n=a<=(g=f-(p-s)*d)&&g<=l)}return n}(r,t,e)}))))}function th(t,e,i,n,r){if(o=t,s=e,a=i[0],!($a(o,s,a,h=n,l=r)||qa(o,s,a,h,l[0],l[1])||qa(o,s,a,h,l[0],l[3])||qa(o,s,a,h,l[2],l[1])||qa(o,s,a,h,l[2],l[3])))return!1;var o,s,a,h,l;if(1===i.length)return!0;for(var u=1,c=i.length;u<c;++u)if(Ka(t,i[u-1],i[u],n,r)&&!$a(t,i[u-1],i[u],n,r))return!1;return!0}var eh,ih,nh=(eh=function(t,e){return(eh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}eh(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),rh=function(n){function i(t,e){var i=n.call(this)||this;return i.flatMidpoint_=null,i.flatMidpointRevision_=-1,i.maxDelta_=-1,i.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?i.setCoordinates(t,e):i.setFlatCoordinates(e,t),i}return nh(i,n),i.prototype.appendCoordinate=function(t){this.flatCoordinates?g(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()},i.prototype.clone=function(){return new i(this.flatCoordinates.slice(),this.layout)},i.prototype.closestPointXY=function(t,e,i,n){return n<Ct(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Wa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Xa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,n))},i.prototype.forEachSegment=function(t){return Qa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},i.prototype.getCoordinateAtM=function(t,e){if(this.layout!=Co&&this.layout!=wo)return null;var i=void 0!==e&&e;return Za(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i)},i.prototype.getCoordinates=function(){return Dn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},i.prototype.getCoordinateAt=function(t,e){return Ha(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e)},i.prototype.getLength=function(){return Rr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},i.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},i.prototype.getSimplifiedGeometryInternal=function(t){var e=[];return e.length=cr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new i(e,mo)},i.prototype.getType=function(){return Qt.LINE_STRING},i.prototype.intersectsExtent=function(t){return $a(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},i.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Va(this.flatCoordinates,0,t,this.stride),this.changed()},i}(Eo),oh=(ih=function(t,e){return(ih=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}ih(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),sh=function(n){function t(t,e){var i=n.call(this)||this;return i.setCoordinates(t,e),i}return oh(t,n),t.prototype.clone=function(){return new t(this.flatCoordinates.slice(),this.layout)},t.prototype.closestPointXY=function(t,e,i,n){var r=this.flatCoordinates,o=V(t,e,r[0],r[1]);if(o<n){for(var s=this.stride,a=0;a<s;++a)i[a]=r[a];return i.length=s,o}return n},t.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},t.prototype.computeExtent=function(t){return Rt(this.flatCoordinates,t)},t.prototype.getType=function(){return Qt.POINT},t.prototype.intersectsExtent=function(t){return Et(t,this.flatCoordinates[0],this.flatCoordinates[1])},t.prototype.setCoordinates=function(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ua(this.flatCoordinates,0,t,this.stride),this.changed()},t}(Eo);function ah(t,e,i,n){for(var r=0,o=t[i-n],s=t[i-n+1];e<i;e+=n){var a=t[e],h=t[e+1];r+=s*a-o*h,o=a,s=h}return r/2}function hh(t,e,i,n){for(var r=0,o=0,s=i.length;o<s;++o){var a=i[o];r+=ah(t,e,a,n),e=a}return r}var lh,uh=(lh=function(t,e){return(lh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}lh(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),ch=function(n){function i(t,e){var i=n.call(this)||this;return i.maxDelta_=-1,i.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?i.setCoordinates(t,e):i.setFlatCoordinates(e,t),i}return uh(i,n),i.prototype.clone=function(){return new i(this.flatCoordinates.slice(),this.layout)},i.prototype.closestPointXY=function(t,e,i,n){return n<Ct(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Wa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Xa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,n))},i.prototype.getArea=function(){return ah(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},i.prototype.getCoordinates=function(){return Dn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},i.prototype.getSimplifiedGeometryInternal=function(t){var e=[];return e.length=cr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new i(e,mo)},i.prototype.getType=function(){return Qt.LINEAR_RING},i.prototype.intersectsExtent=function(t){return!1},i.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Va(this.flatCoordinates,0,t,this.stride),this.changed()},i}(Eo);function ph(t,e,i,n,r,o,s){for(var a,h,l,u,c,p,f,d=r[o+1],_=[],g=0,y=i.length;g<y;++g){var v=i[g];for(u=t[v-n],p=t[v-n+1],a=e;a<v;a+=n)c=t[a],f=t[a+1],(d<=p&&f<=d||p<=d&&d<=f)&&(l=(d-p)/(f-p)*(c-u)+u,_.push(l)),u=c,p=f}var m=NaN,x=-1/0;for(_.sort(_t),u=_[0],a=1,h=_.length;a<h;++a){c=_[a];var C=Math.abs(c-u);x<C&&Ja(t,e,i,n,l=(u+c)/2,d)&&(m=l,x=C),u=c}return isNaN(m)&&(m=r[o]),s?(s.push(m,d,x),s):[m,d,x]}function fh(t,e,i,n){for(;e<i-n;){for(var r=0;r<n;++r){var o=t[e+r];t[e+r]=t[i-n+r],t[i-n+r]=o}e+=n,i-=n}}function dh(t,e,i,n){for(var r=0,o=t[i-n],s=t[i-n+1];e<i;e+=n){var a=t[e],h=t[e+1];r+=(a-o)*(h+s),o=a,s=h}return 0<r}function _h(t,e,i,n,r){for(var o=void 0!==r&&r,s=0,a=i.length;s<a;++s){var h=i[s],l=dh(t,e,h,n);if(0===s){if(o&&l||!o&&!l)return!1}else if(o&&!l||!o&&l)return!1;e=h}return!0}function gh(t,e,i,n,r){for(var o=void 0!==r&&r,s=0,a=i.length;s<a;++s){var h=i[s],l=dh(t,e,h,n);(0===s?o&&l||!o&&!l:o&&!l||!o&&l)&&fh(t,e,h,n),e=h}return e}function yh(t,e,i,n,r){for(var o=0,s=i.length;o<s;++o)e=gh(t,e,i[o],n,r);return e}var vh,mh=(vh=function(t,e){return(vh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}vh(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),xh=function(r){function n(t,e,i){var n=r.call(this)||this;return n.ends_=[],n.flatInteriorPointRevision_=-1,n.flatInteriorPoint_=null,n.maxDelta_=-1,n.maxDeltaRevision_=-1,n.orientedRevision_=-1,n.orientedFlatCoordinates_=null,void 0!==e&&i?(n.setFlatCoordinates(e,t),n.ends_=i):n.setCoordinates(t,e),n}return mh(n,r),n.prototype.appendLinearRing=function(t){this.flatCoordinates?g(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},n.prototype.clone=function(){return new n(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},n.prototype.closestPointXY=function(t,e,i,n){return n<Ct(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ya(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),za(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,n))},n.prototype.containsXY=function(t,e){return Ja(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)},n.prototype.getArea=function(){return hh(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},n.prototype.getCoordinates=function(t){var e;return void 0!==t?gh(e=this.getOrientedFlatCoordinates().slice(),0,this.ends_,this.stride,t):e=this.flatCoordinates,Gn(e,0,this.ends_,this.stride)},n.prototype.getEnds=function(){return this.ends_},n.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var t=Xt(this.getExtent());this.flatInteriorPoint_=ph(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},n.prototype.getInteriorPoint=function(){return new sh(this.getFlatInteriorPoint(),Co)},n.prototype.getLinearRingCount=function(){return this.ends_.length},n.prototype.getLinearRing=function(t){return t<0||this.ends_.length<=t?null:new ch(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},n.prototype.getLinearRings=function(){for(var t=this.layout,e=this.flatCoordinates,i=this.ends_,n=[],r=0,o=0,s=i.length;o<s;++o){var a=i[o],h=new ch(e.slice(r,a),t);n.push(h),r=a}return n},n.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;_h(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=gh(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},n.prototype.getSimplifiedGeometryInternal=function(t){var e=[],i=[];return e.length=dr(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new n(e,mo,i)},n.prototype.getType=function(){return Qt.POLYGON},n.prototype.intersectsExtent=function(t){return th(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)},n.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var i=Ba(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()},n}(Eo);function Ch(t){var e=t[0],i=t[1],n=t[2],r=t[3],o=[e,i,e,r,n,r,n,i,e,i];return new xh(o,mo,[o.length])}function wh(t,e,i){for(var n=e||32,r=t.getStride(),o=t.getLayout(),s=t.getCenter(),a=r*(n+1),h=new Array(a),l=0;l<a;l+=r){h[l]=0,h[l+1]=0;for(var u=2;u<r;u++)h[l+u]=s[u]}var c=[h.length],p=new xh(h,o,c);return function(t,e,i,n){for(var r=t.getFlatCoordinates(),o=t.getStride(),s=r.length/o-1,a=n||0,h=0;h<=s;++h){var l=h*o,u=a+2*H(h,s)*Math.PI/s;r[l]=e[0]+i*Math.cos(u),r[l+1]=e[1]+i*Math.sin(u)}t.changed()}(p,s,t.getRadius(),i),p}var Sh,Eh,Oh=(Sh=function(t,e){return(Sh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Sh(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Ih=function(c){function n(t,e,i){var n=c.call(this)||this;if(n.ends_=[],n.maxDelta_=-1,n.maxDeltaRevision_=-1,Array.isArray(t[0]))n.setCoordinates(t,e);else if(void 0!==e&&i)n.setFlatCoordinates(e,t),n.ends_=i;else{for(var r=n.getLayout(),o=t,s=[],a=[],h=0,l=o.length;h<l;++h){var u=o[h];0===h&&(r=u.getLayout()),g(s,u.getFlatCoordinates()),a.push(s.length)}n.setFlatCoordinates(r,s),n.ends_=a}return n}return Oh(n,c),n.prototype.appendLineString=function(t){this.flatCoordinates?g(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},n.prototype.clone=function(){return new n(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},n.prototype.closestPointXY=function(t,e,i,n){return n<Ct(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ya(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),za(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,n))},n.prototype.getCoordinateAtM=function(t,e,i){if(this.layout!=Co&&this.layout!=wo||0===this.flatCoordinates.length)return null;var n=void 0!==e&&e,r=void 0!==i&&i;return function(t,e,i,n,r,o,s){if(s)return Za(t,e,i[i.length-1],n,r,o);var a;if(r<t[n-1])return o?((a=t.slice(0,n))[n-1]=r,a):null;if(t[t.length-1]<r)return o?((a=t.slice(t.length-n))[n-1]=r,a):null;for(var h=0,l=i.length;h<l;++h){var u=i[h];if(e!=u){if(r<t[e+n-1])return null;if(r<=t[u-1])return Za(t,e,u,n,r,!1);e=u}}return null}(this.flatCoordinates,0,this.ends_,this.stride,t,n,r)},n.prototype.getCoordinates=function(){return Gn(this.flatCoordinates,0,this.ends_,this.stride)},n.prototype.getEnds=function(){return this.ends_},n.prototype.getLineString=function(t){return t<0||this.ends_.length<=t?null:new rh(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},n.prototype.getLineStrings=function(){for(var t=this.flatCoordinates,e=this.ends_,i=this.layout,n=[],r=0,o=0,s=e.length;o<s;++o){var a=e[o],h=new rh(t.slice(r,a),i);n.push(h),r=a}return n},n.prototype.getFlatMidpoints=function(){for(var t=[],e=this.flatCoordinates,i=0,n=this.ends_,r=this.stride,o=0,s=n.length;o<s;++o){var a=n[o];g(t,Ha(e,i,a,r,.5)),i=a}return t},n.prototype.getSimplifiedGeometryInternal=function(t){var e=[],i=[];return e.length=function(t,e,i,n,r,o,s,a){for(var h=0,l=i.length;h<l;++h){var u=i[h];s=cr(t,e,u,n,r,o,s),a.push(s),e=u}return s}(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i),new n(e,mo,i)},n.prototype.getType=function(){return Qt.MULTI_LINE_STRING},n.prototype.intersectsExtent=function(t){return function(t,e,i,n,r){for(var o=0,s=i.length;o<s;++o){if($a(t,e,i[o],n,r))return!0;e=i[o]}return!1}(this.flatCoordinates,0,this.ends_,this.stride,t)},n.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var i=Ba(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()},n}(Eo),Th=(Eh=function(t,e){return(Eh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Eh(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Ph=function(n){function t(t,e){var i=n.call(this)||this;return e&&!Array.isArray(t[0])?i.setFlatCoordinates(e,t):i.setCoordinates(t,e),i}return Th(t,n),t.prototype.appendPoint=function(t){this.flatCoordinates?g(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()},t.prototype.clone=function(){return new t(this.flatCoordinates.slice(),this.layout)},t.prototype.closestPointXY=function(t,e,i,n){if(n<Ct(this.getExtent(),t,e))return n;for(var r=this.flatCoordinates,o=this.stride,s=0,a=r.length;s<a;s+=o){var h=V(t,e,r[s],r[s+1]);if(h<n){n=h;for(var l=0;l<o;++l)i[l]=r[s+l];i.length=o}}return n},t.prototype.getCoordinates=function(){return Dn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},t.prototype.getPoint=function(t){var e=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||e<=t?null:new sh(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)},t.prototype.getPoints=function(){for(var t=this.flatCoordinates,e=this.layout,i=this.stride,n=[],r=0,o=t.length;r<o;r+=i){var s=new sh(t.slice(r,r+i),e);n.push(s)}return n},t.prototype.getType=function(){return Qt.MULTI_POINT},t.prototype.intersectsExtent=function(t){for(var e=this.flatCoordinates,i=this.stride,n=0,r=e.length;n<r;n+=i){if(Et(t,e[n],e[n+1]))return!0}return!1},t.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Va(this.flatCoordinates,0,t,this.stride),this.changed()},t}(Eo);var Rh,Lh,bh=(Rh=function(t,e){return(Rh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Rh(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Fh=function(_){function n(t,e,i){var n=_.call(this)||this;if(n.endss_=[],n.flatInteriorPointsRevision_=-1,n.flatInteriorPoints_=null,n.maxDelta_=-1,n.maxDeltaRevision_=-1,n.orientedRevision_=-1,n.orientedFlatCoordinates_=null,!i&&!Array.isArray(t[0])){for(var r=n.getLayout(),o=t,s=[],a=[],h=0,l=o.length;h<l;++h){var u=o[h];0===h&&(r=u.getLayout());for(var c=s.length,p=u.getEnds(),f=0,d=p.length;f<d;++f)p[f]+=c;g(s,u.getFlatCoordinates()),a.push(p)}e=r,t=s,i=a}return void 0!==e&&i?(n.setFlatCoordinates(e,t),n.endss_=i):n.setCoordinates(t,e),n}return bh(n,_),n.prototype.appendPolygon=function(t){var e;if(this.flatCoordinates){var i=this.flatCoordinates.length;g(this.flatCoordinates,t.getFlatCoordinates());for(var n=0,r=(e=t.getEnds().slice()).length;n<r;++n)e[n]+=i}else this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();this.endss_.push(e),this.changed()},n.prototype.clone=function(){for(var t=this.endss_.length,e=new Array(t),i=0;i<t;++i)e[i]=this.endss_[i].slice();return new n(this.flatCoordinates.slice(),this.layout,e)},n.prototype.closestPointXY=function(t,e,i,n){return n<Ct(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function(t,e,i,n,r){for(var o=0,s=i.length;o<s;++o){var a=i[o];r=Ya(t,e,a,n,r),e=a[a.length-1]}return r}(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function(t,e,i,n,r,o,s,a,h,l,u){for(var c=u||[NaN,NaN],p=0,f=i.length;p<f;++p){var d=i[p];l=za(t,e,d,n,r,o,s,a,h,l,c),e=d[d.length-1]}return l}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,n))},n.prototype.containsXY=function(t,e){return function(t,e,i,n,r,o){if(0===i.length)return!1;for(var s=0,a=i.length;s<a;++s){var h=i[s];if(Ja(t,e,h,n,r,o))return!0;e=h[h.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)},n.prototype.getArea=function(){return function(t,e,i,n){for(var r=0,o=0,s=i.length;o<s;++o){var a=i[o];r+=hh(t,e,a,n),e=a[a.length-1]}return r}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},n.prototype.getCoordinates=function(t){var e;return void 0!==t?yh(e=this.getOrientedFlatCoordinates().slice(),0,this.endss_,this.stride,t):e=this.flatCoordinates,kn(e,0,this.endss_,this.stride)},n.prototype.getEndss=function(){return this.endss_},n.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var t=function(t,e,i,n){for(var r=[],o=[1/0,1/0,-1/0,-1/0],s=0,a=i.length;s<a;++s){var h=i[s];o=bt(t,e,h[0],n),r.push((o[0]+o[2])/2,(o[1]+o[3])/2),e=h[h.length-1]}return r}(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=function(t,e,i,n,r){for(var o=[],s=0,a=i.length;s<a;++s){var h=i[s];o=ph(t,e,h,n,r,2*s,o),e=h[h.length-1]}return o}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},n.prototype.getInteriorPoints=function(){return new Ph(this.getFlatInteriorPoints().slice(),Co)},n.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;!function(t,e,i,n,r){for(var o=0,s=i.length;o<s;++o){var a=i[o];if(!_h(t,e,a,n,r))return!1;a.length&&(e=a[a.length-1])}return!0}(t,0,this.endss_,this.stride)?(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=yh(this.orientedFlatCoordinates_,0,this.endss_,this.stride)):this.orientedFlatCoordinates_=t,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},n.prototype.getSimplifiedGeometryInternal=function(t){var e=[],i=[];return e.length=function(t,e,i,n,r,o,s,a){for(var h=0,l=i.length;h<l;++h){var u=i[h],c=[];s=dr(t,e,u,n,r,o,s,c),a.push(c),e=u[u.length-1]}return s}(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i),new n(e,mo,i)},n.prototype.getPolygon=function(t){if(t<0||this.endss_.length<=t)return null;var e;if(0===t)e=0;else{var i=this.endss_[t-1];e=i[i.length-1]}var n=this.endss_[t].slice(),r=n[n.length-1];if(0!==e)for(var o=0,s=n.length;o<s;++o)n[o]-=e;return new xh(this.flatCoordinates.slice(e,r),this.layout,n)},n.prototype.getPolygons=function(){for(var t=this.layout,e=this.flatCoordinates,i=this.endss_,n=[],r=0,o=0,s=i.length;o<s;++o){var a=i[o].slice(),h=a[a.length-1];if(0!==r)for(var l=0,u=a.length;l<u;++l)a[l]-=r;var c=new xh(e.slice(r,h),t,a);n.push(c),r=h}return n},n.prototype.getType=function(){return Qt.MULTI_POLYGON},n.prototype.intersectsExtent=function(t){return function(t,e,i,n,r){for(var o=0,s=i.length;o<s;++o){var a=i[o];if(th(t,e,a,n,r))return!0;e=a[a.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)},n.prototype.setCoordinates=function(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);var i=function(t,e,i,n,r){for(var o=r||[],s=0,a=0,h=i.length;a<h;++a){var l=Ba(t,e,i[a],n,o[s]);e=(o[s++]=l)[l.length-1]}return o.length=s,o}(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===i.length)this.flatCoordinates.length=0;else{var n=i[i.length-1];this.flatCoordinates.length=0===n.length?0:n[n.length-1]}this.changed()},n}(Eo),Mh=(Lh=function(t,e){return(Lh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Lh(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Ah=function(r){function n(t){var e=r.call(this)||this;if(e.id_=void 0,e.geometryName_="geometry",e.style_=null,e.styleFunction_=void 0,e.geometryChangeKey_=null,e.addEventListener(F(e.geometryName_),e.handleGeometryChanged_),t)if("function"==typeof t.getSimplifiedGeometry){var i=t;e.setGeometry(i)}else{var n=t;e.setProperties(n)}return e}return Mh(n,r),n.prototype.clone=function(){var t=new n(this.getProperties());t.setGeometryName(this.getGeometryName());var e=this.getGeometry();e&&t.setGeometry(e.clone());var i=this.getStyle();return i&&t.setStyle(i),t},n.prototype.getGeometry=function(){return this.get(this.geometryName_)},n.prototype.getId=function(){return this.id_},n.prototype.getGeometryName=function(){return this.geometryName_},n.prototype.getStyle=function(){return this.style_},n.prototype.getStyleFunction=function(){return this.styleFunction_},n.prototype.handleGeometryChange_=function(){this.changed()},n.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(l(this.geometryChangeKey_),this.geometryChangeKey_=null);var t=this.getGeometry();t&&(this.geometryChangeKey_=a(t,p.CHANGE,this.handleGeometryChange_,this)),this.changed()},n.prototype.setGeometry=function(t){this.set(this.geometryName_,t)},n.prototype.setStyle=function(t){this.style_=t,this.styleFunction_=t?function(t){{if("function"==typeof t)return t;var e;if(Array.isArray(t))e=t;else{Q("function"==typeof t.getZIndex,41);var i=t;e=[i]}return function(){return e}}}(t):void 0,this.changed()},n.prototype.setId=function(t){this.id_=t,this.changed()},n.prototype.setGeometryName=function(t){this.removeEventListener(F(this.geometryName_),this.handleGeometryChanged_),this.geometryName_=t,this.addEventListener(F(this.geometryName_),this.handleGeometryChanged_),this.handleGeometryChanged_()},n}(L);var Dh=[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135,.298582141697,.14929107084,.07464553542,.03732276771];function Gh(t){return t instanceof sh?t.getCoordinates():t instanceof xh?t.getInteriorPoint().getCoordinates():Xt(t.getExtent())}function kh(t){var e="",i=null;return"string"==typeof t?Yh(t,"rgba")?i=Wh(t):e=t:Array.isArray(t)&&(i=t),null!==i&&(e=["rgb(",i[0],",",i[1],",",i[2],")"].join("")),e}function Nh(t){var e=null,i=null;return"string"==typeof t?Yh(t,"rgba")&&(i=Wh(t)):Array.isArray(t)&&(i=t),i&&void 0!==i[3]&&(e=+i[3]),e}function jh(t){var e=null;return t instanceof In?e=t:t instanceof hs||t instanceof Ah?(e=t.getStyle())&&e instanceof Function&&(e=e()[0]):t instanceof Function&&(e=t()[0]),e}function Wh(t){var e=null,i=t.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/);return i&&i.length&&(e=[+i[1],+i[2],+i[3],+i[4]]),e}function Yh(t,e){return 0===t.indexOf(e)}var Xh=function(t){function e(){t.call(this),this.drawn_=!1,this.height_=0,this.width_=0}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.draw=function(){if(this.drawn_)this.redraw_();else{var t=this.canvas_;if(t){var e=t.getContext("2d"),i=e.canvas.height,n=e.canvas.width;this.width_=n,this.height_=i,this.redraw_()&&(this.drawn_=!0)}}},e.prototype.redraw_=function(){var t=this.get("position");if(!t)return!1;var e=this.getProjection();if(!e)return!1;var i=e.fromLatLngToDivPixel(t),n=this.height_,r=this.width_,o=this.get("offsetX")||0,s=this.get("offsetY")||0,a=this.canvas_.style;return a.top=i.y-n/2+s+"px",a.left=i.x-r/2+o+"px",a.visibility=this.getVisible_(),!0},e.prototype.getVisible_=function(){var t=this.get("minZoom"),e=this.get("maxZoom");if(void 0===t&&void 0===e)return"";var i=this.getMap();if(!i)return"";var n=i.getZoom();return n<t||e<n?"hidden":""},e.prototype.onRemove=function(){var t=this.canvas_;t&&t.parentNode&&t.parentNode.removeChild(t)},e}(window.google&&window.google.maps&&google.maps.OverlayView||Object),zh=function(e){function t(t){e.call(this),this.set("font","normal 10px sans-serif"),this.set("textAlign","center"),this.set("textBaseline","middle"),this.set("zIndex",1e3),this.setValues(t)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.changed=function(t){switch(t){case"fontColor":case"fontFamily":case"fontSize":case"fontWeight":case"strokeColor":case"strokeWeight":case"text":case"textAlign":case"textBaseline":this.drawCanvas_();break;case"maxZoom":case"minZoom":case"offsetX":case"offsetY":case"position":this.draw()}},t.prototype.drawCanvas_=function(){var t=this.canvas_;if(t){var e=t.style,i=this.get("fontColor");if(i){e.zIndex=this.get("zIndex");var n=t.getContext("2d");n.clearRect(0,0,t.width,t.height),n.textBaseline=this.get("textBaseline"),n.strokeStyle=this.get("strokeColor"),n.fillStyle=i,n.font=this.get("font"),n.textAlign=this.get("textAlign");var r=this.get("text");if(r){var o=t.width/2,s=t.height/2,a=Number(this.get("strokeWeight"));a&&(n.lineWidth=a,n.strokeText(r,o,s)),this.wrapText(n,r,o,s)}}}},t.prototype.adjustCanvasSize=function(){var t=document.createElement("canvas");t.width=t.height=1;var e=this.get("text").split("\r\n"),i=this.measureTextHeight(this.get("font")),n=t.getContext("2d");n.font=this.get("font");for(var r=0;r<e.length;r++){var o=n.measureText(e[r]);o.width>this.canvas_.width&&(this.canvas_.width+=o.width)}var s=i*e.length*2;s>this.canvas_.height&&(this.canvas_.height=s);var a=2*(this.canvas_.width+2);this.canvas_.width=a},t.prototype.measureTextHeight=function(t){var e=0;if(t){var i=document.createElement("div");i.innerHTML="M",i.style.margin=i.style.padding="0 !important",i.style.position="absolute !important",i.style.left="-99999px !important",i.style.font=t,document.body.appendChild(i),e=i.offsetHeight,document.body.removeChild(i)}return e},t.prototype.wrapText=function(t,e,i,n){for(var r=e.split("\r\n"),o=0,s=0;s<r.length;s++){var a=t.measureText(r[s]);o=1.2*(a.actualBoundingBoxAscent+a.actualBoundingBoxDescent),t.fillText(r[s],i,n),n+=o}},t.prototype.onAdd=function(){var t=this.canvas_=document.createElement("canvas");this.adjustCanvasSize(),t.style.position="absolute",t.getContext("2d").lineJoin="round",this.drawCanvas_();var e=this.getPanes();if(e){var i=this.get("olgm_pane");i&&(i=e[i]),i||(i=e.markerLayer),i.appendChild(t)}},t}(Xh),Uh=function(i){function t(t,e){i.call(this),this.imageStyle_=t,this.setValues(e)}return i&&(t.__proto__=i),((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.changed=function(t){switch(t){case"maxZoom":case"minZoom":case"offsetX":case"offsetY":case"position":this.draw()}},t.prototype.rotate_=function(t,e,i,n){return[i*t-n*e,i*e+n*t]},t.prototype.drawCanvas_=function(){var t=this.canvas_;if(t){var e=this.imageStyle_.getImage(1);if(e){t.style.zIndex=this.get("zIndex");var i=this.imageStyle_.getScale()||1,n=this.imageStyle_.getAnchor()||[0,0],r=this.imageStyle_.getRotation()||0,o=this.imageStyle_.getOpacity()||1,s=n[0]*i,a=n[1]*i,h=e.width*i*.5,l=e.height*i*.5;h+=Math.abs(h-s),l+=Math.abs(l-a);var u=Math.cos(r),c=Math.sin(r),p=this.rotate_(u,c,-h,-l),f=this.rotate_(u,c,+h,-l),d=this.rotate_(u,c,-h,+l),_=this.rotate_(u,c,+h,+l),g=Math.min(p[0],f[0],d[0],_[0]),y=Math.max(p[0],f[0],d[0],_[0]),v=Math.min(p[1],f[1],d[1],_[1]),m=Math.max(p[1],f[1],d[1],_[1]);t.width=Math.round(y-g),t.height=Math.round(m-v);var x=t.getContext("2d");x.clearRect(0,0,t.width,t.height);var C=t.width/2-s,w=t.height/2-a;x.translate(C+s,w+a),x.rotate(r),x.translate(-C-s,-w-a),x.globalAlpha=o,x.drawImage(e,C,w,e.width*i,e.height*i)}}},t.prototype.onAdd=function(){var t=this.canvas_=document.createElement("canvas");t.style.position="absolute",this.drawCanvas_();var e=this.getPanes();if(e){var i=this.get("olgm_pane");i&&(i=e[i]),i||(i=e.markerLayer),i.appendChild(t)}},t}(Xh);function Vh(t,e){var i=null;return t instanceof sh?i=Bh(t,e):(t instanceof Ph||t instanceof rh||t instanceof Ih||t instanceof xh||t instanceof Fh)&&(i=function(t,e){var i=void 0!==e?e.getView().getProjection():"EPSG:3857",n=null;if(t instanceof rh){var r=Hh(t.getCoordinates(),i);n=new google.maps.Data.LineString(r)}else if(t instanceof xh){var o=Hh(t.getCoordinates()[0],i);n=new google.maps.Data.Polygon([o])}else if(t instanceof Ih){var s=Zh(t.getCoordinates(),i);n=new google.maps.Data.MultiLineString(s)}else if(t instanceof Fh){var a=function(t,e){for(var i=[],n=0,r=t.length;n<r;n++){var o=Zh(t[n].getCoordinates(),e),s=new google.maps.Data.Polygon(o);i.push(s)}return i}(t.getPolygons(),i);n=new google.maps.Data.MultiPolygon(a)}else if(t instanceof Ph){var h=Hh(t.getCoordinates(),i);n=new google.maps.Data.MultiPoint(h)}return n}(t,e)),js(null!==i,"Expected geometry to be module:ol/geom/Point|MultiPoint|LineString|MultiLineString|Polygon|MultiPolygon"),i}function Bh(t,e){var i=void 0!==e?e.getView().getProjection():"EPSG:3857",n=Fe(t instanceof sh?t.getCoordinates():t,i,"EPSG:4326");return new google.maps.LatLng(n[1],n[0])}function Hh(t,e){for(var i,n=e||"EPSG:3857",r=[],o=0,s=t.length;o<s;o++)i=Fe(t[o],n,"EPSG:4326"),r.push(new google.maps.LatLng(i[1],i[0]));return r}function Zh(t,e){for(var i=e||"EPSG:3857",n=[],r=0,o=t.length;r<o;r++)n.push(Hh(t[r],i));return n}function Kh(t,e,i){var n=null,r=jh(t);return r&&(n=function(t,e,i){var n={},r=t.getStroke();if(r){var o=r.getColor();if(o){n.strokeColor=kh(o);var s=Nh(o);null!==s&&(n.strokeOpacity=s)}var a=r.getWidth();a&&(n.strokeWeight=a)}var h=t.getFill();if(h){var l=h.getColor();if(l){n.fillColor=kh(l);var u=Nh(l);null!==u&&(n.fillOpacity=u)}}var c=t.getImage();if(c){var p={},f={},d=void 0!==e.useCanvas&&e.useCanvas;if(c instanceof Sn||c instanceof Cn){if(c instanceof Sn)f.path=google.maps.SymbolPath.CIRCLE;else if(c instanceof Cn){var _="M ",g=c.getPoints(),y=c.getRadius(),v=void 0!==c.getRadius2()?c.getRadius2():c.getRadius(),m=c.getRotation()+c.getAngle();0==v&&void 0===c.getRadius2()&&(g/=2),v!==y&&(g*=2);for(var x=0;x<g;x++){var C=x%2==0?y:v,w=2*x*Math.PI/g-Math.PI/2+m,S=.1*C*Math.cos(w),E=.1*C*Math.sin(w);_+=S+","+E+" "}_+="Z",f.path=_}var O=c.getStroke();if(O){var I=O.getColor();I&&(f.strokeColor=kh(I)),f.strokeWeight=O.getWidth()}var T=c.getFill();if(T){var P=T.getColor();if(P){f.fillColor=kh(P);var R=Nh(P);f.fillOpacity=null!==R?R:1}}var L=c.getRadius();L&&(f.scale=L)}else if(c instanceof es&&!d){var b=c.getSrc();b&&(f.url=b);var F=c.getScale(),M=c.getAnchor();M&&(f.anchor=void 0!==F?new google.maps.Point(M[0]*F,M[1]*F):new google.maps.Point(M[0],M[1]));var A=c.getOrigin();A&&(f.origin=new google.maps.Point(A[0],A[1]));var D=c.getSize();D&&(f.size=new google.maps.Size(D[0],D[1]),void 0!==F&&(f.scaledSize=new google.maps.Size(D[0]*F,D[1]*F)))}Object.keys(p).length?n.icon=p:Object.keys(f).length&&(n.icon=f)}if(0===Object.keys(n).length)n.visible=!1;else if(void 0!==i){var G=2*i;n.zIndex=G}return n}(r,e,i)),n}var qh=function(r){function t(t,e,i){r.call(this,t,e),this.feature_=i.feature,this.featureListener_=null,this.data_=i.data,this.index_=i.index,this.mapIconOptions_=i.mapIconOptions,this.visible_=void 0===i.visible||i.visible,this.gmapFeature_=null,this.label_=null,this.marker_=null}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.activate=function(){var t,e,i,n=this;r.prototype.activate.call(this),this.gmapFeature_=(t=this.feature_,i=Vh(t.getGeometry(),e),new google.maps.Data.Feature({geometry:i})),this.visible_&&this.data_.add(this.gmapFeature_),this.updateStyle_(),this.featureListener_=new Vs(this.feature_.on("change",function(){return n.handleFeatureChange_()})),this.listener=new Bs(this.feature_,null,this.feature_.getGeometryName(),function(t,e){return e&&n.handleGeometryChange_(),new Vs(t.on("change",function(){return n.handleGeometryChange_()}))})},t.prototype.deactivate=function(){this.featureListener_&&this.featureListener_.unlisten(),this.data_.remove(this.gmapFeature_),this.gmapFeature_=null,this.marker_&&(this.marker_.setMap(null),this.marker_=null),this.label_&&(this.label_.setMap(null),this.label_=null),r.prototype.deactivate.call(this)},t.prototype.setVisible=function(t){t&&!this.visible_?(this.data_.add(this.gmapFeature_),this.marker_&&this.marker_.setMap(this.gmap),this.label_&&this.label_.setMap(this.gmap),this.visible_=!0):!t&&this.visible_&&(this.data_.remove(this.gmapFeature_),this.marker_&&this.marker_.setMap(null),this.label_&&this.label_.setMap(null),this.visible_=!1)},t.prototype.getGeometry_=function(){var t=this.feature_.getGeometry();return js(void 0!==t,"Expected feature to have geometry"),t},t.prototype.handleGeometryChange_=function(){var t,e=this.getGeometry_();this.gmapFeature_.setGeometry(Vh(e)),this.label_&&(t=Bh(Gh(e)),this.label_.set("position",t)),this.marker_&&(t=Bh(Gh(e)),this.marker_.set("position",t))},t.prototype.handleFeatureChange_=function(){this.updateStyle_()},t.prototype.updateStyle_=function(){var t={useCanvas:this.feature_.useCanvas||this.mapIconOptions_.useCanvas},e=Kh(this.feature_,t,this.index_);this.data_.overrideStyle(this.gmapFeature_,e);var i,n,r,o,s=this.marker_,a=this.label_,h=jh(this.feature_);if(h){var l=Bh(Gh(this.getGeometry_())),u=h.getZIndex(),c=void 0!==u?u:this.index_,p=h.getImage();p&&p instanceof es&&t.useCanvas&&(this.marker_=(i=p,n=l,r=c,o=this.feature_.get("olgm_pane"),new Uh(i,{align:"center",position:n,olgm_pane:o,zIndex:2*r+1})),this.visible_&&this.marker_.setMap(this.gmap));var f=h.getText();f&&(this.label_=function(t,e,i,n){var r={align:"center",position:e,olgm_pane:n,zIndex:2*i+1},o=t.getText();o&&(r.text=o);var s=t.getFont();s&&(r.font=s);var a=t.getFill();if(a){var h=a.getColor();h&&(r.fontColor=h)}var l=t.getStroke();if(l){var u=l.getColor();u&&(r.strokeColor=u);var c=l.getWidth();c&&(r.strokeWeight=c)}var p=t.getOffsetX();p&&(r.offsetX=p);var f=t.getOffsetY();f&&(r.offsetY=f);var d=t.getTextAlign();d&&(r.textAlign=d);var _=t.getTextBaseline();return _&&(r.textBaseline=_),new zh(r)}(f,l,c,this.feature_.get("olgm_pane")),this.visible_&&this.label_.setMap(this.gmap))}s&&s.setMap(null),a&&a.setMap(null)},t}(ls),Jh=function(o){function t(t,e,i,n,r){o.call(this,t,e),this.features_=[],this.cache_=[],this.data_=n,this.source_=i,this.mapIconOptions_=r,this.visible_=!0}return o&&(t.__proto__=o),((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.activate=function(){var e=this;o.prototype.activate.call(this),this.source_.getFeatures().forEach(function(t){return e.watchFeature_(t)}),this.listener=new Vs([this.source_.on("addfeature",function(t){return e.handleAddFeature_(t)}),this.source_.on("removefeature",function(t){return e.handleRemoveFeature_(t)})])},t.prototype.deactivate=function(){var e=this;this.source_.getFeatures().forEach(function(t){return e.unwatchFeature_(t)}),o.prototype.deactivate.call(this)},t.prototype.setVisible=function(t){this.visible_=t;for(var e=0;e<this.cache_.length;e++)this.cache_[e].herald.setVisible(t)},t.prototype.handleAddFeature_=function(t){var e=t.feature;this.watchFeature_(e)},t.prototype.handleRemoveFeature_=function(t){var e=t.feature;this.unwatchFeature_(e)},t.prototype.watchFeature_=function(t){var e=this.ol3map,i=this.gmap,n=this.data_;this.features_.push(t);var r={feature:t,data:n,index:this.features_.indexOf(t),mapIconOptions:this.mapIconOptions_,visible:this.visible_},o=new qh(e,i,r);o.activate(),this.cache_.push({feature:t,herald:o})},t.prototype.unwatchFeature_=function(t){var e=this.features_.indexOf(t);-1!==e&&(this.features_.splice(e,1),this.cache_[e].herald.deactivate(),this.cache_.splice(e,1))},t}(ls),Qh=function(n){function t(t,e,i){n.call(this,t,e),this.cache_=[],this.layers_=[],this.mapIconOptions_=i}return n&&(t.__proto__=n),((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.watchLayer=function(t){var i=this,e=t,n=e.getSource();if(n&&!1!==e.get("olgmWatch")){this.layers_.push(e);var r=new google.maps.Data({map:this.gmap}),o=Kh(e,this.mapIconOptions_);o&&r.setStyle(o);var s=new Jh(this.ol3map,this.gmap,n,r,this.mapIconOptions_),a=e.getOpacity(),h={data:r,herald:s,layer:e,listeners:[],opacity:a};h.listeners.push(new Bs(this.ol3map,null,"view",function(t,e){return[new Bs(t,e,"resolution",function(){return i.handleResolutionChange_(h)}),new Bs(t,e,"visible",function(){return i.handleVisibleChange_(h)})]})),this.activateCacheItem_(h),this.cache_.push(h)}},t.prototype.unwatchLayer=function(t){var e=t,i=this.layers_.indexOf(e);if(-1!==i){this.layers_.splice(i,1);var n=this.cache_[i];n.listeners.forEach(function(t){return t.unlisten()}),n.data.setMap(null),n.herald.deactivate(),e.setOpacity(n.opacity),this.cache_.splice(i,1)}},t.prototype.activate=function(){n.prototype.activate.call(this),this.cache_.forEach(this.activateCacheItem_,this)},t.prototype.activateCacheItem_=function(t){t.layer.getVisible()&&this.googleMapsIsActive&&(t.herald.activate(),t.layer.setOpacity(0))},t.prototype.deactivate=function(){n.prototype.deactivate.call(this),this.cache_.forEach(this.deactivateCacheItem_,this)},t.prototype.deactivateCacheItem_=function(t){t.herald.deactivate(),t.layer.setOpacity(t.opacity)},t.prototype.handleResolutionChange_=function(t){var e=t.layer,i=e.getMinResolution(),n=e.getMaxResolution(),r=this.ol3map.getView().getResolution();r<i||n<r?t.herald.setVisible(!1):t.herald.setVisible(!0)},t.prototype.handleVisibleChange_=function(t){t.layer.getVisible()?this.activateCacheItem_(t):this.deactivateCacheItem_(t)},t}(Ys);function $h(t,e){var i=t.ol_lm;return i?i[e]:void 0}function tl(t,e,i,n,r){var o,s,a=((s=(o=t).ol_lm)||(s=o.ol_lm={}),s),h=a[e];h||(h=a[e]=[]);var l,u,c=function(t,e,i,n){for(var r,o=0,s=t.length;o<s;++o)if((r=t[o]).listener===e&&r.bindTo===i)return n&&(r.deleteIndex=o),r}(h,i,n,!1);return c?r||(c.callOnce=!1):(c={bindTo:n,callOnce:!!r,listener:i,target:t,type:e},t.addEventListener(e,(u=function(t){var e=l.listener,i=l.bindTo||l.target;return l.callOnce&&el(l),e.call(i,t)},(l=c).boundListener=u)),h.push(c)),c}function el(t){if(t&&t.target){t.target.removeEventListener(t.type,t.boundListener);var e=$h(t.target,t.type);if(e){var i="deleteIndex"in t?t.deleteIndex:e.indexOf(t);-1!==i&&e.splice(i,1),0===e.length&&function(t,e){var i=$h(t,e);if(i){for(var n=0,r=i.length;n<r;++n)t.removeEventListener(e,i[n].boundListener),zs(i[n]);i.length=0;var o=t.ol_lm;o&&(delete o[e],0===Object.keys(o).length&&delete t.ol_lm)}}(t.target,t.type)}zs(t)}}var il,nl,rl=function(n){function t(t,e){n.call(this,t,e),this.windowResizeTimerId_=null,this.windowListenerKey_=null}return n&&(t.__proto__=n),((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.activate=function(){var i=this;n.prototype.activate.call(this),this.ol3map.getView().setConstrainResolution(!0),this.listener=new Bs(this.ol3map,null,"view",function(t,e){return e&&(i.setRotation(),i.setZoomAndCenter()),new Vs([t.on("change:center",function(){return i.setCenter()}),t.on("change:resolution",function(){return i.setZoomAndCenter()}),t.on("change:rotation",function(){return i.setRotation()})])}),this.windowListenerKey_=tl(window,"resize",this.handleWindowResize_,this,!1),google.maps.event.addListenerOnce(this.gmap,"idle",function(){i.setRotation(),i.setZoomAndCenter()})},t.prototype.deactivate=function(){n.prototype.deactivate.call(this),this.ol3map.getView().setConstrainResolution(!1),el(this.windowListenerKey_)},t.prototype.setCenter=function(){var t=this.ol3map.getView(),e=t.getProjection(),i=t.getCenter();if(Array.isArray(i)){var n=Fe(i,e,"EPSG:4326"),r=n[0],o=n[1];this.gmap.setCenter(new google.maps.LatLng(o,r))}},t.prototype.setRotation=function(){for(var t,e=this.ol3map.getView().getRotation(),i=this.gmap.getDiv(),n=0;n<i.childNodes.length;n++){var r=i.childNodes[n];if("DIV"===r.nodeName){t=r;break}}var o=t.childNodes[0];if(o){var s=o.style;if(s.transform="rotate("+e+"rad)",!this.ol3map.getSize())return;var a=this.ol3map.getSize()[0],h=this.ol3map.getSize()[1];if(a!=h&&0!=e){var l=Math.max(a,h),u=i.style;u.width=l+"px",u.height=l+"px",this.ol3map.getTargetElement().style.overflow="hidden";var c=a-l,p=h-l;s.top=p/2+"px",s.left=c/2+"px",google.maps.event.trigger(this.gmap,"resize"),this.setZoomAndCenter();for(var f=t.childNodes,d=0;d<f.length;d++){var _=f[d].style;"0px"==_.bottom&&(_.bottom=Math.abs(p)+"px")}var g=this.ol3map.getViewport().style;"100%"==g.height&&(g.height=h+"px")}}},t.prototype.setZoomAndCenter=function(){var t,e=this.ol3map.getView().getResolution();if("number"==typeof e){var i=(t=e,(this.ol3map.getView().getMinZoom()||0)+Math.log(Dh[0]/t)/Math.log(2));this.gmap.setZoom(i)}this.setCenter()},t.prototype.handleWindowResize_=function(){this.windowResizeTimerId_&&window.clearTimeout(this.windowResizeTimerId_),this.windowResizeTimerId_=window.setTimeout(this.setCenterAfterResize_.bind(this),100)},t.prototype.setCenterAfterResize_=function(){this.setCenter(),this.windowResizeTimerId_=null},t}(ls),ol=function(i){function t(t){var e=t||{};i.call(this,e),this.mapTypeId_=void 0!==e.mapTypeId?e.mapTypeId:google.maps.MapTypeId.ROADMAP,this.styles_=e.styles?e.styles:null}return i&&(t.__proto__=i),((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getMapTypeId=function(){return this.mapTypeId_},t.prototype.getStyles=function(){return this.styles_},t}(an),sl=function(o){function t(t,e,i,n){var r=this;o.call(this,t,e),this.googleLayers_=[],this.googleCache_=[],this.imageWMSSourceHerald_=new Hs(t,e),this.tileSourceHerald_=new Na(t,e),this.vectorSourceHerald_=new Qh(t,e,i),this.viewHerald_=new rl(t,e),this.watchOptions_=n,this.gmapEl_=e.getDiv(),this.ol3mapEl_=t.getViewport(),this.targetEl_=t.getTargetElement(),this.googleMapsIsActive_=!1,this.ol3mapIsRenderered_=!1,this.ol3map.getView().getCenter()?this.ol3map.once("postrender",function(){r.ol3mapIsRenderered_=!0,r.toggleGoogleMaps_()}):this.ol3map.getView().once("change:center",function(){r.ol3map.once("postrender",function(){r.ol3mapIsRenderered_=!0,r.toggleGoogleMaps_()}),r.toggleGoogleMaps_()})}return o&&(t.__proto__=o),((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.activate=function(){var i=this;o.prototype.activate.call(this),this.listener=new Bs(this.ol3map,null,"layergroup",function(t,e){return new Bs(t,e,"layers",function(t,e){return e&&e.forEach(function(t){return i.unwatchLayer_(t)}),t.forEach(function(t){return i.watchLayer_(t)}),new Vs([t.on("add",function(t){return i.handleLayersAdd_(t)}),t.on("remove",function(t){return i.handleLayersRemove_(t)})])})})},t.prototype.deactivate=function(){var e=this;this.ol3map.getLayers().forEach(function(t){return e.unwatchLayer_(t)}),o.prototype.deactivate.call(this)},t.prototype.getGoogleMapsActive=function(){return this.googleMapsIsActive_},t.prototype.setGoogleMapsActive_=function(t){this.googleMapsIsActive_=t,this.imageWMSSourceHerald_.setGoogleMapsActive(t),this.tileSourceHerald_.setGoogleMapsActive(t),this.vectorSourceHerald_.setGoogleMapsActive(t)},t.prototype.setWatchOptions=function(t){this.watchOptions_=t,this.deactivate(),this.activate()},t.prototype.handleLayersAdd_=function(t){var e=t.element;this.watchLayer_(e),this.orderLayers()},t.prototype.handleLayersRemove_=function(t){var e=t.element;this.unwatchLayer_(e),this.orderLayers()},t.prototype.watchLayer_=function(t){t instanceof ol?this.watchGoogleLayer_(t):t instanceof hs&&!1!==this.watchOptions_.vector?this.vectorSourceHerald_.watchLayer(t):t instanceof an&&!1!==this.watchOptions_.tile?this.tileSourceHerald_.watchLayer(t):t instanceof Xi&&!1!==this.watchOptions_.image&&this.imageWMSSourceHerald_.watchLayer(t)},t.prototype.watchGoogleLayer_=function(t){var e=this;this.googleLayers_.push(t),this.googleCache_.push({layer:t,listener:new Bs(t,null,"visible",function(){return e.toggleGoogleMaps_()})})},t.prototype.unwatchLayer_=function(t){t instanceof ol?this.unwatchGoogleLayer_(t):t instanceof hs?this.vectorSourceHerald_.unwatchLayer(t):t instanceof an?this.tileSourceHerald_.unwatchLayer(t):t instanceof Xi&&this.imageWMSSourceHerald_.unwatchLayer(t)},t.prototype.unwatchGoogleLayer_=function(t){var e=this.googleLayers_.indexOf(t);-1!==e&&(this.googleLayers_.splice(e,1),this.googleCache_[e].listener.unlisten(),this.googleCache_.splice(e,1),this.toggleGoogleMaps_())},t.prototype.activateGoogleMaps_=function(){var t=this.ol3map.getView().getCenter();if(!this.googleMapsIsActive_&&this.ol3mapIsRenderered_&&t){this.targetEl_.removeChild(this.ol3mapEl_),this.targetEl_.appendChild(this.gmapEl_);var e=parseInt(google.maps.ControlPosition.TOP_LEFT,10);this.gmap.controls[e].push(this.ol3mapEl_),this.viewHerald_.activate(),google.maps.event.trigger(this.gmap,"resize"),this.viewHerald_.setRotation(),this.viewHerald_.setZoomAndCenter(),this.setGoogleMapsActive_(!0),this.imageWMSSourceHerald_.activate(),this.tileSourceHerald_.activate(),this.vectorSourceHerald_.activate(),this.orderLayers()}},t.prototype.deactivateGoogleMaps_=function(){if(this.googleMapsIsActive_){var t=parseInt(google.maps.ControlPosition.TOP_LEFT,10);this.gmap.controls[t].removeAt(0),this.targetEl_.removeChild(this.gmapEl_),this.targetEl_.appendChild(this.ol3mapEl_),this.viewHerald_.deactivate(),this.ol3mapEl_.style.position="relative",this.imageWMSSourceHerald_.deactivate(),this.tileSourceHerald_.deactivate(),this.vectorSourceHerald_.deactivate(),this.setGoogleMapsActive_(!1)}},t.prototype.toggleGoogleMaps_=function(){var e=null;if(this.ol3map.getLayers().getArray().slice(0).reverse().every(function(t){return!(t instanceof ol&&t.getVisible()&&-1!==this.googleLayers_.indexOf(t))||(e=t,!1)},this),e){this.activateGoogleMaps_(),this.gmap.setMapTypeId(e.getMapTypeId());var t=e.getStyles();t?this.gmap.setOptions({styles:t}):this.gmap.setOptions({styles:null})}else this.deactivateGoogleMaps_()},t.prototype.orderLayers=function(){this.imageWMSSourceHerald_.orderLayers(),this.tileSourceHerald_.orderLayers()},t.prototype.refresh=function(){this.imageWMSSourceHerald_.refresh()},t}(ls),al=function(s){function t(t){var e=document.createElement("div");e.style.height="inherit",e.style.width="inherit";var i=Xs({disableDefaultUI:!0,disableDoubleClickZoom:!0,draggable:!1,keyboardShortcuts:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1,streetViewControl:!1},t.gmapOptions),n=new google.maps.Map(e,i);s.call(this,t.map,n),this.heralds_=[];var r=void 0!==t.watch?t.watch:{},o=void 0!==t.mapIconOptions?t.mapIconOptions:{};this.layersHerald_=new sl(this.ol3map,this.gmap,o,r),this.heralds_.push(this.layersHerald_),this.active_=!1}return s&&(t.__proto__=s),((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.activate=function(){if(!this.active_){for(var t=0,e=this.heralds_.length;t<e;t++)this.heralds_[t].activate();this.active_=!0}},t.prototype.deactivate=function(){if(this.active_){for(var t=0,e=this.heralds_.length;t<e;t++)this.heralds_[t].deactivate();this.active_=!1}},t.prototype.getGoogleMapsActive=function(){return this.active_&&this.layersHerald_.getGoogleMapsActive()},t.prototype.getGoogleMapsMap=function(){return this.gmap},t.prototype.setWatchOptions=function(t){var e=void 0!==t?t:{};this.layersHerald_.setWatchOptions(e)},t.prototype.toggle=function(){this.active_?this.deactivate():this.activate()},t.prototype.orderLayers=function(){this.layersHerald_.orderLayers()},t.prototype.refresh=function(){this.layersHerald_.refresh()},t}(t),hl="add",ll="remove",ul=(il=function(t,e){return(il=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}il(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),cl="length",pl=function(r){function t(t,e,i){var n=r.call(this,t)||this;return n.element=e,n.index=i,n}return ul(t,r),t}(w),fl=function(s){function t(t,e){var i=s.call(this)||this,n=e||{};if(i.unique_=!!n.unique,i.array_=t||[],i.unique_)for(var r=0,o=i.array_.length;r<o;++r)i.assertUnique_(i.array_[r],r);return i.updateLength_(),i}return ul(t,s),t.prototype.clear=function(){for(;0<this.getLength();)this.pop()},t.prototype.extend=function(t){for(var e=0,i=t.length;e<i;++e)this.push(t[e]);return this},t.prototype.forEach=function(t){for(var e=this.array_,i=0,n=e.length;i<n;++i)t(e[i],i,e)},t.prototype.getArray=function(){return this.array_},t.prototype.item=function(t){return this.array_[t]},t.prototype.getLength=function(){return this.get(cl)},t.prototype.insertAt=function(t,e){this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new pl(hl,e,t))},t.prototype.pop=function(){return this.removeAt(this.getLength()-1)},t.prototype.push=function(t){this.unique_&&this.assertUnique_(t);var e=this.getLength();return this.insertAt(e,t),this.getLength()},t.prototype.remove=function(t){for(var e=this.array_,i=0,n=e.length;i<n;++i)if(e[i]===t)return this.removeAt(i)},t.prototype.removeAt=function(t){var e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new pl(ll,e,t)),e},t.prototype.setAt=function(t,e){var i=this.getLength();if(t<i){this.unique_&&this.assertUnique_(e,t);var n=this.array_[t];this.array_[t]=e,this.dispatchEvent(new pl(ll,n,t)),this.dispatchEvent(new pl(hl,e,t))}else{for(var r=i;r<t;++r)this.insertAt(r,void 0);this.insertAt(t,e)}},t.prototype.updateLength_=function(){this.set(cl,this.array_.length)},t.prototype.assertUnique_=function(t,e){for(var i=0,n=this.array_.length;i<n;++i)if(this.array_[i]===t&&i!==e)throw new J(58)},t}(L),dl=function(){function t(t,e,i){this.decay_=t,this.minVelocity_=e,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}return t.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},t.prototype.update=function(t,e){this.points_.push(t,e,Date.now())},t.prototype.end=function(){if(this.points_.length<6)return!1;var t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;for(var i=e-3;0<i&&this.points_[i+2]>t;)i-=3;var n=this.points_[e+2]-this.points_[i+2];if(n<1e3/60)return!1;var r=this.points_[e]-this.points_[i],o=this.points_[e+1]-this.points_[i+1];return this.angle_=Math.atan2(o,r),this.initialVelocity_=Math.sqrt(r*r+o*o)/n,this.initialVelocity_>this.minVelocity_},t.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},t.prototype.getAngle=function(){return this.angle_},t}(),_l={SINGLECLICK:"singleclick",CLICK:p.CLICK,DBLCLICK:p.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},gl="active",yl=(nl=function(t,e){return(nl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}nl(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),vl=function(i){function t(t){var e=i.call(this)||this;return t.handleEvent&&(e.handleEvent=t.handleEvent),e.map_=null,e.setActive(!0),e}return yl(t,i),t.prototype.getActive=function(){return this.get(gl)},t.prototype.getMap=function(){return this.map_},t.prototype.handleEvent=function(t){return!0},t.prototype.setActive=function(t){this.set(gl,t)},t.prototype.setMap=function(t){this.map_=t},t}(L);function ml(t,e,i,n){var r=t.getZoom();if(void 0!==r){var o=t.getConstrainedZoom(r+e),s=t.getResolutionForZoom(o);t.getAnimating()&&t.cancelAnimations(),t.animate({resolution:s,anchor:i,duration:void 0!==n?n:250,easing:Ks})}}var xl,Cl=(xl=function(t,e){return(xl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}xl(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),wl=function(n){function t(t){var e=n.call(this,{handleEvent:Sl})||this,i=t||{};return e.delta_=i.delta?i.delta:1,e.duration_=void 0!==i.duration?i.duration:250,e}return Cl(t,n),t}(vl);function Sl(t){var e=!1;if(t.type==_l.DBLCLICK){var i=t.originalEvent,n=t.map,r=t.coordinate,o=i.shiftKey?-this.delta_:this.delta_;ml(n.getView(),o,r,this.duration_),t.preventDefault(),e=!0}return!e}function El(t,e){var i,n,r=t[0],o=t[1],s=e[0],a=e[1],h=s[0],l=s[1],u=a[0],c=a[1],p=u-h,f=c-l,d=0===p&&0===f?0:(p*(r-h)+f*(o-l))/(p*p+f*f||0);return d<=0?(i=h,n=l):1<=d?(i=u,n=c):(i=h+d*p,n=l+d*f),[i,n]}function Ol(t,e){for(var i=!0,n=t.length-1;0<=n;--n)if(t[n]!=e[n]){i=!1;break}return i}function Il(t,e){var i=Math.cos(e),n=Math.sin(e),r=t[0]*i-t[1]*n,o=t[1]*i+t[0]*n;return t[0]=r,t[1]=o,t}function Tl(t,e){var i=t[0]-e[0],n=t[1]-e[1];return i*i+n*n}function Pl(t,e){return Math.sqrt(Tl(t,e))}function Rl(t,e){return Tl(t,El(t,e))}var Ll,bl=function(t){var e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Fl=function(t){return t.target.getTargetElement()===document.activeElement},Ml=_,Al=function(t){var e=t.originalEvent;return 0==e.button&&!(jo&&Wo&&e.ctrlKey)},Dl=v,Gl=function(t){return t.type==_l.SINGLECLICK},kl=function(t){var e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},Nl=function(t){var e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},jl=function(t){var e=t.target.tagName;return"INPUT"!==e&&"SELECT"!==e&&"TEXTAREA"!==e},Wl=function(t){var e=t.pointerEvent;return Q(void 0!==e,56),"mouse"==e.pointerType},Yl=function(t){var e=t.pointerEvent;return Q(void 0!==e,56),e.isPrimary&&0===e.button},Xl=(Ll=function(t,e){return(Ll=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Ll(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),zl=function(n){function t(t){var e=this,i=t||{};return e=n.call(this,i)||this,i.handleDownEvent&&(e.handleDownEvent=i.handleDownEvent),i.handleDragEvent&&(e.handleDragEvent=i.handleDragEvent),i.handleMoveEvent&&(e.handleMoveEvent=i.handleMoveEvent),i.handleUpEvent&&(e.handleUpEvent=i.handleUpEvent),i.stopDown&&(e.stopDown=i.stopDown),e.handlingDownUpSequence=!1,e.trackedPointers_={},e.targetPointers=[],e}return Xl(t,n),t.prototype.handleDownEvent=function(t){return!1},t.prototype.handleDragEvent=function(t){},t.prototype.handleEvent=function(t){if(!t.pointerEvent)return!0;var e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==_l.POINTERDRAG)this.handleDragEvent(t);else if(t.type==_l.POINTERUP){var i=this.handleUpEvent(t);this.handlingDownUpSequence=i&&0<this.targetPointers.length}}else if(t.type==_l.POINTERDOWN){var n=this.handleDownEvent(t);n&&t.preventDefault(),this.handlingDownUpSequence=n,e=this.stopDown(n)}else t.type==_l.POINTERMOVE&&this.handleMoveEvent(t);return!e},t.prototype.handleMoveEvent=function(t){},t.prototype.handleUpEvent=function(t){return!1},t.prototype.stopDown=function(t){return t},t.prototype.updateTrackedPointers_=function(t){if((n=t.type)===_l.POINTERDOWN||n===_l.POINTERDRAG||n===_l.POINTERUP){var e=t.pointerEvent,i=e.pointerId.toString();t.type==_l.POINTERUP?delete this.trackedPointers_[i]:t.type==_l.POINTERDOWN?this.trackedPointers_[i]=e:i in this.trackedPointers_&&(this.trackedPointers_[i]=e),this.targetPointers=o(this.trackedPointers_)}var n},t}(vl);function Ul(t){for(var e=t.length,i=0,n=0,r=0;r<e;r++)i+=t[r].clientX,n+=t[r].clientY;return[i/e,n/e]}var Vl,Bl=(Vl=function(t,e){return(Vl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Vl(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Hl=function(n){function t(t){var e=n.call(this,{stopDown:v})||this,i=t||{};return e.kinetic_=i.kinetic,e.lastCentroid=null,e.lastPointersCount_,e.panning_=!1,e.condition_=i.condition?i.condition:Zl,e.noKinetic_=!1,e}return Bl(t,n),t.prototype.handleDragEvent=function(t){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());var e,i,n=this.targetPointers,r=Ul(n);if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){var o=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],s=t.map.getView();e=o,i=s.getResolution(),e[0]*=i,e[1]*=i,Il(o,s.getRotation()),s.adjustCenterInternal(o)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=n.length},t.prototype.handleUpEvent=function(t){var e=t.map,i=e.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var n=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),o=i.getCenterInternal(),s=e.getPixelFromCoordinateInternal(o),a=e.getCoordinateFromPixelInternal([s[0]-n*Math.cos(r),s[1]-n*Math.sin(r)]);i.animateInternal({center:i.getConstrainedCenter(a),duration:500,easing:Ks})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),!(this.lastCentroid=null)},t.prototype.handleDownEvent=function(t){if(0<this.targetPointers.length&&this.condition_(t)){var e=t.map.getView();return this.lastCentroid=null,e.getAnimating()&&e.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=1<this.targetPointers.length,!0}return!1},t}(zl);function Zl(t){return kl(t)&&Yl(t)}function Kl(t){return void 0!==t?0:void 0}var ql,Jl,Ql,$l,tu=(ql=function(t,e){return(ql=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}ql(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),eu=function(n){function t(t){var e=this,i=t||{};return(e=n.call(this,{stopDown:v})||this).condition_=i.condition?i.condition:bl,e.lastAngle_=void 0,e.duration_=void 0!==i.duration?i.duration:250,e}return tu(t,n),t.prototype.handleDragEvent=function(t){if(Wl(t)){var e=t.map,i=e.getView();if(i.getConstraints().rotation!==Kl){var n=e.getSize(),r=t.pixel,o=Math.atan2(n[1]/2-r[1],r[0]-n[0]/2);if(void 0!==this.lastAngle_){var s=o-this.lastAngle_;i.adjustRotationInternal(-s)}this.lastAngle_=o}}},t.prototype.handleUpEvent=function(t){return!Wl(t)||(t.map.getView().endInteraction(this.duration_),!1)},t.prototype.handleDownEvent=function(t){return!!Wl(t)&&(!(!Al(t)||!this.condition_(t))&&(t.map.getView().beginInteraction(),!(this.lastAngle_=void 0)))},t}(zl),iu=(Jl=function(t,e){return(Jl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Jl(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),nu=function(i){function t(t){var e=i.call(this)||this;return e.geometry_=null,e.element_=document.createElement("div"),e.element_.style.position="absolute",e.element_.className="ol-box "+t,e.map_=null,e.startPixel_=null,e.endPixel_=null,e}return iu(t,i),t.prototype.disposeInternal=function(){this.setMap(null)},t.prototype.render_=function(){var t=this.startPixel_,e=this.endPixel_,i=this.element_.style;i.left=Math.min(t[0],e[0])+"px",i.top=Math.min(t[1],e[1])+"px",i.width=Math.abs(e[0]-t[0])+"px",i.height=Math.abs(e[1]-t[1])+"px"},t.prototype.setMap=function(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},t.prototype.setPixels=function(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()},t.prototype.createOrUpdateGeometry=function(){var t=this.startPixel_,e=this.endPixel_,i=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);i[4]=i[0].slice(),this.geometry_?this.geometry_.setCoordinates([i]):this.geometry_=new xh([i])},t.prototype.getGeometry=function(){return this.geometry_},t}(r),ru=(Ql=function(t,e){return(Ql=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Ql(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),ou="boxstart",su="boxdrag",au="boxend",hu=function(r){function t(t,e,i){var n=r.call(this,t)||this;return n.coordinate=e,n.mapBrowserEvent=i,n}return ru(t,r),t}(w),lu=function(n){function t(t){var e=n.call(this)||this,i=t||{};return e.box_=new nu(i.className||"ol-dragbox"),e.minArea_=void 0!==i.minArea?i.minArea:64,e.onBoxEnd_=i.onBoxEnd?i.onBoxEnd:m,e.startPixel_=null,e.condition_=i.condition?i.condition:Ml,e.boxEndCondition_=i.boxEndCondition?i.boxEndCondition:e.defaultBoxEndCondition,e}return ru(t,n),t.prototype.defaultBoxEndCondition=function(t,e,i){var n=i[0]-e[0],r=i[1]-e[1];return n*n+r*r>=this.minArea_},t.prototype.getGeometry=function(){return this.box_.getGeometry()},t.prototype.handleDragEvent=function(t){Wl(t)&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new hu(su,t.coordinate,t)))},t.prototype.handleUpEvent=function(t){return!Wl(t)||(this.box_.setMap(null),this.boxEndCondition_(t,this.startPixel_,t.pixel)&&(this.onBoxEnd_(t),this.dispatchEvent(new hu(au,t.coordinate,t))),!1)},t.prototype.handleDownEvent=function(t){return!!Wl(t)&&(!(!Al(t)||!this.condition_(t))&&(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new hu(ou,t.coordinate,t)),!0))},t}(zl),uu=($l=function(t,e){return($l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}$l(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),cu=function(r){function t(t){var e=this,i=t||{},n=i.condition?i.condition:Nl;return(e=r.call(this,{condition:n,className:i.className||"ol-dragzoom",minArea:i.minArea,onBoxEnd:pu})||this).duration_=void 0!==i.duration?i.duration:200,e.out_=void 0!==i.out&&i.out,e}return uu(t,r),t}(lu);function pu(){var t,e,i,n,r=this.getMap(),o=r.getView(),s=r.getSize(),a=this.getGeometry().getExtent();if(this.out_){var h=o.calculateExtentInternal(s),l=Lt([r.getPixelFromCoordinateInternal(Wt(a)),r.getPixelFromCoordinateInternal(Ht(a))]),u=o.getResolutionForExtentInternal(l,s);e=1/u,i=((t=h)[2]-t[0])/2*(e-1),n=(t[3]-t[1])/2*(e-1),t[0]-=i,t[2]+=i,t[1]-=n,t[3]+=n,a=h}var c=o.getConstrainedResolution(o.getResolutionForExtentInternal(a,s)),p=o.getConstrainedCenter(Xt(a),c);o.animateInternal({resolution:c,center:p,duration:this.duration_,easing:Ks})}var fu,du={LEFT:37,UP:38,RIGHT:39,DOWN:40},_u=(fu=function(t,e){return(fu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}fu(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),gu=function(n){function t(t){var e=n.call(this,{handleEvent:yu})||this,i=t||{};return e.defaultCondition_=function(t){return kl(t)&&jl(t)},e.condition_=void 0!==i.condition?i.condition:e.defaultCondition_,e.duration_=void 0!==i.duration?i.duration:100,e.pixelDelta_=void 0!==i.pixelDelta?i.pixelDelta:128,e}return _u(t,n),t}(vl);function yu(t){var e=!1;if(t.type==p.KEYDOWN){var i=t.originalEvent.keyCode;if(this.condition_(t)&&(i==du.DOWN||i==du.LEFT||i==du.RIGHT||i==du.UP)){var n=t.map.getView(),r=n.getResolution()*this.pixelDelta_,o=0,s=0;i==du.DOWN?s=-r:i==du.LEFT?o=-r:i==du.RIGHT?o=r:s=r;var a=[o,s];Il(a,n.getRotation()),function(t,e,i){var n=t.getCenterInternal();if(n){var r=[n[0]+e[0],n[1]+e[1]];t.animateInternal({duration:void 0!==i?i:250,easing:qs,center:t.getConstrainedCenter(r)})}}(n,a,this.duration_),t.preventDefault(),e=!0}}return!e}var vu,mu=(vu=function(t,e){return(vu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}vu(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),xu=function(n){function t(t){var e=n.call(this,{handleEvent:Cu})||this,i=t||{};return e.condition_=i.condition?i.condition:jl,e.delta_=i.delta?i.delta:1,e.duration_=void 0!==i.duration?i.duration:100,e}return mu(t,n),t}(vl);function Cu(t){var e=!1;if(t.type==p.KEYDOWN||t.type==p.KEYPRESS){var i=t.originalEvent.charCode;if(this.condition_(t)&&(i=="+".charCodeAt(0)||i=="-".charCodeAt(0))){var n=t.map,r=i=="+".charCodeAt(0)?this.delta_:-this.delta_;ml(n.getView(),r,void 0,this.duration_),t.preventDefault(),e=!0}}return!e}var wu,Su,Eu,Ou,Iu=(wu=function(t,e){return(wu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}wu(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Tu="trackpad",Pu="wheel",Ru=function(n){function t(t){var e=this,i=t||{};return(e=n.call(this,i)||this).totalDelta_=0,e.lastDelta_=0,e.maxDelta_=void 0!==i.maxDelta?i.maxDelta:1,e.duration_=void 0!==i.duration?i.duration:250,e.timeout_=void 0!==i.timeout?i.timeout:80,e.useAnchor_=void 0===i.useAnchor||i.useAnchor,e.condition_=i.condition?i.condition:Ml,e.lastAnchor_=null,e.startTime_=void 0,e.timeoutId_,e.mode_=void 0,e.trackpadEventGap_=400,e.trackpadTimeoutId_,e.trackpadDeltaPerZoom_=300,e}return Iu(t,n),t.prototype.endInteraction_=function(){this.trackpadTimeoutId_=void 0,this.getMap().getView().endInteraction(void 0,Math.sign(this.lastDelta_),this.lastAnchor_)},t.prototype.handleEvent=function(t){if(!this.condition_(t))return!0;if(t.type!==p.WHEEL)return!0;t.preventDefault();var e,i=t.map,n=t.originalEvent;if(this.useAnchor_&&(this.lastAnchor_=t.coordinate),t.type==p.WHEEL&&(e=n.deltaY,No&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(e/=Yo),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(e*=40)),0===e)return!1;this.lastDelta_=e;var r=Date.now();if(void 0===this.startTime_&&(this.startTime_=r),(!this.mode_||r-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(e)<4?Tu:Pu),this.mode_===Tu){var o=i.getView();return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):o.beginInteraction(),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.trackpadEventGap_),o.adjustZoom(-e/this.trackpadDeltaPerZoom_,this.lastAnchor_),this.startTime_=r,!1}this.totalDelta_+=e;var s=Math.max(this.timeout_-(r-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),s),!1},t.prototype.handleWheelZoom_=function(t){var e=t.getView();e.getAnimating()&&e.cancelAnimations(),ml(e,-X(this.totalDelta_,-this.maxDelta_,this.maxDelta_),this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},t.prototype.setMouseAnchor=function(t){(this.useAnchor_=t)||(this.lastAnchor_=null)},t}(vl),Lu=(Su=function(t,e){return(Su=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Su(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),bu=function(r){function t(t){var e=this,i=t||{},n=i;return n.stopDown||(n.stopDown=v),(e=r.call(this,n)||this).anchor_=null,e.lastAngle_=void 0,e.rotating_=!1,e.rotationDelta_=0,e.threshold_=void 0!==i.threshold?i.threshold:.3,e.duration_=void 0!==i.duration?i.duration:250,e}return Lu(t,r),t.prototype.handleDragEvent=function(t){var e=0,i=this.targetPointers[0],n=this.targetPointers[1],r=Math.atan2(n.clientY-i.clientY,n.clientX-i.clientX);if(void 0!==this.lastAngle_){var o=r-this.lastAngle_;this.rotationDelta_+=o,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=o}this.lastAngle_=r;var s=t.map,a=s.getView();if(a.getConstraints().rotation!==Kl){var h=s.getViewport().getBoundingClientRect(),l=Ul(this.targetPointers);l[0]-=h.left,l[1]-=h.top,this.anchor_=s.getCoordinateFromPixelInternal(l),this.rotating_&&(s.render(),a.adjustRotationInternal(e,this.anchor_))}},t.prototype.handleUpEvent=function(t){return!(this.targetPointers.length<2)||(t.map.getView().endInteraction(this.duration_),!1)},t.prototype.handleDownEvent=function(t){if(2<=this.targetPointers.length){var e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1},t}(zl),Fu=(Eu=function(t,e){return(Eu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Eu(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Mu=function(r){function t(t){var e=this,i=t||{},n=i;return n.stopDown||(n.stopDown=v),(e=r.call(this,n)||this).anchor_=null,e.duration_=void 0!==i.duration?i.duration:400,e.lastDistance_=void 0,e.lastScaleDelta_=1,e}return Fu(t,r),t.prototype.handleDragEvent=function(t){var e=1,i=this.targetPointers[0],n=this.targetPointers[1],r=i.clientX-n.clientX,o=i.clientY-n.clientY,s=Math.sqrt(r*r+o*o);void 0!==this.lastDistance_&&(e=this.lastDistance_/s),this.lastDistance_=s;var a=t.map,h=a.getView();1!=e&&(this.lastScaleDelta_=e);var l=a.getViewport().getBoundingClientRect(),u=Ul(this.targetPointers);u[0]-=l.left,u[1]-=l.top,this.anchor_=a.getCoordinateFromPixelInternal(u),a.render(),h.adjustResolutionInternal(e,this.anchor_)},t.prototype.handleUpEvent=function(t){if(this.targetPointers.length<2){var e=t.map.getView(),i=1<this.lastScaleDelta_?1:-1;return e.endInteraction(this.duration_,i),!1}return!0},t.prototype.handleDownEvent=function(t){if(2<=this.targetPointers.length){var e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1},t}(zl),Au=(Ou=function(t,e){return(Ou=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Ou(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Du="addfeatures",Gu=function(o){function t(t,e,i,n){var r=o.call(this,t)||this;return r.features=i,r.file=e,r.projection=n,r}return Au(t,o),t}(w);!function(n){function t(t){var e=this,i=t||{};return(e=n.call(this,{handleEvent:_})||this).formatConstructors_=i.formatConstructors?i.formatConstructors:[],e.projection_=i.projection?Ie(i.projection):null,e.dropListenKeys_=null,e.source_=i.source||null,e.target=i.target?i.target:null,e}Au(t,n),t.prototype.handleResult_=function(t,e){var i=e.target.result,n=this.getMap(),r=this.projection_;r||(r=n.getView().getProjection());for(var o=this.formatConstructors_,s=[],a=0,h=o.length;a<h;++a){var l=new o[a];if((s=this.tryReadFeatures_(l,i,{featureProjection:r}))&&0<s.length)break}this.source_&&(this.source_.clear(),this.source_.addFeatures(s)),this.dispatchEvent(new Gu(Du,t,s,r))},t.prototype.registerListeners_=function(){var t=this.getMap();if(t){var e=this.target?this.target:t.getViewport();this.dropListenKeys_=[a(e,p.DROP,ku,this),a(e,p.DRAGENTER,Nu,this),a(e,p.DRAGOVER,Nu,this),a(e,p.DROP,Nu,this)]}},t.prototype.setActive=function(t){!this.getActive()&&t&&this.registerListeners_(),this.getActive()&&!t&&this.unregisterListeners_(),n.prototype.setActive.call(this,t)},t.prototype.setMap=function(t){this.unregisterListeners_(),n.prototype.setMap.call(this,t),this.getActive()&&this.registerListeners_()},t.prototype.tryReadFeatures_=function(t,e,i){try{return t.readFeatures(e,i)}catch(t){return null}},t.prototype.unregisterListeners_=function(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(l),this.dropListenKeys_=null)}}(vl);function ku(t){for(var e=t.dataTransfer.files,i=0,n=e.length;i<n;++i){var r=e.item(i),o=new FileReader;o.addEventListener(p.LOAD,this.handleResult_.bind(this,r)),o.readAsText(r)}}function Nu(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"}var ju,Wu,Yu,Xu,zu,Uu=(ju=function(t,e){return(ju=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}ju(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Vu=(function(n){function t(t){var e=this,i=t||{};return(e=n.call(this,i)||this).condition_=i.condition?i.condition:Nl,e.lastAngle_=void 0,e.lastMagnitude_=void 0,e.lastScaleDelta_=0,e.duration_=void 0!==i.duration?i.duration:400,e}Uu(t,n),t.prototype.handleDragEvent=function(t){if(Wl(t)){var e=t.map,i=e.getSize(),n=t.pixel,r=n[0]-i[0]/2,o=i[1]/2-n[1],s=Math.atan2(o,r),a=Math.sqrt(r*r+o*o),h=e.getView();if(void 0!==this.lastAngle_){var l=this.lastAngle_-s;h.adjustRotationInternal(l)}this.lastAngle_=s,void 0!==this.lastMagnitude_&&h.adjustResolutionInternal(this.lastMagnitude_/a),void 0!==this.lastMagnitude_&&(this.lastScaleDelta_=this.lastMagnitude_/a),this.lastMagnitude_=a}},t.prototype.handleUpEvent=function(t){if(!Wl(t))return!0;var e=t.map.getView(),i=1<this.lastScaleDelta_?1:-1;return e.endInteraction(this.duration_,i),this.lastScaleDelta_=0,!1},t.prototype.handleDownEvent=function(t){return!!Wl(t)&&(!!this.condition_(t)&&(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!(this.lastMagnitude_=void 0)))}}(zl),Wu=function(t,e){return(Wu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Wu(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Bu=function(r){function t(t,e,i){var n=r.call(this,t)||this;return n.map=e,n.frameState=void 0!==i?i:null,n}return Vu(t,r),t}(w),Hu=(Yu=function(t,e){return(Yu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Yu(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Zu=function(s){function t(t,e,i,n,r){var o=s.call(this,t,e,r)||this;return o.originalEvent=i,o.pixel_=null,o.coordinate_=null,o.dragging=void 0!==n&&n,o}return Hu(t,s),Object.defineProperty(t.prototype,"pixel",{get:function(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_},set:function(t){this.pixel_=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"coordinate",{get:function(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_},set:function(t){this.coordinate_=t},enumerable:!0,configurable:!0}),t.prototype.preventDefault=function(){s.prototype.preventDefault.call(this),this.originalEvent.preventDefault()},t.prototype.stopPropagation=function(){s.prototype.stopPropagation.call(this),this.originalEvent.stopPropagation()},t}(Bu),Ku=(Xu=function(t,e){return(Xu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Xu(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),qu=function(s){function t(t,e,i,n,r){var o=s.call(this,t,e,i,n,r)||this;return o.pointerEvent=i,o}return Ku(t,s),t}(Zu),Ju=(zu=function(t,e){return(zu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}zu(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Qu=function(o){function t(t,e,i){var n=o.call(this)||this;if(void 0!==i&&void 0===e)n.setFlatCoordinates(i,t);else{var r=e||0;n.setCenterAndRadius(t,r,i)}return n}return Ju(t,o),t.prototype.clone=function(){return new t(this.flatCoordinates.slice(),void 0,this.layout)},t.prototype.closestPointXY=function(t,e,i,n){var r=this.flatCoordinates,o=t-r[0],s=e-r[1],a=o*o+s*s;if(a<n){if(0===a)for(var h=0;h<this.stride;++h)i[h]=r[h];else{var l=this.getRadius()/Math.sqrt(a);i[0]=r[0]+l*o,i[1]=r[1]+l*s;for(h=2;h<this.stride;++h)i[h]=r[h]}return i.length=this.stride,a}return n},t.prototype.containsXY=function(t,e){var i=this.flatCoordinates,n=t-i[0],r=e-i[1];return n*n+r*r<=this.getRadiusSquared_()},t.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)},t.prototype.computeExtent=function(t){var e=this.flatCoordinates,i=e[this.stride]-e[0];return Tt(e[0]-i,e[1]-i,e[0]+i,e[1]+i,t)},t.prototype.getRadius=function(){return Math.sqrt(this.getRadiusSquared_())},t.prototype.getRadiusSquared_=function(){var t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e},t.prototype.getType=function(){return Qt.CIRCLE},t.prototype.intersectsExtent=function(t){if(Kt(t,this.getExtent())){var e=this.getCenter();return t[0]<=e[0]&&t[2]>=e[0]||(t[1]<=e[1]&&t[3]>=e[1]||Nt(t,this.intersectsCoordinate.bind(this)))}return!1},t.prototype.setCenter=function(t){var e=this.stride,i=this.flatCoordinates[e]-this.flatCoordinates[0],n=t.slice();n[e]=n[0]+i;for(var r=1;r<e;++r)n[e+r]=t[r];this.setFlatCoordinates(this.layout,n),this.changed()},t.prototype.setCenterAndRadius=function(t,e,i){this.setLayout(i,t,0),this.flatCoordinates||(this.flatCoordinates=[]);var n=this.flatCoordinates,r=Ua(n,0,t,this.stride);n[r++]=n[0]+e;for(var o=1,s=this.stride;o<s;++o)n[r++]=n[o];n.length=r,this.changed()},t.prototype.getCoordinates=function(){return null},t.prototype.setCoordinates=function(t,e){},t.prototype.setRadius=function(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()},t.prototype.rotate=function(t,e){var i=this.getCenter(),n=this.getStride();this.setCenter(Ir(i,0,i.length,n,t,e,i)),this.changed()},t.prototype.translate=function(t,e){var i=this.getCenter(),n=this.getStride();this.setCenter(Tr(i,0,i.length,n,t,e,i)),this.changed()},t}(Eo);Qu.prototype.transform;var $u={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"},tc=!1;function ec(t,e){return i=t,s=e,a=function(t,e){"function"==typeof this.addFeatures&&this.addFeatures(t)},h=m,function(n,t,r){var o=new XMLHttpRequest;o.open("GET","function"==typeof i?i(n,t,r):i,!0),s.getType()==$u.ARRAY_BUFFER&&(o.responseType="arraybuffer"),o.withCredentials=tc,o.onload=function(t){if(!o.status||200<=o.status&&o.status<300){var e=s.getType(),i=void 0;e==$u.JSON||e==$u.TEXT?i=o.responseText:e==$u.XML?(i=o.responseXML)||(i=(new DOMParser).parseFromString(o.responseText,"application/xml")):e==$u.ARRAY_BUFFER&&(i=o.response),i?a.call(this,s.readFeatures(i,{extent:n,featureProjection:r}),s.readProjection(i)):h.call(this)}else h.call(this)}.bind(this),o.onerror=function(){h.call(this)}.bind(this),o.send()};var i,s,a,h}function ic(t,e){return[[-1/0,-1/0,1/0,1/0]]}var nc,rc,oc="addfeature",sc="changefeature",ac="clear",hc="removefeature",lc=function(){function t(t){this.rbush_=new Ar(t),this.items_={}}return t.prototype.insert=function(t,e){var i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[dt(e)]=i},t.prototype.load=function(t,e){for(var i=new Array(e.length),n=0,r=e.length;n<r;n++){var o=t[n],s=e[n],a={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:s};i[n]=a,this.items_[dt(s)]=a}this.rbush_.load(i)},t.prototype.remove=function(t){var e=dt(t),i=this.items_[e];return delete this.items_[e],null!==this.rbush_.remove(i)},t.prototype.update=function(t,e){var i=this.items_[dt(e)];Ft([i.minX,i.minY,i.maxX,i.maxY],t)||(this.remove(e),this.insert(t,e))},t.prototype.getAll=function(){return this.rbush_.all().map(function(t){return t.value})},t.prototype.getInExtent=function(t){var e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(t){return t.value})},t.prototype.forEach=function(t){return this.forEach_(this.getAll(),t)},t.prototype.forEachInExtent=function(t,e){return this.forEach_(this.getInExtent(t),e)},t.prototype.forEach_=function(t,e){for(var i,n=0,r=t.length;n<r;n++)if(i=e(t[n]))return i;return i},t.prototype.isEmpty=function(){return e(this.items_)},t.prototype.clear=function(){this.rbush_.clear(),this.items_={}},t.prototype.getExtent=function(t){var e=this.rbush_.toJSON();return Tt(e.minX,e.minY,e.maxX,e.maxY,t)},t.prototype.concat=function(t){for(var e in this.rbush_.load(t.rbush_.all()),t.items_)this.items_[e]=t.items_[e]},t}(),uc=(nc=function(t,e){return(nc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}nc(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),cc=function(n){function t(t,e){var i=n.call(this,t)||this;return i.feature=e,i}return uc(t,n),t}(w),pc=function(s){function t(t){var e=this,i=t||{};(e=s.call(this,{attributions:i.attributions,projection:void 0,state:ht,wrapX:void 0===i.wrapX||i.wrapX})||this).loader_=m,e.format_=i.format,e.overlaps_=null==i.overlaps||i.overlaps,e.url_=i.url,void 0!==i.loader?e.loader_=i.loader:void 0!==e.url_&&(Q(e.format_,7),e.loader_=ec(e.url_,e.format_)),e.strategy_=void 0!==i.strategy?i.strategy:ic;var n,r,o=void 0===i.useSpatialIndex||i.useSpatialIndex;return e.featuresRtree_=o?new lc:null,e.loadedExtentsRtree_=new lc,e.nullGeometryFeatures_={},e.idIndex_={},e.uidIndex_={},e.featureChangeKeys_={},e.featuresCollection_=null,Array.isArray(i.features)?r=i.features:i.features&&(r=(n=i.features).getArray()),o||void 0!==n||(n=new fl(r)),void 0!==r&&e.addFeaturesInternal(r),void 0!==n&&e.bindFeaturesCollection_(n),e}return uc(t,s),t.prototype.addFeature=function(t){this.addFeatureInternal(t),this.changed()},t.prototype.addFeatureInternal=function(t){var e=dt(t);if(this.addToIndex_(e,t)){this.setupChangeEvents_(e,t);var i=t.getGeometry();if(i){var n=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new cc(oc,t))}else this.featuresCollection_&&this.featuresCollection_.remove(t)},t.prototype.setupChangeEvents_=function(t,e){this.featureChangeKeys_[t]=[a(e,p.CHANGE,this.handleFeatureChange_,this),a(e,n,this.handleFeatureChange_,this)]},t.prototype.addToIndex_=function(t,e){var i=!0,n=e.getId();return void 0!==n&&(n.toString()in this.idIndex_?i=!1:this.idIndex_[n.toString()]=e),i&&(Q(!(t in this.uidIndex_),30),this.uidIndex_[t]=e),i},t.prototype.addFeatures=function(t){this.addFeaturesInternal(t),this.changed()},t.prototype.addFeaturesInternal=function(t){for(var e=[],i=[],n=[],r=0,o=t.length;r<o;r++){var s=dt(h=t[r]);this.addToIndex_(s,h)&&i.push(h)}r=0;for(var a=i.length;r<a;r++){var h;s=dt(h=i[r]);this.setupChangeEvents_(s,h);var l=h.getGeometry();if(l){var u=l.getExtent();e.push(u),n.push(h)}else this.nullGeometryFeatures_[s]=h}this.featuresRtree_&&this.featuresRtree_.load(e,n);r=0;for(var c=i.length;r<c;r++)this.dispatchEvent(new cc(oc,i[r]))},t.prototype.bindFeaturesCollection_=function(e){var i=!1;this.addEventListener(oc,function(t){i||(i=!0,e.push(t.feature),i=!1)}),this.addEventListener(hc,function(t){i||(i=!0,e.remove(t.feature),i=!1)}),e.addEventListener(hl,function(t){i||(i=!0,this.addFeature(t.element),i=!1)}.bind(this)),e.addEventListener(ll,function(t){i||(i=!0,this.removeFeature(t.element),i=!1)}.bind(this)),this.featuresCollection_=e},t.prototype.clear=function(t){if(t){for(var e in this.featureChangeKeys_){this.featureChangeKeys_[e].forEach(l)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_)for(var i in this.featuresRtree_.forEach(this.removeFeatureInternal.bind(this)),this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i]);this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var n=new cc(ac);this.dispatchEvent(n),this.changed()},t.prototype.forEachFeature=function(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)},t.prototype.forEachFeatureAtCoordinateDirect=function(e,i){var t=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(t,function(t){return t.getGeometry().intersectsCoordinate(e)?i(t):void 0})},t.prototype.forEachFeatureInExtent=function(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)},t.prototype.forEachFeatureIntersectingExtent=function(i,n){return this.forEachFeatureInExtent(i,function(t){if(t.getGeometry().intersectsExtent(i)){var e=n(t);if(e)return e}})},t.prototype.getFeaturesCollection=function(){return this.featuresCollection_},t.prototype.getFeatures=function(){var t;return this.featuresCollection_?t=this.featuresCollection_.getArray():this.featuresRtree_&&(t=this.featuresRtree_.getAll(),e(this.nullGeometryFeatures_)||g(t,o(this.nullGeometryFeatures_))),t},t.prototype.getFeaturesAtCoordinate=function(t){var e=[];return this.forEachFeatureAtCoordinateDirect(t,function(t){e.push(t)}),e},t.prototype.getFeaturesInExtent=function(t){return this.featuresRtree_?this.featuresRtree_.getInExtent(t):this.featuresCollection_?this.featuresCollection_.getArray():[]},t.prototype.getClosestFeatureToCoordinate=function(t,e){var r=t[0],o=t[1],s=null,a=[NaN,NaN],h=1/0,l=[-1/0,-1/0,1/0,1/0],u=e||_;return this.featuresRtree_.forEachInExtent(l,function(t){if(u(t)){var e=t.getGeometry(),i=h;if((h=e.closestPointXY(r,o,a,h))<i){s=t;var n=Math.sqrt(h);l[0]=r-n,l[1]=o-n,l[2]=r+n,l[3]=o+n}}}),s},t.prototype.getExtent=function(t){return this.featuresRtree_.getExtent(t)},t.prototype.getFeatureById=function(t){var e=this.idIndex_[t.toString()];return void 0!==e?e:null},t.prototype.getFeatureByUid=function(t){var e=this.uidIndex_[t];return void 0!==e?e:null},t.prototype.getFormat=function(){return this.format_},t.prototype.getOverlaps=function(){return this.overlaps_},t.prototype.getUrl=function(){return this.url_},t.prototype.handleFeatureChange_=function(t){var e=t.target,i=dt(e),n=e.getGeometry();if(n){var r=n.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(r,e)):this.featuresRtree_&&this.featuresRtree_.update(r,e)}else i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);var o=e.getId();if(void 0!==o){var s=o.toString();this.idIndex_[s]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[s]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new cc(sc,e))},t.prototype.hasFeature=function(t){var e=t.getId();return void 0!==e?e in this.idIndex_:dt(t)in this.uidIndex_},t.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&e(this.nullGeometryFeatures_)},t.prototype.loadFeatures=function(t,n,r){var o=this.loadedExtentsRtree_,s=this.strategy_(t,n);this.loading=!1;for(var e=function(t,e){var i=s[t];o.forEachInExtent(i,function(t){return St(t.extent,i)})||(a.loader_.call(a,i,n,r),o.insert(i,{extent:i.slice()}),a.loading=a.loader_!==m)},a=this,i=0,h=s.length;i<h;++i)e(i)},t.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),s.prototype.refresh.call(this)},t.prototype.removeLoadedExtent=function(e){var i,t=this.loadedExtentsRtree_;t.forEachInExtent(e,function(t){if(Ft(t.extent,e))return i=t,!0}),i&&t.remove(i)},t.prototype.removeFeature=function(t){var e=dt(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t),this.changed()},t.prototype.removeFeatureInternal=function(t){var e=dt(t);this.featureChangeKeys_[e].forEach(l),delete this.featureChangeKeys_[e];var i=t.getId();void 0!==i&&delete this.idIndex_[i.toString()],delete this.uidIndex_[e],this.dispatchEvent(new cc(hc,t))},t.prototype.removeFromIdIndex_=function(t){var e=!1;for(var i in this.idIndex_)if(this.idIndex_[i]===t){delete this.idIndex_[i],e=!0;break}return e},t.prototype.setLoader=function(t){this.loader_=t},t.prototype.setUrl=function(t){Q(this.format_,7),this.setLoader(ec(t,this.format_))},t}(xs),fc=(rc=function(t,e){return(rc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}rc(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),dc={POINT:"Point",LINE_STRING:"LineString",POLYGON:"Polygon",CIRCLE:"Circle"},_c="drawstart",gc="drawend",yc=function(n){function t(t,e){var i=n.call(this,t)||this;return i.feature=e,i}return fc(t,n),t}(w);!function(a){function t(t){var e=this,i=t;i.stopDown||(i.stopDown=v),(e=a.call(this,i)||this).shouldHandle_=!1,e.downPx_=null,e.downTimeout_,e.lastDragTime_,e.freehand_=!1,e.source_=t.source?t.source:null,e.features_=t.features?t.features:null,e.snapTolerance_=t.snapTolerance?t.snapTolerance:12,e.type_=t.type,e.mode_=function(t){var e;t===Qt.POINT||t===Qt.MULTI_POINT?e=dc.POINT:t===Qt.LINE_STRING||t===Qt.MULTI_LINE_STRING?e=dc.LINE_STRING:t===Qt.POLYGON||t===Qt.MULTI_POLYGON?e=dc.POLYGON:t===Qt.CIRCLE&&(e=dc.CIRCLE);return e}(e.type_),e.stopClick_=!!t.stopClick,e.minPoints_=t.minPoints?t.minPoints:e.mode_===dc.POLYGON?3:2,e.maxPoints_=t.maxPoints?t.maxPoints:1/0,e.finishCondition_=t.finishCondition?t.finishCondition:_;var n,r=t.geometryFunction;if(!r)if(e.type_===Qt.CIRCLE)r=function(t,e){var i=e||new Qu([NaN,NaN]),n=Tl(t[0],t[1]);return i.setCenterAndRadius(t[0],Math.sqrt(n)),i};else{var o,s=e.mode_;s===dc.POINT?o=sh:s===dc.LINE_STRING?o=rh:s===dc.POLYGON&&(o=xh),r=function(t,e){var i=e;return i?s===dc.POLYGON?t[0].length?i.setCoordinates([t[0].concat([t[0][0]])]):i.setCoordinates([]):i.setCoordinates(t):i=new o(t),i}}return e.geometryFunction_=r,e.dragVertexDelay_=void 0!==t.dragVertexDelay?t.dragVertexDelay:500,e.finishCoordinate_=null,e.sketchFeature_=null,e.sketchPoint_=null,e.sketchCoords_=null,e.sketchLine_=null,e.sketchLineCoords_=null,e.squaredClickTolerance_=t.clickTolerance?t.clickTolerance*t.clickTolerance:36,e.overlay_=new hs({source:new pc({useSpatialIndex:!1,wrapX:!!t.wrapX&&t.wrapX}),style:t.style?t.style:(n=Rn(),function(t,e){return n[t.getGeometry().getType()]}),updateWhileInteracting:!0}),e.geometryName_=t.geometryName,e.condition_=t.condition?t.condition:kl,e.freehandCondition_,t.freehand?e.freehandCondition_=Ml:e.freehandCondition_=t.freehandCondition?t.freehandCondition:Nl,e.addEventListener(F(gl),e.updateState_),e}fc(t,a),t.prototype.setMap=function(t){a.prototype.setMap.call(this,t),this.updateState_()},t.prototype.getOverlay=function(){return this.overlay_},t.prototype.handleEvent=function(t){t.originalEvent.type===p.CONTEXTMENU&&t.preventDefault(),this.freehand_=this.mode_!==dc.POINT&&this.freehandCondition_(t);var e=t.type===_l.POINTERMOVE,i=!0;!this.freehand_&&this.lastDragTime_&&t.type===_l.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=t.pixel,this.shouldHandle_=!this.freehand_,e=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0));return this.freehand_&&t.type===_l.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(t),i=!1):this.freehand_&&t.type===_l.POINTERDOWN?i=!1:e?(i=t.type===_l.POINTERMOVE)&&this.freehand_?i=this.handlePointerMove_(t):("mouse"==t.pointerEvent.pointerType||t.type===_l.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(t):t.type===_l.DBLCLICK&&(i=!1),a.prototype.handleEvent.call(this,t)&&i},t.prototype.handleDownEvent=function(t){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=t.pixel,this.finishCoordinate_||this.startDrawing_(t),!0):this.condition_(t)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new qu(_l.POINTERMOVE,t.map,t.pointerEvent,!1,t.frameState))}.bind(this),this.dragVertexDelay_),this.downPx_=t.pixel,!0):(this.lastDragTime_=void 0,!1)},t.prototype.handleUpEvent=function(t){var e=!0;this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(t);var i=this.mode_===dc.CIRCLE;return this.shouldHandle_?(this.finishCoordinate_?this.freehand_||i?this.finishDrawing():this.atFinish_(t)?this.finishCondition_(t)&&this.finishDrawing():this.addToDrawing_(t):(this.startDrawing_(t),this.mode_===dc.POINT&&this.finishDrawing()),e=!1):this.freehand_&&(this.finishCoordinate_=null,this.abortDrawing_()),!e&&this.stopClick_&&t.stopPropagation(),e},t.prototype.handlePointerMove_=function(t){if(this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var e=this.downPx_,i=t.pixel,n=e[0]-i[0],r=e[1]-i[1],o=n*n+r*r;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return!0}return this.finishCoordinate_?this.modifyDrawing_(t):this.createOrUpdateSketchPoint_(t),!0},t.prototype.atFinish_=function(t){var e=!1;if(this.sketchFeature_){var i=!1,n=[this.finishCoordinate_];if(this.mode_===dc.LINE_STRING)i=this.sketchCoords_.length>this.minPoints_;else if(this.mode_===dc.POLYGON){var r=this.sketchCoords_;i=r[0].length>this.minPoints_,n=[r[0][0],r[0][r[0].length-2]]}if(i)for(var o=t.map,s=0,a=n.length;s<a;s++){var h=n[s],l=o.getPixelFromCoordinate(h),u=t.pixel,c=u[0]-l[0],p=u[1]-l[1],f=this.freehand_?1:this.snapTolerance_;if(e=Math.sqrt(c*c+p*p)<=f){this.finishCoordinate_=h;break}}}return e},t.prototype.createOrUpdateSketchPoint_=function(t){var e=t.coordinate.slice();this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new Ah(new sh(e)),this.updateSketchFeatures_())},t.prototype.startDrawing_=function(t){var e=t.coordinate;this.finishCoordinate_=e,this.mode_===dc.POINT?this.sketchCoords_=e.slice():this.mode_===dc.POLYGON?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Ah(new rh(this.sketchLineCoords_)));var i=this.geometryFunction_(this.sketchCoords_);this.sketchFeature_=new Ah,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(i),this.updateSketchFeatures_(),this.dispatchEvent(new yc(_c,this.sketchFeature_))},t.prototype.modifyDrawing_=function(t){var e,i,n,r=t.coordinate,o=this.sketchFeature_.getGeometry();(this.mode_===dc.POINT?i=this.sketchCoords_:this.mode_===dc.POLYGON?(i=(e=this.sketchCoords_[0])[e.length-1],this.atFinish_(t)&&(r=this.finishCoordinate_.slice())):i=(e=this.sketchCoords_)[e.length-1],i[0]=r[0],i[1]=r[1],this.geometryFunction_(this.sketchCoords_,o),this.sketchPoint_)&&this.sketchPoint_.getGeometry().setCoordinates(r);if(o.getType()==Qt.POLYGON&&this.mode_!==dc.POLYGON){this.sketchLine_||(this.sketchLine_=new Ah);var s=o.getLinearRing(0);(n=this.sketchLine_.getGeometry())?(n.setFlatCoordinates(s.getLayout(),s.getFlatCoordinates()),n.changed()):(n=new rh(s.getFlatCoordinates(),s.getLayout()),this.sketchLine_.setGeometry(n))}else this.sketchLineCoords_&&(n=this.sketchLine_.getGeometry()).setCoordinates(this.sketchLineCoords_);this.updateSketchFeatures_()},t.prototype.addToDrawing_=function(t){var e,i,n=t.coordinate,r=this.sketchFeature_.getGeometry();this.mode_===dc.LINE_STRING?(this.finishCoordinate_=n.slice(),(i=this.sketchCoords_).length>=this.maxPoints_&&(this.freehand_?i.pop():e=!0),i.push(n.slice()),this.geometryFunction_(i,r)):this.mode_===dc.POLYGON&&((i=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?i.pop():e=!0),i.push(n.slice()),e&&(this.finishCoordinate_=i[0]),this.geometryFunction_(this.sketchCoords_,r)),this.updateSketchFeatures_(),e&&this.finishDrawing()},t.prototype.removeLastPoint=function(){if(this.sketchFeature_){var t,e=this.sketchFeature_.getGeometry();this.mode_===dc.LINE_STRING?((t=this.sketchCoords_).splice(-2,1),this.geometryFunction_(t,e),2<=t.length&&(this.finishCoordinate_=t[t.length-2].slice())):this.mode_===dc.POLYGON&&((t=this.sketchCoords_[0]).splice(-2,1),this.sketchLine_.getGeometry().setCoordinates(t),this.geometryFunction_(this.sketchCoords_,e)),0===t.length&&(this.finishCoordinate_=null),this.updateSketchFeatures_()}},t.prototype.finishDrawing=function(){var t=this.abortDrawing_();if(t){var e=this.sketchCoords_,i=t.getGeometry();this.mode_===dc.LINE_STRING?(e.pop(),this.geometryFunction_(e,i)):this.mode_===dc.POLYGON&&(e[0].pop(),this.geometryFunction_(e,i),e=i.getCoordinates()),this.type_===Qt.MULTI_POINT?t.setGeometry(new Ph([e])):this.type_===Qt.MULTI_LINE_STRING?t.setGeometry(new Ih([e])):this.type_===Qt.MULTI_POLYGON&&t.setGeometry(new Fh([e])),this.dispatchEvent(new yc(gc,t)),this.features_&&this.features_.push(t),this.source_&&this.source_.addFeature(t)}},t.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var t=this.sketchFeature_;return t&&(this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0)),t},t.prototype.extend=function(t){var e=t.getGeometry();this.sketchFeature_=t,this.sketchCoords_=e.getCoordinates();var i=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=i.slice(),this.sketchCoords_.push(i.slice()),this.updateSketchFeatures_(),this.dispatchEvent(new yc(_c,this.sketchFeature_))},t.prototype.updateSketchFeatures_=function(){var t=[];this.sketchFeature_&&t.push(this.sketchFeature_),this.sketchLine_&&t.push(this.sketchLine_),this.sketchPoint_&&t.push(this.sketchPoint_);var e=this.overlay_.getSource();e.clear(!0),e.addFeatures(t)},t.prototype.updateState_=function(){var t=this.getMap(),e=this.getActive();t&&e||this.abortDrawing_(),this.overlay_.setMap(e?t:null)}}(zl);var vc,mc=(vc=function(t,e){return(vc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}vc(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),xc="extentchanged",Cc=function(i){function t(t){var e=i.call(this,xc)||this;return e.extent=t,e}return mc(t,i),t}(w);!function(o){function t(t){var i,n,e=this,r=t||{};return(e=o.call(this,r)||this).extent_=null,e.pointerHandler_=null,e.pixelTolerance_=void 0!==r.pixelTolerance?r.pixelTolerance:10,e.snappedToVertex_=!1,e.extentFeature_=null,e.vertexFeature_=null,t||(t={}),e.extentOverlay_=new hs({source:new pc({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.boxStyle?t.boxStyle:(i=Rn(),function(t,e){return i[Qt.POLYGON]}),updateWhileAnimating:!0,updateWhileInteracting:!0}),e.vertexOverlay_=new hs({source:new pc({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.pointerStyle?t.pointerStyle:(n=Rn(),function(t,e){return n[Qt.POINT]}),updateWhileAnimating:!0,updateWhileInteracting:!0}),t.extent&&e.setExtent(t.extent),e}mc(t,o),t.prototype.snapToVertex_=function(t,e){var i,n=e.getCoordinateFromPixelInternal(t),r=this.getExtentInternal();if(r){var o=[[[(i=r)[0],i[1]],[i[0],i[3]]],[[i[0],i[3]],[i[2],i[3]]],[[i[2],i[3]],[i[2],i[1]]],[[i[2],i[1]],[i[0],i[1]]]];o.sort(function(t,e){return Rl(n,t)-Rl(n,e)});var s=o[0],a=El(n,s),h=e.getPixelFromCoordinateInternal(a);if(Pl(t,h)<=this.pixelTolerance_){var l=e.getPixelFromCoordinateInternal(s[0]),u=e.getPixelFromCoordinateInternal(s[1]),c=Tl(h,l),p=Tl(h,u),f=Math.sqrt(Math.min(c,p));return this.snappedToVertex_=f<=this.pixelTolerance_,this.snappedToVertex_&&(a=p<c?s[1]:s[0]),a}}return null},t.prototype.handlePointerMove_=function(t){var e=t.pixel,i=t.map,n=this.snapToVertex_(e,i);n||(n=i.getCoordinateFromPixelInternal(e)),this.createOrUpdatePointerFeature_(n)},t.prototype.createOrUpdateExtentFeature_=function(t){var e=this.extentFeature_;return e?t?e.setGeometry(Ch(t)):e.setGeometry(void 0):(e=new Ah(t?Ch(t):{}),this.extentFeature_=e,this.extentOverlay_.getSource().addFeature(e)),e},t.prototype.createOrUpdatePointerFeature_=function(t){var e=this.vertexFeature_;e?e.getGeometry().setCoordinates(t):(e=new Ah(new sh(t)),this.vertexFeature_=e,this.vertexOverlay_.getSource().addFeature(e));return e},t.prototype.handleEvent=function(t){return!t.pointerEvent||(t.type!=_l.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(t),o.prototype.handleEvent.call(this,t),!1)},t.prototype.handleDownEvent=function(t){var e=t.pixel,i=t.map,n=this.getExtentInternal(),r=this.snapToVertex_(e,i),o=function(t){var e=null,i=null;return t[0]==n[0]?e=n[2]:t[0]==n[2]&&(e=n[0]),t[1]==n[1]?i=n[3]:t[1]==n[3]&&(i=n[1]),null!==e&&null!==i?[e,i]:null};if(r&&n){var s=r[0]==n[0]||r[0]==n[2]?r[0]:null,a=r[1]==n[1]||r[1]==n[3]?r[1]:null;null!==s&&null!==a?this.pointerHandler_=wc(o(r)):null!==s?this.pointerHandler_=Sc(o([s,n[1]]),o([s,n[3]])):null!==a&&(this.pointerHandler_=Sc(o([n[0],a]),o([n[2],a])))}else r=i.getCoordinateFromPixelInternal(e),this.setExtent([r[0],r[1],r[0],r[1]]),this.pointerHandler_=wc(r);return!0},t.prototype.handleDragEvent=function(t){if(this.pointerHandler_){var e=t.coordinate;this.setExtent(this.pointerHandler_(e)),this.createOrUpdatePointerFeature_(e)}return!0},t.prototype.handleUpEvent=function(t){this.pointerHandler_=null;var e=this.getExtentInternal();return e&&0!==jt(e)||this.setExtent(null),!1},t.prototype.setMap=function(t){this.extentOverlay_.setMap(t),this.vertexOverlay_.setMap(t),o.prototype.setMap.call(this,t)},t.prototype.getExtent=function(){return We(this.getExtentInternal(),this.getMap().getView().getProjection())},t.prototype.getExtentInternal=function(){return this.extent_},t.prototype.setExtent=function(t){this.extent_=t||null,this.createOrUpdateExtentFeature_(t),this.dispatchEvent(new Cc(this.extent_))}}(zl);function wc(e){return function(t){return mt([e,t])}}function Sc(e,i){return e[0]==i[0]?function(t){return mt([e,[t[0],i[1]]])}:e[1]==i[1]?function(t){return mt([e,[i[0],t[1]]])}:null}var Ec,Oc=(Ec=function(t,e){return(Ec=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Ec(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Ic=1,Tc=[0,0,0,0],Pc=[],Rc="modifystart",Lc="modifyend",bc=function(r){function t(t,e,i){var n=r.call(this,t)||this;return n.features=e,n.mapBrowserEvent=i,n}return Oc(t,r),t}(w);!function(r){function t(t){var i,e,n=r.call(this,t)||this;if(n.boundHandleFeatureChange_=n.handleFeatureChange_.bind(n),n.condition_=t.condition?t.condition:Yl,n.defaultDeleteCondition_=function(t){return(e=t.originalEvent).altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey&&Gl(t);var e},n.deleteCondition_=t.deleteCondition?t.deleteCondition:n.defaultDeleteCondition_,n.insertVertexCondition_=t.insertVertexCondition?t.insertVertexCondition:Ml,n.vertexFeature_=null,n.vertexSegments_=null,n.lastPixel_=[0,0],n.ignoreNextSingleClick_=!1,n.modified_=!1,n.rBush_=new lc,n.pixelTolerance_=void 0!==t.pixelTolerance?t.pixelTolerance:10,n.snappedToVertex_=!1,n.changingFeature_=!1,n.dragSegments_=[],n.overlay_=new hs({source:new pc({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style?t.style:(i=Rn(),function(t,e){return i[Qt.POINT]}),updateWhileAnimating:!0,updateWhileInteracting:!0}),n.SEGMENT_WRITERS_={Point:n.writePointGeometry_.bind(n),LineString:n.writeLineStringGeometry_.bind(n),LinearRing:n.writeLineStringGeometry_.bind(n),Polygon:n.writePolygonGeometry_.bind(n),MultiPoint:n.writeMultiPointGeometry_.bind(n),MultiLineString:n.writeMultiLineStringGeometry_.bind(n),MultiPolygon:n.writeMultiPolygonGeometry_.bind(n),Circle:n.writeCircleGeometry_.bind(n),GeometryCollection:n.writeGeometryCollectionGeometry_.bind(n)},n.source_=null,t.source?(n.source_=t.source,e=new fl(n.source_.getFeatures()),n.source_.addEventListener(oc,n.handleSourceAdd_.bind(n)),n.source_.addEventListener(hc,n.handleSourceRemove_.bind(n))):e=t.features,!e)throw new Error("The modify interaction requires features or a source");return n.features_=e,n.features_.forEach(n.addFeature_.bind(n)),n.features_.addEventListener(hl,n.handleFeatureAdd_.bind(n)),n.features_.addEventListener(ll,n.handleFeatureRemove_.bind(n)),n.lastPointerEvent_=null,n}Oc(t,r),t.prototype.addFeature_=function(t){var e=t.getGeometry();if(e){var i=this.SEGMENT_WRITERS_[e.getType()];i&&i(t,e)}var n=this.getMap();n&&n.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,n),t.addEventListener(p.CHANGE,this.boundHandleFeatureChange_)},t.prototype.willModifyFeatures_=function(t){this.modified_||(this.modified_=!0,this.dispatchEvent(new bc(Rc,this.features_,t)))},t.prototype.removeFeature_=function(t){this.removeFeatureSegmentData_(t),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.removeEventListener(p.CHANGE,this.boundHandleFeatureChange_)},t.prototype.removeFeatureSegmentData_=function(e){var t=this.rBush_,i=[];t.forEach(function(t){e===t.feature&&i.push(t)});for(var n=i.length-1;0<=n;--n){for(var r=i[n],o=this.dragSegments_.length-1;0<=o;--o)this.dragSegments_[o][0]===r&&this.dragSegments_.splice(o,1);t.remove(r)}},t.prototype.setActive=function(t){this.vertexFeature_&&!t&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),r.prototype.setActive.call(this,t)},t.prototype.setMap=function(t){this.overlay_.setMap(t),r.prototype.setMap.call(this,t)},t.prototype.getOverlay=function(){return this.overlay_},t.prototype.handleSourceAdd_=function(t){t.feature&&this.features_.push(t.feature)},t.prototype.handleSourceRemove_=function(t){t.feature&&this.features_.remove(t.feature)},t.prototype.handleFeatureAdd_=function(t){this.addFeature_(t.element)},t.prototype.handleFeatureChange_=function(t){if(!this.changingFeature_){var e=t.target;this.removeFeature_(e),this.addFeature_(e)}},t.prototype.handleFeatureRemove_=function(t){var e=t.element;this.removeFeature_(e)},t.prototype.writePointGeometry_=function(t,e){var i=e.getCoordinates(),n={feature:t,geometry:e,segment:[i,i]};this.rBush_.insert(e.getExtent(),n)},t.prototype.writeMultiPointGeometry_=function(t,e){for(var i=e.getCoordinates(),n=0,r=i.length;n<r;++n){var o=i[n],s={feature:t,geometry:e,depth:[n],index:n,segment:[o,o]};this.rBush_.insert(e.getExtent(),s)}},t.prototype.writeLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),n=0,r=i.length-1;n<r;++n){var o=i.slice(n,n+2),s={feature:t,geometry:e,index:n,segment:o};this.rBush_.insert(mt(o),s)}},t.prototype.writeMultiLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),n=0,r=i.length;n<r;++n)for(var o=i[n],s=0,a=o.length-1;s<a;++s){var h=o.slice(s,s+2),l={feature:t,geometry:e,depth:[n],index:s,segment:h};this.rBush_.insert(mt(h),l)}},t.prototype.writePolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),n=0,r=i.length;n<r;++n)for(var o=i[n],s=0,a=o.length-1;s<a;++s){var h=o.slice(s,s+2),l={feature:t,geometry:e,depth:[n],index:s,segment:h};this.rBush_.insert(mt(h),l)}},t.prototype.writeMultiPolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),n=0,r=i.length;n<r;++n)for(var o=i[n],s=0,a=o.length;s<a;++s)for(var h=o[s],l=0,u=h.length-1;l<u;++l){var c=h.slice(l,l+2),p={feature:t,geometry:e,depth:[s,n],index:l,segment:c};this.rBush_.insert(mt(c),p)}},t.prototype.writeCircleGeometry_=function(t,e){var i=e.getCenter(),n={feature:t,geometry:e,index:0,segment:[i,i]},r={feature:t,geometry:e,index:Ic,segment:[i,i]},o=[n,r];n.featureSegments=o,r.featureSegments=o,this.rBush_.insert(Rt(i),n),this.rBush_.insert(e.getExtent(),r)},t.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var i=e.getGeometriesArray(),n=0;n<i.length;++n){var r=i[n];(0,this.SEGMENT_WRITERS_[r.getType()])(t,r)}},t.prototype.createOrUpdateVertexFeature_=function(t){var e=this.vertexFeature_;e?e.getGeometry().setCoordinates(t):(e=new Ah(new sh(t)),this.vertexFeature_=e,this.overlay_.getSource().addFeature(e));return e},t.prototype.handleEvent=function(t){return!t.pointerEvent||((this.lastPointerEvent_=t).map.getView().getInteracting()||t.type!=_l.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(t),this.vertexFeature_&&this.deleteCondition_(t)&&(e=!(t.type!=_l.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),t.type==_l.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),r.prototype.handleEvent.call(this,t)&&!e);var e},t.prototype.handleDragEvent=function(t){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(t);for(var e=t.coordinate,i=0,n=this.dragSegments_.length;i<n;++i){for(var r=this.dragSegments_[i],o=r[0],s=o.depth,a=o.geometry,h=void 0,l=o.segment,u=r[1];e.length<a.getStride();)e.push(l[u][e.length]);switch(a.getType()){case Qt.POINT:h=e,l[0]=e,l[1]=e;break;case Qt.MULTI_POINT:(h=a.getCoordinates())[o.index]=e,l[0]=e,l[1]=e;break;case Qt.LINE_STRING:(h=a.getCoordinates())[o.index+u]=e,l[u]=e;break;case Qt.MULTI_LINE_STRING:case Qt.POLYGON:(h=a.getCoordinates())[s[0]][o.index+u]=e,l[u]=e;break;case Qt.MULTI_POLYGON:(h=a.getCoordinates())[s[1]][s[0]][o.index+u]=e,l[u]=e;break;case Qt.CIRCLE:l[0]=e,l[1]=e,0===o.index?(this.changingFeature_=!0,a.setCenter(e)):(this.changingFeature_=!0,a.setRadius(Pl(a.getCenter(),e))),this.changingFeature_=!1}h&&this.setGeometryCoordinates_(a,h)}this.createOrUpdateVertexFeature_(e)},t.prototype.handleDownEvent=function(t){if(!this.condition_(t))return!1;this.handlePointerAtPixel_(t.pixel,t.map);var e=t.coordinate;this.dragSegments_.length=0,this.modified_=!1;var i=this.vertexFeature_;if(i){var n=t.map.getView().getProjection(),r=[],o=i.getGeometry().getCoordinates(),s=mt([o]),a=this.rBush_.getInExtent(s),h={};a.sort(Fc);for(var l=0,u=a.length;l<u;++l){var c=a[l],p=c.segment,f=dt(c.feature),d=c.depth;if(d&&(f+="-"+d.join("-")),h[f]||(h[f]=new Array(2)),c.geometry.getType()!==Qt.CIRCLE||c.index!==Ic)if(!Ol(p[0],o)||h[f][0])if(!Ol(p[1],o)||h[f][1])dt(p)in this.vertexSegments_&&!h[f][0]&&!h[f][1]&&this.insertVertexCondition_(t)&&r.push([c,o]);else{if((c.geometry.getType()===Qt.LINE_STRING||c.geometry.getType()===Qt.MULTI_LINE_STRING)&&h[f][0]&&0===h[f][0].index)continue;this.dragSegments_.push([c,1]),h[f][1]=c}else this.dragSegments_.push([c,0]),h[f][0]=c;else Ol(Ac(e,c,n),o)&&!h[f][0]&&(this.dragSegments_.push([c,0]),h[f][0]=c)}r.length&&this.willModifyFeatures_(t);for(var _=r.length-1;0<=_;--_)this.insertVertex_.apply(this,r[_])}return!!this.vertexFeature_},t.prototype.handleUpEvent=function(t){for(var e=this.dragSegments_.length-1;0<=e;--e){var i=this.dragSegments_[e][0],n=i.geometry;if(n.getType()===Qt.CIRCLE){var r=n.getCenter(),o=i.featureSegments[0],s=i.featureSegments[1];o.segment[0]=r,o.segment[1]=r,s.segment[0]=r,s.segment[1]=r,this.rBush_.update(Rt(r),o),this.rBush_.update(n.getExtent(),s)}else this.rBush_.update(mt(i.segment),i)}return this.modified_&&(this.dispatchEvent(new bc(Lc,this.features_,t)),this.modified_=!1),!1},t.prototype.handlePointerMove_=function(t){this.lastPixel_=t.pixel,this.handlePointerAtPixel_(t.pixel,t.map)},t.prototype.handlePointerAtPixel_=function(t,e){var i=e.getCoordinateFromPixel(t),n=e.getView().getProjection(),r=We(xt(Ye(Rt(i,Tc),n),e.getView().getResolution()*this.pixelTolerance_,Tc),n),o=this.rBush_.getInExtent(r);if(0<o.length){o.sort(function(t,e){return Mc(i,t,n)-Mc(i,e,n)});var s=o[0],a=s.segment,h=Ac(i,s,n),l=e.getPixelFromCoordinate(h),u=Pl(t,l);if(u<=this.pixelTolerance_){var c={};if(s.geometry.getType()===Qt.CIRCLE&&s.index===Ic)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(h);else{var p=e.getPixelFromCoordinate(a[0]),f=e.getPixelFromCoordinate(a[1]),d=Tl(l,p),_=Tl(l,f);u=Math.sqrt(Math.min(d,_)),this.snappedToVertex_=u<=this.pixelTolerance_,this.snappedToVertex_&&(h=_<d?a[1]:a[0]),this.createOrUpdateVertexFeature_(h);for(var g=1,y=o.length;g<y;++g){var v=o[g].segment;if(!(Ol(a[0],v[0])&&Ol(a[1],v[1])||Ol(a[0],v[1])&&Ol(a[1],v[0])))break;c[dt(v)]=!0}}return c[dt(a)]=!0,void(this.vertexSegments_=c)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},t.prototype.insertVertex_=function(t,e){for(var i,n=t.segment,r=t.feature,o=t.geometry,s=t.depth,a=t.index;e.length<o.getStride();)e.push(0);switch(o.getType()){case Qt.MULTI_LINE_STRING:case Qt.POLYGON:(i=o.getCoordinates())[s[0]].splice(a+1,0,e);break;case Qt.MULTI_POLYGON:(i=o.getCoordinates())[s[1]][s[0]].splice(a+1,0,e);break;case Qt.LINE_STRING:(i=o.getCoordinates()).splice(a+1,0,e);break;default:return}this.setGeometryCoordinates_(o,i);var h=this.rBush_;h.remove(t),this.updateSegmentIndices_(o,a,s,1);var l={segment:[n[0],e],feature:r,geometry:o,depth:s,index:a};h.insert(mt(l.segment),l),this.dragSegments_.push([l,1]);var u={segment:[e,n[1]],feature:r,geometry:o,depth:s,index:a+1};h.insert(mt(u.segment),u),this.dragSegments_.push([u,0]),this.ignoreNextSingleClick_=!0},t.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=_l.POINTERDRAG){var t=this.lastPointerEvent_;this.willModifyFeatures_(t);var e=this.removeVertex_();return this.dispatchEvent(new bc(Lc,this.features_,t)),this.modified_=!1,e}return!1},t.prototype.removeVertex_=function(){var t,e,i,n,r,o,s,a,h,l,u,c=this.dragSegments_,p={},f=!1;for(r=c.length-1;0<=r;--r)u=dt((l=(i=c[r])[0]).feature),l.depth&&(u+="-"+l.depth.join("-")),u in p||(p[u]={}),0===i[1]?(p[u].right=l,p[u].index=l.index):1==i[1]&&(p[u].left=l,p[u].index=l.index+1);for(u in p){switch(h=p[u].right,s=p[u].left,(a=(o=p[u].index)-1)<0&&(a=0),t=e=(n=(l=void 0!==s?s:h).geometry).getCoordinates(),f=!1,n.getType()){case Qt.MULTI_LINE_STRING:2<e[l.depth[0]].length&&(e[l.depth[0]].splice(o,1),f=!0);break;case Qt.LINE_STRING:2<e.length&&(e.splice(o,1),f=!0);break;case Qt.MULTI_POLYGON:t=t[l.depth[1]];case Qt.POLYGON:4<(t=t[l.depth[0]]).length&&(o==t.length-1&&(o=0),t.splice(o,1),f=!0,0===o&&(t.pop(),t.push(t[0]),a=t.length-1))}if(f){this.setGeometryCoordinates_(n,e);var d=[];if(void 0!==s&&(this.rBush_.remove(s),d.push(s.segment[0])),void 0!==h&&(this.rBush_.remove(h),d.push(h.segment[1])),void 0!==s&&void 0!==h){var _={depth:l.depth,feature:l.feature,geometry:l.geometry,index:a,segment:d};this.rBush_.insert(mt(_.segment),_)}this.updateSegmentIndices_(n,o,l.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),c.length=0}}return f},t.prototype.setGeometryCoordinates_=function(t,e){this.changingFeature_=!0,t.setCoordinates(e),this.changingFeature_=!1},t.prototype.updateSegmentIndices_=function(e,i,n,r){this.rBush_.forEachInExtent(e.getExtent(),function(t){t.geometry===e&&(void 0===n||void 0===t.depth||Gt(t.depth,n))&&t.index>i&&(t.index+=r)})}}(zl);function Fc(t,e){return t.index-e.index}function Mc(t,e,i){var n=e.geometry;if(n.getType()===Qt.CIRCLE){var r=n;if(e.index===Ic){var o=Tl(r.getCenter(),t),s=Math.sqrt(o)-r.getRadius();return s*s}}var a=je(t,i);return Pc[0]=je(e.segment[0],i),Pc[1]=je(e.segment[1],i),Rl(a,Pc)}function Ac(t,e,i){var n=e.geometry;if(n.getType()===Qt.CIRCLE&&e.index===Ic)return n.getClosestPoint(t);var r=je(t,i);return Pc[0]=je(e.segment[0],i),Pc[1]=je(e.segment[1],i),Ne(El(r,Pc),i)}var Dc,Gc=(Dc=function(t,e){return(Dc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Dc(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),kc={SELECT:"select"},Nc=function(o){function t(t,e,i,n){var r=o.call(this,t)||this;return r.selected=e,r.deselected=i,r.mapBrowserEvent=n,r}return Gc(t,o),t}(w);!function(a){function t(t){var e,i,n=a.call(this,{handleEvent:jc})||this,r=t||{};if(n.condition_=r.condition?r.condition:Gl,n.addCondition_=r.addCondition?r.addCondition:Dl,n.removeCondition_=r.removeCondition?r.removeCondition:Dl,n.toggleCondition_=r.toggleCondition?r.toggleCondition:Nl,n.multi_=!!r.multi&&r.multi,n.filter_=r.filter?r.filter:_,n.hitTolerance_=r.hitTolerance?r.hitTolerance:0,n.style_=void 0!==r.style?r.style:(g((e=Rn())[Qt.POLYGON],e[Qt.LINE_STRING]),g(e[Qt.GEOMETRY_COLLECTION],e[Qt.LINE_STRING]),function(t){return t.getGeometry()?e[t.getGeometry().getType()]:null}),n.featureStyleAssociation_={},n.features_=r.features||new fl,r.layers)if("function"==typeof r.layers)i=r.layers;else{var o=r.layers;i=function(t){return f(o,t)}}else i=_;n.layerFilter_=i,n.featureLayerAssociation_={};var s=n.getFeatures();return s.addEventListener(hl,n.addFeature_.bind(n)),s.addEventListener(ll,n.removeFeature_.bind(n)),n}Gc(t,a),t.prototype.addFeatureLayerAssociation_=function(t,e){this.featureLayerAssociation_[dt(t)]=e},t.prototype.getFeatures=function(){return this.features_},t.prototype.getHitTolerance=function(){return this.hitTolerance_},t.prototype.getLayer=function(t){return this.featureLayerAssociation_[dt(t)]},t.prototype.setHitTolerance=function(t){this.hitTolerance_=t},t.prototype.setMap=function(t){this.getMap()&&this.style_&&this.features_.forEach(this.removeSelectedStyle_.bind(this)),a.prototype.setMap.call(this,t),t&&this.style_&&this.features_.forEach(this.giveSelectedStyle_.bind(this))},t.prototype.addFeature_=function(t){var e=t.element;this.style_&&this.giveSelectedStyle_(e)},t.prototype.removeFeature_=function(t){var e=t.element;this.style_&&this.removeSelectedStyle_(e)},t.prototype.giveSelectedStyle_=function(t){var e=dt(t);this.featureStyleAssociation_[e]=t.getStyle(),t.setStyle(this.style_)},t.prototype.removeSelectedStyle_=function(t){var e=dt(t);t.setStyle(this.featureStyleAssociation_[e]),delete this.featureStyleAssociation_[e]},t.prototype.removeFeatureLayerAssociation_=function(t){delete this.featureLayerAssociation_[dt(t)]}}(vl);function jc(t){if(!this.condition_(t))return!0;var i=this.addCondition_(t),n=this.removeCondition_(t),r=this.toggleCondition_(t),e=!i&&!n&&!r,o=t.map,s=this.getFeatures(),a=[],h=[];if(e){y(this.featureLayerAssociation_),o.forEachFeatureAtPixel(t.pixel,function(t,e){if(this.filter_(t,e))return h.push(t),this.addFeatureLayerAssociation_(t,e),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var l=s.getLength()-1;0<=l;--l){var u=s.item(l),c=h.indexOf(u);-1<c?h.splice(c,1):(s.remove(u),a.push(u))}0!==h.length&&s.extend(h)}else{o.forEachFeatureAtPixel(t.pixel,function(t,e){if(this.filter_(t,e))return!i&&!r||f(s.getArray(),t)?(n||r)&&f(s.getArray(),t)&&(a.push(t),this.removeFeatureLayerAssociation_(t)):(h.push(t),this.addFeatureLayerAssociation_(t,e)),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var p=a.length-1;0<=p;--p)s.remove(a[p]);s.extend(h)}return(0<h.length||0<a.length)&&this.dispatchEvent(new Nc(kc.SELECT,h,a,t)),!0}var Wc,Yc=(Wc=function(t,e){return(Wc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}Wc(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});function Xc(t){return t.feature?t.feature:t.element?t.element:void 0}var zc,Uc=[],Vc=(function(r){function t(t){var e=this,i=t||{},n=i;return n.handleDownEvent||(n.handleDownEvent=_),n.stopDown||(n.stopDown=v),(e=r.call(this,n)||this).source_=i.source?i.source:null,e.vertex_=void 0===i.vertex||i.vertex,e.edge_=void 0===i.edge||i.edge,e.features_=i.features?i.features:null,e.featuresListenerKeys_=[],e.featureChangeListenerKeys_={},e.indexedFeaturesExtents_={},e.pendingFeatures_={},e.pixelTolerance_=void 0!==i.pixelTolerance?i.pixelTolerance:10,e.rBush_=new lc,e.SEGMENT_WRITERS_={Point:e.writePointGeometry_.bind(e),LineString:e.writeLineStringGeometry_.bind(e),LinearRing:e.writeLineStringGeometry_.bind(e),Polygon:e.writePolygonGeometry_.bind(e),MultiPoint:e.writeMultiPointGeometry_.bind(e),MultiLineString:e.writeMultiLineStringGeometry_.bind(e),MultiPolygon:e.writeMultiPolygonGeometry_.bind(e),GeometryCollection:e.writeGeometryCollectionGeometry_.bind(e),Circle:e.writeCircleGeometry_.bind(e)},e}Yc(t,r),t.prototype.addFeature=function(t,e){var i=void 0===e||e,n=dt(t),r=t.getGeometry();if(r){var o=this.SEGMENT_WRITERS_[r.getType()];o&&(this.indexedFeaturesExtents_[n]=r.getExtent([1/0,1/0,-1/0,-1/0]),o(t,r))}i&&(this.featureChangeListenerKeys_[n]=a(t,p.CHANGE,this.handleFeatureChange_,this))},t.prototype.forEachFeatureAdd_=function(t){this.addFeature(t)},t.prototype.forEachFeatureRemove_=function(t){this.removeFeature(t)},t.prototype.getFeatures_=function(){var t;return this.features_?t=this.features_:this.source_&&(t=this.source_.getFeatures()),t},t.prototype.handleEvent=function(t){var e=this.snapTo(t.pixel,t.coordinate,t.map);return e.snapped&&(t.coordinate=e.vertex.slice(0,2),t.pixel=e.vertexPixel),r.prototype.handleEvent.call(this,t)},t.prototype.handleFeatureAdd_=function(t){var e=Xc(t);this.addFeature(e)},t.prototype.handleFeatureRemove_=function(t){var e=Xc(t);this.removeFeature(e)},t.prototype.handleFeatureChange_=function(t){var e=t.target;if(this.handlingDownUpSequence){var i=dt(e);i in this.pendingFeatures_||(this.pendingFeatures_[i]=e)}else this.updateFeature_(e)},t.prototype.handleUpEvent=function(t){var e=o(this.pendingFeatures_);return e.length&&(e.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1},t.prototype.removeFeature=function(e,t){var i=void 0===t||t,n=dt(e),r=this.indexedFeaturesExtents_[n];if(r){var o=this.rBush_,s=[];o.forEachInExtent(r,function(t){e===t.feature&&s.push(t)});for(var a=s.length-1;0<=a;--a)o.remove(s[a])}i&&(l(this.featureChangeListenerKeys_[n]),delete this.featureChangeListenerKeys_[n])},t.prototype.setMap=function(t){var e=this.getMap(),i=this.featuresListenerKeys_,n=this.getFeatures_();e&&(i.forEach(l),i.length=0,n.forEach(this.forEachFeatureRemove_.bind(this))),r.prototype.setMap.call(this,t),t&&(this.features_?i.push(a(this.features_,hl,this.handleFeatureAdd_,this),a(this.features_,ll,this.handleFeatureRemove_,this)):this.source_&&i.push(a(this.source_,oc,this.handleFeatureAdd_,this),a(this.source_,hc,this.handleFeatureRemove_,this)),n.forEach(this.forEachFeatureAdd_.bind(this)))},t.prototype.snapTo=function(t,e,i){var n=mt([i.getCoordinateFromPixel([t[0]-this.pixelTolerance_,t[1]+this.pixelTolerance_]),i.getCoordinateFromPixel([t[0]+this.pixelTolerance_,t[1]-this.pixelTolerance_])]),r=this.rBush_.getInExtent(n);this.vertex_&&!this.edge_&&(r=r.filter(function(t){return t.feature.getGeometry().getType()!==Qt.CIRCLE}));var o=!1,s=null,a=null;if(0===r.length)return{snapped:o,vertex:s,vertexPixel:a};for(var h,l=i.getView().getProjection(),u=je(e,l),c=1/0,p=0;p<r.length;++p){var f=r[p];Uc[0]=je(f.segment[0],l),Uc[1]=je(f.segment[1],l);var d=Rl(u,Uc);d<c&&(h=f,c=d)}var _=h.segment;if(this.vertex_&&!this.edge_){var g=i.getPixelFromCoordinate(_[0]),y=i.getPixelFromCoordinate(_[1]),v=Tl(t,g),m=Tl(t,y);Math.sqrt(Math.min(v,m))<=this.pixelTolerance_&&(o=!0,s=m<v?_[1]:_[0],a=i.getPixelFromCoordinate(s))}else if(this.edge_){var x=h.feature.getGeometry().getType()===Qt.CIRCLE;if(x?s=function(t,e){var i=e.getRadius(),n=e.getCenter(),r=n[0],o=n[1],s=t[0]-r,a=t[1]-o;0===s&&0===a&&(s=1);var h=Math.sqrt(s*s+a*a);return[r+i*s/h,o+i*a/h]}(e,h.feature.getGeometry()):(Uc[0]=je(_[0],l),Uc[1]=je(_[1],l),s=Ne(El(u,Uc),l)),Pl(t,a=i.getPixelFromCoordinate(s))<=this.pixelTolerance_&&(o=!0,this.vertex_&&!x)){g=i.getPixelFromCoordinate(_[0]),y=i.getPixelFromCoordinate(_[1]),v=Tl(a,g),m=Tl(a,y);Math.sqrt(Math.min(v,m))<=this.pixelTolerance_&&(s=m<v?_[1]:_[0],a=i.getPixelFromCoordinate(s))}}return o&&(a=[Math.round(a[0]),Math.round(a[1])]),{snapped:o,vertex:s,vertexPixel:a}},t.prototype.updateFeature_=function(t){this.removeFeature(t,!1),this.addFeature(t,!1)},t.prototype.writeCircleGeometry_=function(t,e){for(var i=wh(e).getCoordinates()[0],n=0,r=i.length-1;n<r;++n){var o=i.slice(n,n+2),s={feature:t,segment:o};this.rBush_.insert(mt(o),s)}},t.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var i=e.getGeometriesArray(),n=0;n<i.length;++n){var r=this.SEGMENT_WRITERS_[i[n].getType()];r&&r(t,i[n])}},t.prototype.writeLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),n=0,r=i.length-1;n<r;++n){var o=i.slice(n,n+2),s={feature:t,segment:o};this.rBush_.insert(mt(o),s)}},t.prototype.writeMultiLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),n=0,r=i.length;n<r;++n)for(var o=i[n],s=0,a=o.length-1;s<a;++s){var h=o.slice(s,s+2),l={feature:t,segment:h};this.rBush_.insert(mt(h),l)}},t.prototype.writeMultiPointGeometry_=function(t,e){for(var i=e.getCoordinates(),n=0,r=i.length;n<r;++n){var o=i[n],s={feature:t,segment:[o,o]};this.rBush_.insert(e.getExtent(),s)}},t.prototype.writeMultiPolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),n=0,r=i.length;n<r;++n)for(var o=i[n],s=0,a=o.length;s<a;++s)for(var h=o[s],l=0,u=h.length-1;l<u;++l){var c=h.slice(l,l+2),p={feature:t,segment:c};this.rBush_.insert(mt(c),p)}},t.prototype.writePointGeometry_=function(t,e){var i=e.getCoordinates(),n={feature:t,segment:[i,i]};this.rBush_.insert(e.getExtent(),n)},t.prototype.writePolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),n=0,r=i.length;n<r;++n)for(var o=i[n],s=0,a=o.length-1;s<a;++s){var h=o.slice(s,s+2),l={feature:t,segment:h};this.rBush_.insert(mt(h),l)}}}(zl),zc=function(t,e){return(zc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}zc(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Bc="translatestart",Hc="translating",Zc="translateend",Kc=function(s){function t(t,e,i,n,r){var o=s.call(this,t)||this;return o.features=e,o.coordinate=i,o.startCoordinate=n,o.mapBrowserEvent=r,o}return Vc(t,s),t}(w);!function(o){function t(t){var e,i=this,n=t||{};if((i=o.call(this,n)||this).lastCoordinate_=null,i.startCoordinate_=null,i.features_=void 0!==n.features?n.features:null,n.layers)if("function"==typeof n.layers)e=n.layers;else{var r=n.layers;e=function(t){return f(r,t)}}else e=_;return i.layerFilter_=e,i.filter_=n.filter?n.filter:_,i.hitTolerance_=n.hitTolerance?n.hitTolerance:0,i.lastFeature_=null,i.addEventListener(F(gl),i.handleActiveChanged_),i}Vc(t,o),t.prototype.handleDownEvent=function(t){if(this.lastFeature_=this.featuresAtPixel_(t.pixel,t.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=t.coordinate,this.lastCoordinate_=t.coordinate,this.handleMoveEvent(t);var e=this.features_||new fl([this.lastFeature_]);return this.dispatchEvent(new Kc(Bc,e,t.coordinate,this.startCoordinate_,t)),!0}return!1},t.prototype.handleUpEvent=function(t){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(t);var e=this.features_||new fl([this.lastFeature_]);return this.dispatchEvent(new Kc(Zc,e,t.coordinate,this.startCoordinate_,t)),!(this.startCoordinate_=null)}return!1},t.prototype.handleDragEvent=function(t){if(this.lastCoordinate_){var e=t.coordinate,i=e[0]-this.lastCoordinate_[0],n=e[1]-this.lastCoordinate_[1],r=this.features_||new fl([this.lastFeature_]);r.forEach(function(t){var e=t.getGeometry();e.translate(i,n),t.setGeometry(e)}),this.lastCoordinate_=e,this.dispatchEvent(new Kc(Hc,r,e,this.startCoordinate_,t))}},t.prototype.handleMoveEvent=function(t){var e=t.map.getViewport();this.featuresAtPixel_(t.pixel,t.map)?(e.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),e.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):e.classList.remove("ol-grab","ol-grabbing")},t.prototype.featuresAtPixel_=function(t,e){return e.forEachFeatureAtPixel(t,function(t,e){if(this.filter_(t,e)&&(!this.features_||f(this.features_.getArray(),t)))return t}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})},t.prototype.getHitTolerance=function(){return this.hitTolerance_},t.prototype.setHitTolerance=function(t){this.hitTolerance_=t},t.prototype.setMap=function(t){var e=this.getMap();o.prototype.setMap.call(this,t),this.updateState_(e)},t.prototype.handleActiveChanged_=function(){this.updateState_(null)},t.prototype.updateState_=function(t){var e=this.getMap(),i=this.getActive();e&&i||(e=e||t)&&e.getViewport().classList.remove("ol-grab","ol-grabbing")}}(zl);var qc=window.olgm={};qc.gm={},qc.interaction={},qc.layer={},qc.OLGoogleMaps=al,qc.gm.ImageOverlay=Ws,qc.gm.MapElement=Xh,qc.gm.MapIcon=Uh,qc.gm.MapLabel=zh,qc.gm.PanesOverlay=ka,qc.interaction.defaults=function(t){var e,i,n,r,o=void 0!==t?t:{};return o.altShiftDragRotate=!1,o.dragPan=!1,o.pinchRotate=!1,o.zoomDuration=0,(e=o,i=e||{},n=new fl,r=new dl(-.005,.05,100),(void 0===i.altShiftDragRotate||i.altShiftDragRotate)&&n.push(new eu),(void 0===i.doubleClickZoom||i.doubleClickZoom)&&n.push(new wl({delta:i.zoomDelta,duration:i.zoomDuration})),(void 0===i.dragPan||i.dragPan)&&n.push(new Hl({condition:i.onFocusOnly?Fl:void 0,kinetic:r})),(void 0===i.pinchRotate||i.pinchRotate)&&n.push(new bu),(void 0===i.pinchZoom||i.pinchZoom)&&n.push(new Mu({duration:i.zoomDuration})),(void 0===i.keyboard||i.keyboard)&&(n.push(new gu),n.push(new xu({delta:i.zoomDelta,duration:i.zoomDuration}))),(void 0===i.mouseWheelZoom||i.mouseWheelZoom)&&n.push(new Ru({condition:i.onFocusOnly?Fl:void 0,duration:i.zoomDuration})),(void 0===i.shiftDragZoom||i.shiftDragZoom)&&n.push(new cu({duration:i.zoomDuration})),n).extend([new Hl])},qc.layer.Google=ol}();
//# sourceMappingURL=olgm.js.map
